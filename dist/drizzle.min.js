// DrizzleJS v0.2.0
// -------------------------------------
// Copyright (c) 2014 Jaco Koo <jaco.koo@guyong.in>
// Distributed under MIT license


var __slice=[].slice,__hasProp={}.hasOwnProperty,__extends=function(a,b){function c(){this.constructor=a}for(var d in b)__hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};!function(a,b){var c;return"function"==typeof define&&define.amd?define(["jquery"],function(c){return b(a,c)}):module&&module.exports?(c=require("jquery"),module.exports=b(a,c)):a.Drizzle=b(a,c)}(this,function(a,b){var c,d,e,f,g,h,j,k,l,m,n,o,p,q,r,s,t;for(d=f={version:"0.2.0"},k=a.Drizzle,g=0,s=["Function","Object","Array","Number","Boolean","Date","RegExp","Undefined","Null"],m=function(a){return d["is"+a]=function(b){return Object.prototype.toString.call(b)==="[object "+a+"]"}},o=0,q=s.length;q>o;o++)h=s[o],m(h);for(d.extend=function(){var a,b,c,e,f,g,h;if(e=arguments[0],c=2<=arguments.length?__slice.call(arguments,1):[],!d.isObject(e))return e;for(g=0,h=c.length;h>g;g++){b=c[g];for(a in b)f=b[a],e[a]=f}return e},d.extend(d,l=function(a){return(a?a:"")+ ++i},j=function(){return a.Drizzle=k,d}),f.Base=c=function(){function a(a){this.id=f.uniqueId(a),this.initialize()}return a.include=function(){var a,b,c,d,e,f;for(c=1<=arguments.length?__slice.call(arguments,0):[],e=0,f=c.length;f>e;e++){b=c[e];for(a in b)d=b[a],this.prototype[a]=d}return this},a.include(f.Deferred),a.prototype.initialize=function(){},a.prototype.getOptionResult=function(a){return _.isFunction(a)?a.apply(this):a},a.prototype.extend=function(a){var b,c,d,e;if(a){b=function(a){return function(b,c){var d;return f.isFunction(c)?(d=a[b],a[b]=function(){var a;return a=1<=arguments.length?__slice.call(arguments,0):[],d&&a.unshift(d),c.apply(this,a)}):a[b]?void 0:a[b]=c}}(this),e=[];for(c in a)d=a[c],e.push(b(c,d));return e}},a}(),d.Model=e=function(a){function b(a,c,e){var f,g;this.app=a,this.module=c,this.options=null!=e?e:{},this.data=this.options.data||{},this.params={},e.pageable&&(f=d.Config.pagination,g=this.pagination={page:e.page||1,pageCount:0,pageSize:e.pageSize||f.pageSize,pageKey:e.pageKey||f.pageKey,pageSizeKey:e.pageSizeKey||f.pageSizeKey,recordCountKey:e.recordCountKey||f.recordCountKey}),b.__super__.constructor.call(this,"d")}return __extends(b,a),b.prototype.setData=function(a){var b;return this.data=d.isFunction(this.options.parse)?this.options.parse(a):a,(b=this.pagination)&&(b.recordCount=this.data[b.recordCountKey],b.pageCount=Math.ceil(b.recordCount/b.pageSize)),this.options.root?this.data=this.data[this.options.root]:void 0},b.prototype.url=function(){return this.getOptionResult(this.options.url)||this.getOptionResult(this.url)||""},b.prototype.toJSON=function(){return this.data},b.prototype.getParams=function(){var a,b;return a={},(b=this.pagination)&&(a[b.pageKey]=b.page,a[b.pageSizeKey]=b.pageSize),d.extend(a,this.params,this.options.params)},b.prototype.clear=function(){var a;return this.data={},(a=this.pagination)?(a.page=1,a.pageCount=0):void 0},b.prototype.turnToPage=function(a,b){var c;return(c=this.pagination&&a<=c.pageCount&&a>=1)?(c.page=a,this.get(b)):this.createRejectedDeferred()},b.prototype.firstPage=function(a){return this.turnToPage(1,a)},b.prototype.lastPage=function(a){return this.turnToPage(this.pagination.pageCount,a)},b.prototype.nextPage=function(a){return this.turnToPage(this.pagination.page+1,a)},b.prototype.prevPage=function(a){return this.turnToPage(this.pagination.page-1,a)},b.prototype.getPageInfo=function(){var a,b;return(b=this.pagination)?(a=this.data.length>0?{start:(b.page-1)*b.pageSize+1,end:b.page*b.pageSize,total:b.recordCount}:{start:0,end:0,total:0},a.end>a.total&&(a.end=a.total),a):{}},b}(d.Base),t=["get","post","put","del"],n=function(){},p=0,r=t.length;r>p;p++)h=t[p],n(h),d.Model.prototype[h]=function(a){return d.Require[h](this,a)};return f.Config={scriptRoot:"app",urlRoot:"",urlSuffix:"",attributesReferToId:["for","data-target","data-parent"],fileNames:{module:"index",templates:"templates",view:"view-",template:"template-",handler:"handler-",model:"model-",collection:"collection-",router:"router"},pagination:{defaultPageSize:10,pageKey:"_page",pageSizeKey:"_pageSize",recordCountKey:"recordCount"}},d.Deferred={createDeferred:function(){return b.Deferred()},createRejectedDeferred:function(){var a,b;return a=1<=arguments.length?__slice.call(arguments,0):[],b=this.createDeferred(),b.reject.apply(b,a),b},deferred:function(){var a,b,c;return b=arguments[0],a=2<=arguments.length?__slice.call(arguments,1):[],d.isFunction(b)&&(b=b.apply(this,a)),(null!=b?b.promise:void 0)?b.promise():(c=this.createDeferred(),c.resolve(b),c.promise())},chain:function(){var a,c,e,f;return f=1<=arguments.length?__slice.call(arguments,0):[],e=this.createDeferred(),0===f.length?(e.resolve(),e.promise()):(c=[],a=function(g){return function(h,i){var j,k,l,m;return k=function(a){return!d.isArray(h)&&a.length<2&&(a=a[0]),c.push(a)},(d.isArray(h)?(m=function(){var a,b,d;for(d=[],a=0,b=h.length;b>a;a++)l=h[a],j=[l],i>0&&j.push(c[i-1]),d.push(this.deferred.apply(this,j));return d}.call(g),b.when.apply(b,m)):(j=[h],i>0?j.push(c[i-1]):void 0,g.deferred.apply(g,j))).done(function(){var b;return b=1<=arguments.length?__slice.call(arguments,0):[],k(b),0===f.length?e.resolve.apply(e,c):a(f.shift(),++i)}).fail(function(){var a;return a=1<=arguments.length?__slice.call(arguments,0):[],k(a),e.reject.apply(e,c)})}}(this),a(f.shift(),0),e.promise())}},d.Event={on:function(a,b,c){var d;return this.registeredEvents||(this.registeredEvents={}),((d=this.registeredEvents)[a]||(d[a]=[])).push({fn:b,context:c}),this},off:function(a,b,c){var d;return this.registeredEvents&&(d=this.registeredEvents[a])?(this.registeredEvents[a]=function(){var a,e,f;for(f=[],a=0,e=d.length;e>a;a++)h=d[a],(h.fn!==b||c&&c!==h.context)&&f.push(h);return f}(),this):this},trigger:function(){var a,b,c,d,e;if(c=arguments[0],a=2<=arguments.length?__slice.call(arguments,1):[],!this.registeredEvents||!(b=this.registeredEvents[c]))return this;for(d=0,e=b.length;e>d;d++)h=b[d],h.fn.apply(h.context,a);return this},listenTo:function(a,b,c){var d;return this.registeredListeners||(this.registeredListeners={}),((d=this.registeredListeners)[b]||(d[b]=[])).push({fn:c,obj:a}),a.on(b,c,this),this},stopListening:function(a,b,c){var d,e,f,g,i,j;if(!this.registeredListeners)return this;if(!a){i=this.registeredListeners;for(d in i)e=i[d],e.obj.off(d,e.fn,this);return this}j=this.registeredListeners;for(d in j)if(e=j[d],!b||b===d)for(this.registeredListeners[d]=[],f=0,g=e.length;g>f;f++)h=e[f],h.obj!==a||c&&c!==h.fn?this.registeredListeners[d].push(h):h.obj.off(d,h.fn,this);return this}},d.Request={url:function(a){var b,c;for(c=[d.Config.urlRoot],a.module.options.urlPrefix&&url.push(a.module.options.urlPrefix),url.push(a.module.name),b=a.url||"",d.isFunction(b)&&(b=b.apply(a));0===b.indexOf("../");)paths.pop(),b=b.slice(3);return c.push(b),a.data.id&&c.push(a.data.id),c.join("/").replace(/\/{2, }/g,"/")},get:function(a,b){return this.ajax({type:"GET"},a,a.getParams(),b)},post:function(a,b){return this.ajax({type:"POST"},a,a.data,b)},put:function(a,b){return this.ajax({type:"PUT"},a,a.data,b)},del:function(a,b){return this.ajax({type:"DELETE"},a,a.data,b)},ajax:function(a,c,e,f){var g;return g=this.url(c),a=d.extend(a,{contentType:"application/json"},f),e=d.extend(e,f.data),a.url=g,a.data=e,d.Deferred.chain(b.ajax(a),function(a){return c.setData(a)})}},f});
//# sourceMappingURL=drizzle.min.js.map