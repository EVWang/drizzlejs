/*!
 * DrizzleJS v0.3.0
 * -------------------------------------
 * Copyright (c) 2015 Jaco Koo <jaco.koo@guyong.in>
 * Distributed under MIT license
 */
var slice=[].slice,extend=function(t,e){function n(){this.constructor=t}for(var r in e)hasProp.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},hasProp={}.hasOwnProperty;!function(t,e){var n,r;return"function"==typeof define&&define.amd?define(["handlebars.runtime","diff-dom"],function(n,r){return e(t,n["default"],r)}):module&&module.exports?(n=require("handlebars.runtime"),r=require("diff-dom"),module.exports=e(t,n,r)):t.Drizzle=e(t,n,r)}(this,function(t,e,n){var r,i,o,s,u,a,h,l,p,c,f,d,g,m,y,v,R,P,x,w,b,E,_,L,D;for(s=u={version:"0.3.0"},x=0,L=Object.prototype.toString,D=["Function","Object","String","Array","Number","Boolean","Date","RegExp","Undefined","Null"],v=function(){var t;return t=1<=arguments.length?slice.call(arguments,0):[],t.join("/").replace(/\/{2,}/g,"/").replace(/^\/|\/$/g,"")},P=function(t){return s["is"+t]=function(e){return L.call(e)==="[object "+t+"]"}},b=0,E=D.length;E>b;b++)w=D[b],P(w);return s.extend=function(){var t,e,n,r,i,o,s;if(o=arguments[0],i=2<=arguments.length?slice.call(arguments,1):[],!o)return o;for(t=0,n=i.length;n>t;t++){r=i[t];for(e in r)s=r[e],o[e]=s}return o},s.include=function(){var t,e,n,r,i,o,u;if(o=arguments[0],i=2<=arguments.length?slice.call(arguments,1):[],!s.isFunction(o))return o;for(t=0,n=i.length;n>t;t++){r=i[t];for(e in r)u=r[e],o.prototype[e]=u}return o},s.uniqueId=function(t){return(t?t:"")+ ++x},r=s.Adapter={Promise:t.Promise,ajax:$.ajax,hasClass:function(t,e){return $(t).hasClass(e)},getElementsBySelector:function(e,n){return null==n&&(n=t.document),n.querySelectorAll(e)},createDefaultHandler:function(t){return{creator:function(){throw new Error("Component ["+t+"] is not defined")}()}},delegateDomEvent:function(t,e,n,r){return $(t).on(e,n,r)},undelegateDomEvents:function(t,e){return $(t).off(e)}},s.Promise=c=function(){function t(t){this.context=t}return t.prototype.create=function(t){return new r.Promise(function(e){return function(n,r){return t.call(e.context,n,r)}}(this))},t.prototype.resolve=function(t){return r.Promise.resolve(t)},t.prototype.reject=function(t){return r.Promise.reject(t)},t.prototype.when=function(){var t,e;return e=arguments[0],t=2<=arguments.length?slice.call(arguments,1):[],s.isFunction(e)&&(e=e.apply(this.context,t)),r.Promise.resolve(e)},t.prototype.chain=function(){var t;return t=1<=arguments.length?slice.call(arguments,0):[],0===t.length?this.resolve():this.create(function(e){return function(n,i){var o,u;return u=null,(o=function(a,h){var l,p;return l=s.isArray(a),(l?(p=function(){var t,e,n;for(n=[],t=0,e=a.length;e>t;t++)w=a[t],n.push(this.when.apply(this,h>0?[w,u]:[w]));return n}.call(e),r.Promise.all(p)):e.when.apply(e,h>0?[a,u]:[a])).then(function(e){return u=e,0===t.length?n(u):o(t.shift(),++h)},function(t){return i(t)})})(t.shift(),0)}}(this))},t}(),s.Event={on:function(t,e,n){var r;return this.events||(this.events={}),((r=this.events)[t]||(r[t]=[])).push({fn:e,ctx:n}),this},off:function(t,e,n){return this.events?t?this.events[t]?e?(this.events[t]=function(){var r,i,o,s;for(o=this.events[t],s=[],r=0,i=o.length;i>r;r++)w=o[r],(w.fn!==e||n&&n!==w.ctx)&&s.push(w);return s}.call(this),0===this.events[t].length&&delete this.events[t],this):delete this.events[t]&&this:this:(this.events={})&&this:this},trigger:function(){var t,e,n,r,i;if(r=arguments[0],t=2<=arguments.length?slice.call(arguments,1):[],!this.events||!this.events[r])return this;for(i=this.events[r],e=0,n=i.length;n>e;e++)w=i[e],w.fn.apply(w.context,t);return this},delegateEvent:function(t){var e;return e="--"+t.id,s.extend(t,{on:function(n){return function(r,i){return t.listenTo(n,r+e,i)}}(this),off:function(n){return function(r,i){return t.stopListening(n,r&&r+e,i)}}(this),trigger:function(n){return function(){var r,i;return i=arguments[0],r=2<=arguments.length?slice.call(arguments,1):[],r.unshift(i+e),n.trigger.apply(n,r),t}}(this),listenTo:function(t,e,n){var r;return this.listeners||(this.listeners={}),((r=this.listeners)[e]||(r[e]=[])).push({fn:n,obj:t}),t.on(e,n,this),this},stopListening:function(t,e,n){var r,i,o,s,u,a,h,l;if(!this.listeners)return this;if(!t){a=this.listeners;for(i in a)for(l=a[i],r=0,s=l.length;s>r;r++)w=l[r],w.obj.off(i,w.fn,this);return this.listeners={},this}h=this.listeners;for(i in h)if(l=h[i],!e||e===i){for(this.listeners[i]=[],o=0,u=l.length;u>o;o++)w=l[o],w.obj!==t||n&&n!==w.fn?this.listeners[i].push(w):w.obj.off(i,w.fn,this);0===this.listeners[i].length&&delete this.listeners[i]}return this}}),this}},s.Request={url:function(t){var e,n,r;for(n=t.app.options,r=[n.urlRoot],t.module.options.urlPrefix&&r.push(t.module.options.urlPrefix),r.push(t.module.name),e=t.url||"",s.isFunction(e)&&(e=e.apply(t));0===e.indexOf("../");)r.pop(),e=e.slice(3);return e&&r.push(e),t.data.id&&r.push(t.data.id),n.urlSuffix&&r.push(r.pop()+n.urlSuffix),v.apply(null,r)},get:function(t,e){return this.ajax({type:"GET"},t,t.getParams(),e)},post:function(t,e){return this.ajax({type:"POST"},t,t.data,e)},put:function(t,e){return this.ajax({type:"PUT"},t,t.data,e)},del:function(t,e){return this.ajax({type:"DELETE"},t,t.data,e)},save:function(t,e){return t.data.id?this.put(t,e):this.post(t,e)},ajax:function(t,e,n,i){var o;return null==i&&(i={}),o=this.url(e),t=s.extend(t,{contentType:e.app.options.defaultContentType},i),n=s.extend(n,i.data),t.url=o,t.data=n,e.Promise.chain(r.ajax(t),function(t){return e.set(t),e})}},s.Factory={types:{},register:function(t,e){return this.types[t]=e},create:function(){var t,e,n;return n=arguments[0],t=2<=arguments.length?slice.call(arguments,1):[],e=this.types[n]||this,function(t,e,n){n.prototype=t.prototype;var r=new n,i=t.apply(r,e);return Object(i)===i?i:r}(e,t,function(){})}},s.Base=o=function(){function t(t,e){this.options=null!=e?e:{},this.id=s.uniqueId(t),this.Promise=new s.Promise(this),this.initialize()}return t.prototype.initialize=function(){},t.prototype.getOptionValue=function(t){var e;return e=this.options[t],s.isFunction(e)?e.apply(this):e},t.prototype.error=function(t){var e;if(!s.isString(t))throw t;throw e=this.module?"["+this.module.name+":":"[",e+=this.name+"] "+t,new Error(e)},t.prototype.extend=function(t){var e,n,r,i;if(t){e=function(t){return function(e,n){var r;return s.isFunction(n)?(r=t[e],t[e]=function(){var t;return t=1<=arguments.length?slice.call(arguments,0):[],r&&t.unshift(r),n.apply(this,t)}):t[e]?void 0:t[e]=n}}(this),r=[];for(n in t)i=t[n],r.push(e(n,i));return r}},t}(),R={scriptRoot:"app",urlRoot:"",urlSuffix:"",caseSensitiveHash:!1,defaultRegion:t.document.body,attributesReferToId:["for","data-target","data-parent"],fileNames:{module:"index",templates:"templates",view:"view-",template:"template-",router:"router"},actionPromised:function(t){}},s.Application=i=function(t){function n(t){var e;null==t&&(t={}),e=s.extend({},R,t),this.modules={},this.global={},this.loaders={},this.regions=[],n.__super__.constructor.call(this,"A",e)}return extend(n,t),n.prototype.initialize=function(){var t,e,n;this.registerLoader(new s.SimpleLoader(this)),this.registerLoader(new s.Loader(this),!0),e=s.Helpers;for(t in e)n=e[t],this.registerHelper(t,n);return this.setRegion(new s.Region(this,null,this.options.defaultRegion))},n.prototype.registerLoader=function(t,e){return this.loaders[t.name]=t,e?this.defaultLoader=t:void 0},n.prototype.registerHelper=function(t,n){var r;return r=this,e.registerHelper(t,function(){var t;return t=1<=arguments.length?slice.call(arguments,0):[],n.apply(this,[r,e].concat(t))})},n.prototype.getLoader=function(t){var e;return e=h.analyse(t).loader,e&&this.loaders[e]?this.loaders[e]:this.defaultLoader},n.prototype.setRegion=function(t){return this.region=t,this.regions.unshift(this.region)},n.prototype.load=function(){var t,e;return e=1<=arguments.length?slice.call(arguments,0):[],this.Promise.chain(function(){var n,r,i;for(i=[],n=0,r=e.length;r>n;n++)t=e[n],i.push(this.getLoader(t).loadModule(t));return i}.call(this))},n.prototype.show=function(t,e){return this.region.show(t,e)},n.prototype.destory=function(){var t;return this.Promise.chain(function(){var e,n,r,i;for(r=this.regions,i=[],e=0,n=r.length;n>e;e++)t=r[e],i.push(t.close());return i}.call(this)),this.off()},n.prototype.startRoute=function(){var t,e,n;return t=arguments[0],e=2<=arguments.length?slice.call(arguments,1):[],this.router||(this.router=new s.Router(this)),this.Promise.chain((n=this.router).mountRoutes.apply(n,e),function(){return this.router.start(t)})},n.prototype.navigate=function(t,e){return this.router.navigate(t,e)},n.prototype.message={success:function(t,e){return alert(e||t)},info:function(t,e){return e||(e=t),alert(e||t)},error:function(t,e){return e||(e=t),alert(e||t)}},n}(s.Base),s.include(i,s.Event),s.Model=l=function(t){function e(t,n,r){this.app=t,this.module=n,null==r&&(r={}),this.data=r.data||{},this.params=s.extend({},r.params),e.__super__.constructor.call(this,"D",r),this.app.delegateEvent(this)}return extend(e,t),e.prototype.url=function(){return this.getOptionValue("url")||""},e.prototype.getFullUrl=function(){return s.Request.url(this)},e.prototype.getParams=function(){return s.extend({},this.params)},e.prototype.set=function(t){var e;return e=s.isFunction(this.options.parse)?this.options.parse.call(this,t):t,this.data=this.options.root?e[this.options.root]:e,this.changed(),this},e.prototype.changed=function(){return this.trigger("change")},e.prototype.append=function(t){return s.isObject(this.data)?s.extend(this.data,t):s.isArray(this.data)&&(this.data=this.data.concat(s.isArray(t)?t:[t])),this.changed(),this},e.prototype.clear=function(){return this.data={},this.changed(),this},e.prototype.find=function(t,e){var n,r,i,o;if(s.isObject(this.data))return this.data[t];for(i=this.data,o=[],n=0,r=i.length;r>n;n++)w=i[n],w[t]===e&&o.push(w);return o},e.prototype.findOne=function(t,e){var n;return n=this.find(t,e),n?s.isObject(this.data)?n:n[0]:n},e}(s.Base),s.Region=f=function(t){function e(t,r,i,o){this.app=t,this.module=r,this.el=i,this.name=null!=o?o:"region",this.el||this.error("The DOM element for region is not found"),this.dd=new n,e.__super__.constructor.call(this,"R")}return extend(e,t),e.prototype.isCurrent=function(t){return this.current?s.isObject(t)&&t.id===this.current.id?!0:s.isString(t)&&s.Loader.analyse(t).name===this.current.name?!0:!1:!1},e.prototype.show=function(t,e){return null==e&&(e={}),this.isCurrent(t)?e.forceRender===!1?this.Promise.resolve(this.current):this.Promise.chain(this.current.render(e),this.current):(s.isString(t)&&(t=this.app.getLoader(t).loadModule(t)),this.Promise.chain(t,function(t){return t.render&&t.setRegion||this.error("Can not render "+t),t},[function(t){return this.Promise.chain(function(){return t.region?t.region.close():void 0},t)},function(){return this.close()}],function(t){var e;return e=t[0],this.current=e,this.Promise.chain(e.setRegion(this),e)},function(t){return t.render(e)}))},e.prototype.close=function(){return this.Promise.chain(function(){return this.current?this.current.close():void 0},function(){return delete this.current,this})},e.prototype.getEl=function(){return this.el},e.prototype.$$=function(t){return r.getElementsBySelector(t,this.el)},e.prototype.update=function(t){return this.dd.apply(this.el,this.dd.diff(this.el,t))},e.prototype.empty=function(){return this.el.innerHTML=""},e.prototype.delegateDomEvent=function(t,e,n,i){var o;return o=e+".events"+this.id+t.id,r.delegateDomEvent(this.el,o,n,i)},e.prototype.undelegateDomEvents=function(t){return r.undelegateDomEvents(this.el,".events"+this.id+t.id)},e}(s.Base),s.extend(s.Region,s.Factory),s.View=y=function(t){function e(t,n,r,i){this.name=t,this.module=n,this.loader=r,null==i&&(i={}),this.app=this.module.app,this.eventHandlers=i.handlers||{},this.components={},e.__super__.constructor.call(this,"V",i),this.app.delegateEvent(this)}return extend(e,t),e.ComponentManager={handlers:{},componentCache:{},createDefaultHandler:function(t){return{creator:function(e,n,r){return n[t](r)},destructor:function(e,n,r){return n[t]("destroy")}}},register:function(t,e,n){return null==n&&(n=function(){}),this.handlers[t]={creator:e,destructor:n}},create:function(t,e){var n,r,i,o,u,a;return null==e&&(e={}),i=e.id,o=e.name,a=e.selector,u=e.options,o||t.error("Component name can not be null"),this.handlers[o]||el[o]||t.error("No component handler for name:"+o),r=this.handlers[o]||createDefaultHandler(o),n=a?t.$$(a):t.$(i),n||0!==n.length||a||(n=t.getEl()),i||(i=s.uniqueId()),t.Promise.chain(r.creator(t,n,u),function(e){return componentCache[t.id+i]={handler:r,id:i,options:u},{id:i,component:e}})},destroy:function(t,e,n){var r,i;return i=this.componentCache[e.id+t],delete this.componentCache[e.id+t],"function"==typeof(r=i.handler).destructor?r.destructor(e,n,i.options):void 0}},e.prototype.initialize=function(){return this.options.extend&&this.extend(this.options.extend),this.loadedPromise=this.Promise.chain([this.loadTemplate(),this.bindData()])},e.prototype.loadTemplate=function(){var t;return this.module.separatedTemplate!==!0?this.Promise.chain(this.module.loadedPromise,function(){return this.template=this.module.template}):(t=this.getOptionValue("template")||this.name,this.Promise.chain(this.app.getLoader(t).loadSeparatedTemplate(this,t),function(t){return this.template=t}))},e.prototype.bindData=function(){return this.Promise.chain(this.module.loadedPromise,function(){var t,e,n,r,i,o;t=this.getOptionValue("bind")||{},this.data={},e=function(t){return function(e){return t.listenTo(e,"change",function(){return t.render(t.renderOptions)})}}(this),i=[];for(n in t)o=t[n],r=this.data[n]=this.module.store[n],r||this.error("No model: "+n),i.push(o===!0?e(r):void 0);return i})},e.prototype.unbindData=function(){return this.stopListening(),delete this.data},e.prototype.getEl=function(){return this.region?this.region.getEl(this):null},e.prototype.$=function(t){return this.$$("#"+this.wrapDomId(t))[0]},e.prototype.$$=function(t){return this.region.$$(t)},e.prototype.setRegion=function(t){return this.region=t,this.virtualEl=this.getEl().cloneNode(),this.bindEvents()},e.prototype.close=function(){return this.region?this.Promise.chain(function(){var t;return null!=(t=this.options.beforeClose)?t.call(this):void 0},this.beforeClose,[this.unbindEvents,this.unbindData,this.destroyComponents,function(){return this.region.empty(this)}],function(){var t;return null!=(t=this.options.afterClose)?t.call(this):void 0},this.afterClose,function(){return delete this.region},this):this.Promise.resolve(this)},e.prototype.wrapDomId=function(t){return""+this.id+t},e.prototype.bindEvents=function(){var t,e,n,i,o;n=this,t=this.getOptionValue("events")||{},i=[];for(e in t)o=t[e],s.isString(o)&&i.push(function(t){return function(e,i){var o,s,u,a,h,l,p;return a=e.replace(/(^\s+)|(\s+$)/g,"").split(/\s+/),u=a[0],s=a[1],t.eventHandlers[i]||t.error("No event handler: "+i),s||t.error("Id is required"),l="*"===s.slice(-1),p=t.wrapDomId(l?s.slice(0,-1):s),h=l?"[id^="+p+"]":"#"+p,o=function(t){var e,o;return o=t.target||t.srcElement,r.hasClass(o,"disabled")?void 0:(e=[t],l&&e.unshift(o.getAttribute("id").slice(p.length)),n.eventHandlers[i].apply(n,e))},t.region.delegateDomEvent(t,u,h,o)}}(this)(e,o));return i},e.prototype.unbindEvents=function(){return this.region.undelegateDomEvents(this)},e.prototype.render=function(t){return null==t&&(t={}),this.region||this.error("No region"),this.renderOptions=t,this.Promise.chain(this.loadedPromise,this.destroyComponents,function(){var t;return null!=(t=this.options.beforeRender)?t.call(this):void 0},this.beforeRender,this.serializeData,this.renderTemplate,this.renderComponent,this.afterRender,function(){var t;return null!=(t=this.options.afterRender)?t.call(this):void 0},this)},e.prototype.serializeData=function(){var t,e,n,r,i;e={},r=this.data;for(n in r)i=r[n],e[n]=i.data;t=this.getOptionValue("dataForTemplate")||{};for(n in t)i=t[n],e[n]=i.call(this,e);return e.Global=this.app.global,e.View=this,e},e.prototype.renderTemplate=function(t){var e,n,i,o,s,u,a,h,l,p,c,f,d,g;for(this.virtualEl.innerHTML=this.template(t),f={},l=r.getElementsBySelector("[id]",this.virtualEl),i=0,s=l.length;s>i;i++)w=l[i],n=w.getAttribute("id"),f[n]&&this.error(n+" already used"),f[n]=!0,w.setAttribute("id",this.wrapDomId(n));for(p=this.app.options.attributesReferToId||[],o=0,u=p.length;u>o;o++)for(e=p[o],c=r.getElementsBySelector("["+e+"]",this.virtualEl),h=0,a=c.length;a>h;h++)w=c[h],d=w.getAttribute(e),g="#"===d.charAt(0),w.setAttribute(e,g?"#"+this.wrapDomId(d.slice(1)):this.wrapDomId(d));return this.region.update(this.virtualEl)},e.prototype.renderComponent=function(){var t,n,r;return n=this.getOptionValue("components")||[],r=function(){var r,i,o;for(o=[],r=0,i=n.length;i>r;r++)t=n[r],s.isFunction(t)&&(t=t.apply(this)),o.push(t?e.ComponentManager.create(this,t):void 0);return o}.call(this),this.Promise.chain(r,function(e){return function(n){var r,i,o,s,u;for(u=[],i=0,o=n.length;o>i;i++)s=n[i],r=s.id,t=s.component,comp&&u.push(e.components[r]=t);return u}}(this))},e.prototype.destroyComponents=function(){var t,n,r;n=this.components||{};for(t in n)r=n[t],e.ComponentManager.destroy(t,this,r);return this.components={}},e.prototype.beforeRender=function(){},e.prototype.afterRender=function(){},e.prototype.beforeClose=function(){},e.prototype.afterClose=function(){},e}(o),a=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return extend(e,t),e.prototype.initialize=function(){return this.isLayout=!0,this.loadedPromise=this.loadTemplate()},e}(s.View),s.Module=p=function(t){function e(t,n,r,i){this.name=t,this.app=n,this.loader=r,null==i&&(i={}),this.separatedTemplate=i.separatedTemplate===!0,this.regions={},e.__super__.constructor.call(this,"M",i),this.app.modules[this.id]=this,this.app.delegateEvent(this)}return extend(e,t),e.Layout=a,e.prototype.initialize=function(){return this.options.extend&&this.extend(this.options.extend),this.loadedPromise=this.Promise.chain([this.loadTemplate(),this.loadItems()]),this.initLayout(),this.initStore()},e.prototype.initLayout=function(){var t;return t=this.getOptionValue("layout")||{},this.layout=new a("layout",this,this.loader,t)},e.prototype.initStore=function(){var t,e,n,r,i;this.store={},this.autoLoadBeforeRender=[],this.autoLoadAfterRender=[],t=function(t){return function(e,n){return s.isFunction(n)&&(n=n.call(t)),n&&n.autoLoad&&(n.autoLoad===!0?t.autoLoadBeforeRender:t.autoLoadAfterRender).push(e),t.store[e]=new s.Model(t.app,t,n)}}(this),n=this.getOptionValue("store")||{},r=[];for(e in n)i=n[e],r.push(t(e,i));return r},e.prototype.loadTemplate=function(){return this.separatedTemplate?void 0:this.Promise.chain(this.loader.loadTemplate(this),function(t){return this.template=t})},e.prototype.loadItems=function(){var t,e,n;return this.items={},this.inRegionItems={},t=function(t){return function(e,n){var r;return s.isFunction(n)&&(n=n.call(t)),s.isString(n)&&(n={region:n}),r=n.isModule?"loadModule":"loadView",t.Promise.chain(t.app.getLoader(e)[r](e,t,n),function(t){return t.moduleOptions=n,this.items[e]=t,n.region?this.inRegionItems[e]=t:void 0})}}(this),this.Promise.chain(function(){var r,i;r=this.getOptionValue("items")||{},i=[];for(e in r)n=r[e],i.push(t(e,n));return i}.call(this))},e.prototype.setRegion=function(t){return this.region=t,this.Promise.chain(function(){return this.layout.setRegion(this.region)},function(){return this.layout.render()},this.initRegions)},e.prototype.close=function(){return this.Promise.chain(function(){var t;return null!=(t=this.options.beforeClose)?t.call(this):void 0},this.beforeClose,function(){return this.layout.close()},this.closeRegions,this.afterClose,function(){var t;return null!=(t=this.options.afterClose)?t.call(this):void 0},function(){return delete this.app.modules[this.id]},this)},e.prototype.render=function(t){return null==t&&(t={}),this.region||this.error("No region"),this.renderOptions=t,this.Promise.chain(this.loadedPromise,function(){var t;return null!=(t=this.options.beforeRender)?t.call(this):void 0},this.beforeRender,this.fetchDataBeforeRender,this.renderItems,this.afterRender,function(){var t;return null!=(t=this.options.afterRender)?t.call(this):void 0},this.fetchDataAfterRender,this)},e.prototype.closeRegions=function(){var t,e,n,r,i;n=this.regions,delete this.regions,e=n||{},r=[];for(t in e)i=e[t],r.push(i.close());return r},e.prototype.initRegions=function(){var t,e,n,r,i,o;for(this.regions&&this.closeRegions(),this.regions={},r=this.layout.$$("[data-region]"),i=[],e=0,n=r.length;n>e;e++)w=r[e],t=w.getAttribute("data-region"),o=w.getAttribute("region-type"),i.push(this.regions[t]=s.Region.create(o,this.app,this,w,t));return i},e.prototype.renderItems=function(){var t,e,n,r;e=this.inRegionItems,n=[];for(t in e)r=e[t],this.regions[t]||this.error("Region:"+t+" is not defined"),n.push(this.regions[t].show(r));return n},e.prototype.fetchDataBeforeRender=function(){var t;return this.Promise.chain(function(){var e,n,r,i;for(r=this.autoLoadBeforeRender,i=[],e=0,n=r.length;n>e;e++)t=r[e],i.push(s.Request.get(this.store[t]));return i}.call(this))},e.prototype.fetchDataAfterRender=function(){var t;return this.Promise.chain(function(){var e,n,r,i;for(r=this.autoLoadAfterRender,i=[],e=0,n=r.length;n>e;e++)t=r[e],i.push(s.Request.get(this.store[t]));return i}.call(this))},e.prototype.beforeRender=function(){},e.prototype.afterRender=function(){},e.prototype.beforeClose=function(){},e.prototype.afterClose=function(){},e}(s.Base),s.Loader=h=function(t){function e(t){this.app=t,this.name="default",this.fileNames=this.app.options.fileNames,e.__super__.constructor.call(this,"L")}return extend(e,t),e.analyse=function(t){var e,n,r;return s.isString(t)?(r=t.split(":"),n=r[0],t=r[1],e=3<=r.length?slice.call(r,2):[],t||(t=n,n=null),{loader:n,name:t,args:e}):{loader:null,name:t}},e.prototype.loadResource=function(t){return t=this.app.options.scriptRoot+"/"+t,this.Promise.create(function(e,n){var r;return this.app.options.amd?(r=function(r){var i;if((null!=(i=r.requireModules)?i[0]:void 0)===t)return define(t,null),require.undef(t),require([t],function(){}),e(null);throw n(null),r},require([t],function(t){return e(t)},r)):e(require(t))})},e.prototype.loadModuleResource=function(t,e){return this.loadResource(t.name+"/"+e)},e.prototype.loadModule=function(t,n){var r;return r=e.analyse(t).name,this.Promise.chain(this.loadResource(r+"/"+this.fileNames.module),function(t){return function(e){var i;return i=new s.Module(r,t.app,t,e),n&&(i.module=n),i}}(this))},e.prototype.loadView=function(t,n,r){return t=e.analyse(t).name,this.Promise.chain(this.loadModuleResource(n,this.fileNames.view+t),function(e){return function(r){return new s.View(t,n,e,r)}}(this))},e.prototype.loadTemplate=function(t){return this.loadModuleResource(t,this.fileNames.templates)},e.prototype.loadSeparatedTemplate=function(t,e){return this.loadModuleResource(module,this.fileNames.template+e)},e.prototype.loadRouter=function(t){var n;return n=e.analyse(t).name,t=n+"/"+this.fileNames.router,this.loadResource(t)},e}(s.Base),s.SimpleLoader=m=function(t){function e(){e.__super__.constructor.apply(this,arguments),this.name="simple"}return extend(e,t),e.prototype.loadModule=function(t,e){var n,r;return r=h.analyse(t).name,n=new s.Module(r,this.app,this,{separatedTemplate:!0}),e&&(n.parentModule=e),this.Promise.resolve(n)},e.prototype.loadView=function(t,e,n){return t=h.analyse(t).name,this.Promise.resolve(new s.View(t,e,this,{}))},e}(s.Loader),_=t.history&&"pushState"in t.history,d=function(){function t(t,e,n,r){var i;this.app=t,this.router=e,this.path=n,this.fn=r,i=this.path.replace(this.regExps[0],this.regExps[1]).replace(this.regExps[2],this.regExps[3]),this.pattern=new RegExp("^"+i+"$",this.app.options.caseSensitiveHash?"g":"gi")}return t.prototype.regExps=[/:([\w\d]+)/g,"([^/]+)",/\*([\w\d]+)/g,"(.*)"],t.prototype.match=function(t){return this.pattern.lastIndex=0,this.pattern.test(t)},t.prototype.handle=function(t){var e,n,r,i,o,s;return this.pattern.lastIndex=0,e=this.pattern.exec(t).slice(1),r=this.router.getInterceptors(this.path),r.push(this.fn),n=function(){var t,n,o;for(o=[],i=t=0,n=r.length;n>t;i=++t)s=r[i],o.push(function(t){return function(n,r){return function(i){return n.apply(t.router,r>0?[i].concat(e):e)}}}(this)(s,i));return o}.call(this),(o=this.router.Promise).chain.apply(o,n)},t}(),s.Router=g=function(e){function n(t){this.app=t,this.routes=[],this.routeMap={},this.interceptors={},this.started=!1,n.__super__.constructor.call(this,"R")}return extend(n,e),n.prototype.initialize=function(){return this.addRoute("/",this.app.options.defaultRouter||{})},n.prototype.getHash=function(){return t.location.hash.slice(1)},n.prototype.start=function(e){var n,i;if(!this.started)return this.started=!0,i=_?"popstate.dr":"hashchange.dr",r.delegateDomEvent(t,i,null,function(t){return function(){return t.dispatch(t.getHash())}}(this)),(n=this.getHash())?this.navigate(n):e?this.navigate(e):void 0},n.prototype.stop=function(){return r.undelegateDomEvents(t,".dr"),this.started=!1},n.prototype.dispatch=function(t){var e,n,r,i;if(this.previousHash!==t)for(this.previousHash=t,r=this.routes,e=0,n=r.length;n>e;e++)if(i=r[e],i.match(t))return i.handle(t)},n.prototype.navigate=function(e,n){return null==n&&(n=!0),_?t.history.pushState({},t.document.title,"#"+e):t.location.replace("#"+e),n?this.dispatch(e):void 0},n.prototype.mountRoutes=function(){var t,e;return e=1<=arguments.length?slice.call(arguments,0):[],this.Promise.chain(function(){var n,r,i;for(i=[],n=0,r=e.length;r>n;n++)t=e[n],i.push(this.app.getLoader(t).loadRouter(t));return i}.call(this),function(t){var n,r,i,o,s;for(o=[],n=r=0,i=t.length;i>r;n=++r)s=t[n],o.push(this.addRoute(e[n],s));return o})},n.prototype.addRoute=function(t,e){var n,r,i,o,u,a,h,l;h=e.routes,n=e.interceptors,s.isFunction(h)&&(h=h.call(this)),s.isFunction(n)&&(n=n.call(this)),o=n||{};for(r in o)l=o[r],this.interceptors[v(t,r)]=l;u=h||{},a=[];for(r in u)l=u[r],i=v(t,r),s.isFunction(e[l])||this.error("Route ["+i+"] is not defined"),a.push(this.routes.unshift(new d(this.app,this,v(t,r),e[l])));return a},n.prototype.getInterceptors=function(t){var e,n,r;for(r=this.interceptors[""]?[this.interceptors[""]]:[],e=t.split("/");e.length>0;)n=e.join("/"),this.interceptors[n]&&r.unshift(this.interceptors[n]),e.pop();return r},n}(s.Base),s.Helpers={layout:function(t,e,n){return this.View.isLayout?n.fn(this):""},view:function(t,e,n,r){return this.View.isLayout||this.View.name!==n?"":r.fn(this)}},u});