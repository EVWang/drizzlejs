{"version":3,"sources":["drizzle.min.js","drizzle.js"],"names":["root","factory","define","amd","exports","module","Drizzle","this","_possibleConstructorReturn","self","call","ReferenceError","_inherits","subClass","superClass","TypeError","prototype","Object","create","constructor","value","enumerable","writable","configurable","setPrototypeOf","__proto__","_toConsumableArray","arr","Array","isArray","i","arr2","length","from","_classCallCheck","instance","Constructor","_get","get","object","property","receiver","Function","desc","getOwnPropertyDescriptor","undefined","parent","getPrototypeOf","getter","_slicedToArray","sliceIterator","_arr","_n","_d","_e","_s","_i","Symbol","iterator","next","done","push","err","_createClass","defineProperties","target","props","descriptor","defineProperty","key","protoProps","staticProps","_typeof","obj","D","slice","EMPTY","map","fn","result","mapObj","hasOwnProperty","clone","isObject","_ret","v","typeCache","View","Region","Module","Model","Store","register","type","name","clazz","Clazz","_len","arguments","args","_key","bind","apply","concat","counter","window","item","toString","_len2","_key2","assign","uniqueId","prefix","adapt","Adapter","Promise","ajax","params","xhr","XMLHttpRequest","url","data","k","join","open","promise","resolve","reject","onload","status","JSON","parse","response","onerror","send","ajaxResult","getEventTarget","e","getFormData","el","Error","addEventListener","handler","useCapture","removeEventListener","hasClass","classList","contains","addClass","add","removeClass","remove","Promiser","context","_this","items","_this2","_len3","_key3","thenables","indexMap","isFunction","then","all","as","_this3","_len4","_key4","prev","doRing","rings","ring","nextRing","shift","parallel","Event","on","ctx","_events","off","trigger","_len5","_key5","delegateEvent","to","me","id","_listeners","listenTo","stopListening","offIt","_len6","_key6","unshift","Request","model","options","_ajax","post","put","del","save","_idKey","_url","parts","_option","urlRoot","app","urlSuffix","base","indexOf","pop","method","_len7","_key7","set","slient","_len8","_key8","ComponentManager","_handlers","_componentCache","setDefaultHandler","creator","destructor","_defaultHandler","_create","renderable","_this4","selector","opt","_error","dom","$$","$","uid","chain","component","cid","cache","index","_destroy","_this5","current","Base","defaults","mixin","_mixin","_loadedPromise","_initialize","_len9","_key9","message","isString","_len10","rest","_key10","_this6","old","_len11","_key11","_Promise","Renderable","_D$Base","mod","loader","_this7","components","_loader","_componentMap","_eventHandlers","_this8","_templateEngine","_load","_initializeEvents","_ref","_ref2","template","_template","_render","renderOptions","_wrapDomId","_element","querySelectorAll","_this9","update","_region","_destroyComponents","_beforeRender","_serializeData","_renderTemplate","_renderComponents","_afterRender","region","_bindEvents","_this10","_beforeClose","_unbindEvents","_empty","_afterClose","Global","global","Self","_execute","events","_this11","replace","split","eventType","haveStar","_createEventHandler","handlerName","_ref3","_this12","disabledClass","event","getAttribute","_this13","_delegateDomEvent","_undelegateDomEvents","_this14","_this15","_getElement","RenderableContainer","_D$Renderable","_items","_initializeItems","_initializeRegions","_renderItems","_closeRegions","_this17","isModule","moduleOptions","_this18","_regions","closeRegions","_createRegion","_this19","regions","show","close","ActionCreator","_D$Renderable2","isAction","_createAction","_this21","_ref4","dataForAction","_ref5","actionCallback","_getActionPayload","payload","dispatch","rootEl","targetName","tagName","parentNode","_D$ActionCreator","bindings","_initializeDataBinding","_this23","_dataBinding","store","models","render","_this24","_get2","_len12","_key12","_bindData","_get3","_len13","_key13","_unbindData","_this25","_D$RenderableContaine","_modules","_initializeStore","_store","_createStore","_destory","_this27","_loadEagerModels","_this28","_loadLazyModels","CAPTURES","_D$Base2","_this29","_el","_delegated","_this30","_isCurrent","forceRender","_current","_createModule","_ref6","_ref7","attr","setAttribute","_setRegion","_this31","_close","innerHTML","_this32","els","matched","listener","_createDelegateListener","_this33","TemplateEngine","_D$Base3","_templateCache","_this35","used","attrs","withHash","charAt","wrapped","_loadIt","loadModuleResource","executeIdReplacement","_D$Base4","_this36","_models","_callbacks","_callbackContext","callback","n","p","_initializeModels","_this37","shared","viewport","_createModel","autoLoad","_D$Base5","_this38","_data","idKey","_params","d","changed","cloneIt","Loader","_D$Base6","path","_this40","_app$options","scriptRoot","getResource","fullPath","require","loadResource","fileNames","view","router","Application","_D$Base7","caseSensitiveHash","defaultRegion","document","body","_loaders","registerLoader","isDefault","_defaultLoader","defaultHash","_router","_this42","Router","_mountRoutes","_start","_stop","hash","navigate","moduleName","parentModule","_this43","_D$Loader$_analyse","_analyse","loaderName","_getLoader","loadModule","createModule","_this44","_D$Loader$_analyse2","viewName","loadView","createView","_D$Loader$_analyse3","regionName","createRegion","createStore","createModel","PUSH_STATE_SUPPORTED","history","ROUTER_REGEXPS","Route","pattern","RegExp","lastIndex","test","_router2","_this45","exec","handlers","_getInterceptors","_D$Base8","_this46","_routes","_interceptors","_started","_EVENT_HANDLER","_dispath","_getHash","pushState","title","location","defaultPath","_previousHash","route","match","handle","_this47","paths","loadRouter","option","_addRoute","_this48","routes","interceptors","PAGE_DEFAULT_OPTIONS","pageSize","pageKey","pageSizeKey","recordCountKey","PageableModel","_D$Model","_this49","_p","page","pageCount","recordCount","Math","ceil","turnToPage","_p2","start","end","total","registerModel","MultiRegion","_D$Region","_elements","_this51","str","_ref8","_ref9","createElement","appendChild","_createElement","removeChild","_this52"],"mappings":"CAAE,SAASA,EAAMC,GACO,kBAAXC,SAAyBA,OAAOC,IACzCD,UAAWD,GACiB,gBAAZG,SAChBC,OAAOD,QAAUH,IAEjBD,EAAKM,QAAUL,KAEjBM,KAAM,WACR,YAUA,SAASC,GAA2BC,EAAMC,GAAQ,IAAKD,EAAQ,KAAM,IAAIE,gBAAe,4DAAgE,QAAOD,GAAyB,gBAATA,IAAqC,kBAATA,GAA8BD,EAAPC,EAElO,QAASE,GAAUC,EAAUC,GAAc,GAA0B,kBAAfA,IAA4C,OAAfA,EAAuB,KAAM,IAAIC,WAAU,iEAAoED,GAAeD,GAASG,UAAYC,OAAOC,OAAOJ,GAAcA,EAAWE,WAAaG,aAAeC,MAAOP,EAAUQ,YAAY,EAAOC,UAAU,EAAMC,cAAc,KAAeT,IAAYG,OAAOO,eAAiBP,OAAOO,eAAeX,EAAUC,GAAcD,EAASY,UAAYX,GAEje,QAASY,GAAmBC,GAAO,GAAIC,MAAMC,QAAQF,GAAM,CAAE,IAAK,GAAIG,GAAI,EAAGC,EAAOH,MAAMD,EAAIK,QAASF,EAAIH,EAAIK,OAAQF,IAAOC,EAAKD,GAAKH,EAAIG,EAAM,OAAOC,GAAe,MAAOH,OAAMK,KAAKN,GCvB1L,QAAAO,GAAAC,EAAAC,GAAA,KAAAD,YAAAC,IAAA,KAAA,IAAArB,WAAA,qCDWA,GAAIsB,GAAO,QAASC,GAAIC,EAAQC,EAAUC,GAA2B,OAAXF,IAAiBA,EAASG,SAAS1B,UAAW,IAAI2B,GAAO1B,OAAO2B,yBAAyBL,EAAQC,EAAW,IAAaK,SAATF,EAAoB,CAAE,GAAIG,GAAS7B,OAAO8B,eAAeR,EAAS,OAAe,QAAXO,EAAmB,OAAkCR,EAAIQ,EAAQN,EAAUC,GAAoB,GAAI,SAAWE,GAAQ,MAAOA,GAAKvB,KAAgB,IAAI4B,GAASL,EAAKL,GAAK,IAAeO,SAAXG,EAA4C,MAAOA,GAAOtC,KAAK+B,IAExdQ,EAAiB,WAAc,QAASC,GAAcvB,EAAKG,GAAK,GAAIqB,MAAeC,GAAK,EAAUC,GAAK,EAAWC,EAAKT,MAAW,KAAM,IAAK,GAAiCU,GAA7BC,EAAK7B,EAAI8B,OAAOC,cAAmBN,GAAMG,EAAKC,EAAGG,QAAQC,QAAoBT,EAAKU,KAAKN,EAAGnC,QAAYU,GAAKqB,EAAKnB,SAAWF,GAA3DsB,GAAK,IAAoE,MAAOU,GAAOT,GAAK,EAAMC,EAAKQ,EAAO,QAAU,KAAWV,GAAMI,EAAG,WAAWA,EAAG,YAAe,QAAU,GAAIH,EAAI,KAAMC,IAAQ,MAAOH,GAAQ,MAAO,UAAUxB,EAAKG,GAAK,GAAIF,MAAMC,QAAQF,GAAQ,MAAOA,EAAY,IAAI8B,OAAOC,WAAYzC,QAAOU,GAAQ,MAAOuB,GAAcvB,EAAKG,EAAa,MAAM,IAAIf,WAAU,4DAEllBgD,EAAe,WAAc,QAASC,GAAiBC,EAAQC,GAAS,IAAK,GAAIpC,GAAI,EAAGA,EAAIoC,EAAMlC,OAAQF,IAAK,CAAE,GAAIqC,GAAaD,EAAMpC,EAAIqC,GAAW9C,WAAa8C,EAAW9C,aAAc,EAAO8C,EAAW5C,cAAe,EAAU,SAAW4C,KAAYA,EAAW7C,UAAW,GAAML,OAAOmD,eAAeH,EAAQE,EAAWE,IAAKF,IAAiB,MAAO,UAAU/B,EAAakC,EAAYC,GAAiJ,MAA9HD,IAAYN,EAAiB5B,EAAYpB,UAAWsD,GAAiBC,GAAaP,EAAiB5B,EAAamC,GAAqBnC,MAE5hBoC,EAA4B,kBAAXf,SAAoD,gBAApBA,QAAOC,SAAwB,SAAUe,GAAO,aAAcA,IAAS,SAAUA,GAAO,MAAOA,IAAyB,kBAAXhB,SAAyBgB,EAAItD,cAAgBsC,OAAS,eAAkBgB,ICP1OnE,KACAoE,EAAApE,EDyBIqE,KCxBJA,MACAC,EAAA,aACAC,EAAA,SAAAlD,EAAAmD,GAEA,GAAAC,KACA,KAAApD,EAAA,MAAAoD,EACA,IAAApD,EAAAkD,IAAA,MAAAlD,GAAAkD,IAAAC,EDyBI,KAAK,GAAIhD,GAAI,EAAGA,EAAIH,EAAIK,OAAQF,ICtBpCiD,EAAAlB,KAAAiB,EAAAnD,EAAAG,GAAAA,EAAAH,GDyBI,OCvBJoD,IAEAC,EAAA,SAAAP,EAAAK,GACA,GAAAC,MAEAV,EAAAxB,MACA,KAAA4B,EAAA,MAAAM,EACA,KAAAV,IAAAI,GACAC,EAAAO,eAAAvE,KAAA+D,EAAAJ,IAAAU,EAAAlB,KAAAiB,EAAAL,EAAAJ,GAAAA,EAAAI,GACA,OAAAM,ID2BIG,EAAQ,QC3BZA,GAAAjB,GD4BI,GAAIS,EAAES,SAASlB,GAAS,CACpB,GAAImB,GAAO,WACP,GAAIL,KC1BhB,OAHAC,GAAAf,EAAA,SAAA7C,EAAAiD,GD+BgB,MAAOU,GAAOV,GAAOa,EAAM9D,MAG3BiE,EC/BhBN,KAGA,IAAA,YAAA,mBAAAK,GAAA,YAAAZ,EAAAY,IAAA,MAAAA,GAAAC,EAIA,MAAAX,GAAA7C,QAAAoC,GDgCeY,EAAIZ,EAAQ,SAAU7C,GC9BrC,MAAA8D,GAAA9D,KAKA6C,GDgCIqB,GCjCJC,QAAAC,UAAAC,UAAAC,SAAAC,SDoCIC,SAAU,SAAkBC,EAAMC,EAAMC,GClC5CxF,KAAAsF,GAAAC,GAAAC,GAEA7E,OAAA,SAAA2E,EAAAC,GAEA,IAAA,GDkCYE,GAAQzF,KAAKsF,GAAMC,IAASpB,EAAEmB,GClC1CI,EAAAC,UAAAlE,OAAAmE,EAAAvE,MAAAqE,EAAA,EAAAA,EAAA,EAAA,GAAAG,EAAA,EAAAH,EAAAG,EAAAA,IDqCYD,EAAKC,EAAO,GAAKF,UAAUE,ECjCvC,OAAA,KAAA1D,SAAA1B,UAAAqF,KAAAC,MAAAN,GAAA,MAAAO,OAAAJ,OAIAK,EAAA,EDqCIxG,ECpCJ,IDsCsB,oBAAXyG,UCnCXzG,EAAAyG,QDuCA5B,GCtCA,WAAA,QAAA,SAAA,UAAA,SAAA6B,GACAhC,EAAA,KAAAgC,GAAA,SAAAjC,GDuCQ,MAAOC,GAAEiC,SAASjG,KAAK+D,KAAS,WCvCxCiC,EAAA,OD2CA7B,GAAK,SC3CL,OAAA,SAAA,QAAA,SAAA,SAAA6B,GD4CIhC,EC5CJ,WAAAgC,GAAA,SAAAZ,EAAAC,GACA,MAAAT,GAAAM,SAAAc,EAAAZ,EAAAC,IAEAT,EAAA,SAAAoB,GAAA,SAAAZ,GACA,IAAA,GAAAc,GAAAV,UAAAlE,OAAAmE,EAAAvE,MAAAgF,EAAA,EAAAA,EAAA,EAAA,GAAAC,EAAA,EAAAD,EAAAC,EAAAA,IAAAV,EAAAU,EAAA,GAAAX,UAAAW,EAEA,OAAAvB,GAAApE,OAAAoF,MAAAhB,GAAAoB,EAAAZ,GAAAS,OAAAJ,ODkDAlF,OC7CA6F,OAAApC,GD8CIqC,SAAU,WC5Cd,GAAAC,GAAAd,UAAAlE,QAAA,GAAAa,SAAAqD,UAAA,GAAA,GAAAA,UAAA,ED+CQ,OAAO,GAAKc,KAAWR,GC3C/BS,MAAA,SAAAxC,GACAxD,OAAA6F,OAAApC,EAAAwC,QAAAzC,MAEAC,EAAAwC,SACAC,QAAAA,QAEAC,KAAA,SAAAC,GACA,GAAAC,GAAA,GAAAC,gBACAC,EAAAH,EAAAG,GACA,SD+CYH,EC/CZxB,MAAAwB,EAAAI,OAAAD,GAAA,IAAAxC,EAAAqC,EAAAI,KAAA,SAAApC,EAAAqC,GACA,MAAAA,GAAA,IAAArC,IDgDWsC,KC/CX,MDgDQL,EAAIM,KAAKP,EAAOxB,KAAM2B,GAAK,EC9CnC,IAAAK,GAAA,GAAAV,SAAA,SAAAW,EAAAC,GACAT,EAAAU,OAAA,WACA,MAAAzH,MAAA0H,QAAA,KAAA1H,KAAA0H,OAAA,QACAH,GAAAI,KAAAC,MAAA5H,KAAA6H,eAGAL,GAAAT,IAEAA,EAAAe,QAAA,WAEAN,EAAAT,KAEA,OAAAA,GAAAgB,KAAAjB,EAAAI,MAAAI,GAEAU,WAAA,SAAApC,GACA,MAAAA,GAAA,IAGAqC,eAAA,SAAAC,GACA,MAAAA,GAAAxE,QAGAyE,YAAA,SAAAC,GAAA,KAAA,IAAAC,OAAA,iCAAAD,IAEAE,iBAAA,SAAAF,EAAA7C,EAAAgD,EAAAC,GAAAJ,EAAAE,iBAAA/C,EAAAgD,EAAAC,IAEAC,oBAAA,SAAAL,EAAA7C,EAAAgD,GAAAH,EAAAK,oBAAAL,EAAA7C,EAAAgD,IACAG,SAAA,SAAAN,EAAA5C,GDoDQ,MAAO4C,GAAGO,UAAUC,SAASpD,ICjDrCqD,SADA,SACAT,EAAA5C,GDoDQ4C,EAAGO,UAAUG,IAAItD,ICnDzBuD,YAAA,SAAAX,EAAA5C,GACA4C,EAAAO,UAAAK,OAAAxD,KDyDArB,EAAEyC,QAAU,WACR,QAASqC,GAASC,GACdvH,EAAgB3B,KAAMiJ,GCvD9BjJ,KAAAkJ,QAAAA,EAiFA,MDrBI1F,GAAayF,IACTnF,IAAK,SACLjD,MAAO,SAAgB0D,GCzD/B,GAAA4E,GAAAnJ,ID4DY,OAAO,IAAImE,GAAEwC,QAAQC,QAAQ,SAAUW,EAASC,GAC5CjD,EAAGpE,KAAKgJ,EAAMD,QAAS3B,EAASC,QAIxC1D,IAAK,UACLjD,MAAO,SAAiBqG,GACpB,MAAO/C,GAAEwC,QAAQC,QC5D7BW,QAAAL,MD+DQpD,IAAK,SC/DbjD,MAAA,SAAAqG,GDiEY,MAAO/C,GAAEwC,QAAQC,QAAQY,OAAON,MC/D5CpD,IAAA,WDmEQjD,MAAO,SCnEfuI,GAEA,IAAA,GDkEgBC,GCpEhBrJ,KAEAsJ,EAAA3D,UAAAlE,OAAAmE,EAAAvE,MAAAiI,EAAA,EAAAA,EAAA,EAAA,GAAAC,EAAA,EAAAD,EAAAC,EAAAA,IACA3D,EAAA2D,EAAA,GAAA5D,UAAA4D,EAGA,OAAAvJ,MAAAW,OAAA,SAAA4G,EAAAC,GACA,GAAAhD,MDqEoBgF,KCnEpBC,IDqFgB,OCpFhBnF,GAAA8E,EAAA,SAAAjD,EAAA5E,GACA,GAAAV,GAAAyB,MDqEoB,KCnEpBzB,EAAAsD,EAAAuF,WAAAvD,GAAAA,EAAAJ,MAAAsD,EAAAH,QAAAtD,GAAAO,EACA,MAAA+B,GDsEwB,WCrExBV,GAAAU,GDuEwBrH,GAASA,EAAM8I,MCnEvCF,EAAAD,EAAA/H,QAAAF,EACAiI,EAAAlG,KAAAzC,IAAA2D,EAAAjD,GAAAV,IAIA,IAAA2I,EAAA/H,OAAA8F,EAAA/C,OAEAL,GAAAwC,QAAAC,QAAAgD,IAAAJ,GAAAG,KAAA,SAAAE,GDuEoBpF,EAAOgF,EAAU,SAAU3F,EAAKjD,GAC5B,MAAO2D,GAAO3D,GAASgJ,EAAG/F,KAE9ByD,EAAQ/C,IACT,SAAUqF,GACTrC,EAAOqC,UCxE3B/F,IAAA,QACAjD,MAAA,WDgFY,IC7EZ,GAFAiJ,GAAA9J,KAEA+J,EAAApE,UAAAlE,OAAAmE,EAAAvE,MAAA0I,GAAAC,EAAA,EAAAD,EAAAC,EAAAA,ID8EgBpE,EAAKoE,GAASrE,UAAUqE,EAG5B,IAAIC,GC5EhB,KACAC,EAAA,QAAAA,GAAAC,EAAAC,EAAA7C,EAAAC,GACA,GAAA6C,GAAA,SAAAnD,GACA+C,EAAA/C,EACA,ID4EoBiD,EC5EpB1I,OAAA8F,EAAA0C,GAAAC,EAAAC,EAAAA,EAAAG,QAAA/C,EAAAC,GD+EgB,IAAIrD,EC5EpB7C,QAAA8I,GD6EoC,IAAhBA,EAAK3I,OAAe4I,MAAeP,EAAOS,SAASxE,MAAM+D,GAASM,GAAMpE,OAAO7E,EAA2B,MAAR8I,GAAgBA,SAAcN,KAAKU,EAAU7C,OC3EnK,CACA,GAAA3G,GAAAyB,MACA,KD6EwBzB,EAAQsD,EAAEuF,WAAWU,GAAQA,EAAKrE,MAAM+D,EAAOZ,QAAiB,MAARe,GAAgBA,OAAcG,EC3E9G,MAAAlC,GAEA,WD2EwBV,GAAOU,GCxE/BrH,GAAAA,EAAA8I,KAAA9I,EAAA8I,KAAAU,EAAA7C,GAAA6C,EAAAxJ,IACA,OAAA,KAAA+E,EAAAnE,OAAAzB,KAAAuH,UAEAvH,KAAAW,OAAA,SAAA4G,EAAAC,GACA0C,EAAAtE,EAAAA,EAAA0E,QAAA/C,EAAAC,SAMAyB,KAGA9E,EAAAqG,OD+EIC,GAAI,SC9ERlF,EAAAhB,EAAAmG,GD+EQ1K,KAAK2K,UAAY3K,KAAK2K,aC7E9B3K,KAAA2K,QAAApF,KAAAvF,KAAA2K,QAAApF,QAAAjC,MAAAiB,GAAAA,EAAAmG,IAAAA,KACAE,IAAA,SAAArF,EAAAhB,GDgFQ,GChFRvE,KAAA2K,SAAApF,GAAAvF,KAAA2K,QAAApF,GDgFQ,CACA,IAAKhB,EC9Eb,kBADAvE,MAAA2K,QAAApF,EAIA,IAAAf,KDqFQ,OCpFRF,GAAAtE,KAAA2K,QAAApF,GAAA,SAAAY,GAEAA,EAAA5B,KAAAA,GAAAC,EAAAlB,KAAA6C,KDkF8B,IAAlB3B,EAAO/C,kBACAzB,MAAK2K,QAAQpF,QAGxBvF,KAAK2K,QCpFbpF,GAAAf,KDsFIqG,QCrFJ,SAAAtF,GAEA,IAAA,GAAAuF,GAAAnF,UAAAlE,OAAAmE,EAAAvE,MAAAyJ,EAAA,EAAAA,EAAA,EAAA,GAAAC,EAAA,EAAAD,EAAAC,EAAAA,IACAnF,EAAAmF,EAAA,GAAApF,UAAAoF,EDuFQ,OAAKxF,IAASvF,KAAK2K,SAAY3K,KAAK2K,QAAQpF,OCrFpDjB,GAAAtE,KAAA2K,QAAApF,GAAA,SAAAY,GACA,MAAAA,GAAA5B,GAAAwB,MAAAI,EAAAuE,IAAA9E,KDoFkE5F,MCjFlEgL,cAAA,SAAAC,GACA,GAAAC,GAAAlL,KDuFYmL,ECtFZ,KAAAF,EAAAE,GAEAzH,EAAAuH,CA6CA,OA3CAvK,QAAA6F,OAAA7C,GACA0H,cAEAC,SAAA,SAAAnH,EAAAqB,EAAAhB,EAAAmG,IACAhH,EAAA0H,WAAA7F,KAAA7B,EAAA0H,WAAA7F,QAAAjC,MAAAiB,GAAAA,EAAAL,IAAAA,IACAA,EAAAuG,GAAAlF,EAAAhB,EAAAmG,GAAAhH,IAEA4H,cAAA,SAAApH,EAAAqB,EAAAhB,GACAE,EAAAf,EAAA0H,WAAA,SAAAvK,EAAAiD,GDsFoB,GAAIU,KCpFxBF,GAAAzD,EAAA,SAAAsF,GACA,GAAAoF,GAAAhH,GAAA4B,EAAA5B,KAAAA,GAAAgB,IAAAzB,GAAAI,IAAAiC,EAAAjC,GAIA,ODkFwBqH,GAAQA,IAAUhH,GAAMgB,GAAQA,IAASzB,GAAOI,IAAQiC,EAAKjC,ICpFrFqH,EAAAA,IAAAhH,IAAAgB,GAAArB,GAAAA,IAAAiC,EAAAjC,KACAqH,EAAAA,IAAAhH,IAAAgB,IAAArB,OAEAiC,GAAAjC,IAAA0G,IAAA9G,EAAAqC,EAAA5B,QAIAC,GAAAlB,KAAA6C,KAIAzC,EAAA0H,WAAAtH,GAAAU,EACA,IAAAA,EAAA/C,cACAiC,GAAA0H,WAAAtH,MDuFY2G,GAAI,SAAYlF,EAAMhB,EAAImG,GCrFtChH,EAAA2H,SAAAH,EAAA3F,EAAA4F,EAAA5G,EAAAmG,IDwFYE,IAAK,SAAarF,EAAMhB,GCtFpCb,EAAA4H,cAAAJ,EAAA3F,GAAAA,EAAA4F,EAAA5G,IAEAsG,QAAA,SAAAtF,GACA,IAAAA,EAAA,MAAA7B,EAEA,KAAA,GAAA8H,GAAA7F,UAAAlE,OAAAmE,EAAAvE,MAAAmK,EAAA,EAAAA,EAAA,EAAA,GAAAC,EAAA,EAAAD,EAAAC,EAAAA,IDwFoB7F,EAAK6F,EAAQ,GAAK9F,UAAU8F,ECpFhD7F,GAAA8F,QAAAnG,EAAA4F,IAAAD,EAAAL,QAAA9E,MAAAmF,EAAAtF,MAIA5F,OD0FAmE,EAAEwH,SCnFF5J,IAAA,SAAA6J,EAAAC,GACA,MAAA7L,MAAA8L,MAAA,MAAAF,EAAAA,EAAA9E,OAAA+E,IAGAE,KAAA,SAAAH,EAAAC,GACA,MAAA7L,MAAA8L,MAAA,OAAAF,EAAAA,EAAA1E,KAAA2E,IAGAG,IAAA,SAAAJ,EAAAC,GACA,MAAA7L,MAAA8L,MAAA,MAAAF,EAAAA,EAAA1E,KAAA2E,IDoFII,IAAK,SClFTL,EAAAC,GDmFQ,MClFR7L,MAAA8L,MAAA,SAAAF,EAAAA,EAAA1E,KAAA2E,IDoFIK,KAAM,SAAcN,EAAOC,GCjF/B,MAAAD,GAAA1E,MAAA0E,EAAA1E,KAAA0E,EAAAO,QAAAnM,KAAAgM,IAAAJ,EAAAC,GAAA7L,KAAA+L,KAAAH,EAAAC,IAEAO,KAAA,SAAAR,GDmFQ,GAAIS,MCjFZ5F,EAAAmF,EAAA9L,OAAAwM,QAAA,YAAAV,IAAA,GACAW,EAAAX,EAAAY,IAAAF,QAAA,UAAAV,IAAA,GACAa,EAAAb,EAAAY,IAAAF,QAAA,YAAAV,IAAA,GACAc,EAAAd,EAAAQ,QAAA,EAMA,KAJAG,GAAAF,EAAA/I,KAAAiJ,GACA9F,GAAA4F,EAAA/I,KAAAmD,GACA4F,EAAA/I,KAAAsI,EAAA9L,OAAAyF,MAEA,IAAAmH,EAAAC,QAAA,QACAN,EAAAO,MAEAF,EAAAA,EAAAtI,MAAA,EAOA,OAJAsI,IAAAL,EAAA/I,KAAAoJ,GACAd,EAAA1E,MAAA0E,EAAA1E,KAAA0E,EAAAO,SAAAE,EAAA/I,KAAAsI,EAAA1E,KAAA0E,EAAAO,SDkFQM,GAAaJ,EAAM/I,KAAK+I,EAAMO,MAAQH,GC/E9CJ,EAAAjF,KAAA,MAAA0E,MAAA,SAAAe,EAAAjB,EAAA1E,EAAA2E,GDoFQ,GAAI/E,GAASpG,OAAO6F,QAASjB,KAAMuH,GAAUhB,EAK7C,OCxFR/E,GAAAI,KAAAxG,OAAA6F,UAAAW,EAAAJ,EAAAI,MACAJ,EAAAG,IAAAjH,KAAAoM,KAAAR,GDuFeA,EAAMhF,QAAQjG,OAAO,SAAU4G,ECtF9CC,GAAArD,EAAAwC,QAAAE,KAAAC,GAAA6C,KAAA,WDwFgB,IAAK,GAAImD,GAAQnH,UAAUlE,OAAQmE,EAAOvE,MAAMyL,GAAQC,EAAQ,EAAWD,EAARC,EAAeA,IAC9EnH,EAAKmH,GAASpH,UAAUoH,ECxF5CnB,GAAAoB,IAAA7I,EAAAwC,QAAAqB,WAAApC,IAAAkB,EAAAmG,QACA1F,EAAA3B,IACA,WD4FgB,IAAK,GAAIsH,GAAQvH,UAAUlE,OAAQmE,EAAOvE,MAAM6L,GAAQC,EAAQ,EAAWD,EAARC,EAAeA,IC1FlGvH,EAAAuH,GAAAxH,UAAAwH,ED8FgB,OAAO3F,GAAO5B,SCtF9BzB,EAAAiJ,kBACAC,aD6FIC,mBAEAC,kBAAmB,SAA2BC,GAC1C,GAAIC,GAAa9H,UAAUlE,QAAU,GAAsBa,SAAjBqD,UAAU,GAAmBtB,EAAQsB,UAAU,EAEzF3F,MC9FR0N,iBAAAF,QAAAA,EAAAC,WAAAA,IDgGIpI,SChGJ,SAAAE,EAAAiI,EAAAC,GDiGQzN,KAAKqN,UAAU9H,IAAUiI,QAASA,EAASC,WAAYA,GAAcpJ,IAEzEsJ,QAAS,SAAiBC,EAAY/B,GChG1C,GAAAgC,GAAA7N,KDmGYuF,EAAOsG,EAAQtG,KChG3B4F,EAAAU,EAAAV,GACA2C,EAAAjC,EAAAiC,SDkGYC,EAAMlC,EAAQA,OC/F1BtG,IAAAqI,EAAAI,OAAA,iCDmGQ,IAAIzF,GCjGZvI,KAAAqN,UAAA9H,IAAAvF,KAAA0N,eDkGanF,IAASqF,EAAWI,OAAO,4BAA6BzI,EC/FrE,IAAA0I,GAAAH,EAAAF,EAAAM,GAAAJ,GAAAF,EAAAO,EAAAhD,GACAiD,EAAAjD,EAAAA,EAAAhH,EAAAqC,SAAA,OAGA,OAAAoH,GAAAS,MAAA9F,EAAAiF,QAAAI,EAAAK,EAAAF,GAAA,SAAAO,GDiGY,GAAIC,GAAMX,EAAWzC,GAAKiD,EACtBI,EAAQX,EAAOP,gBAAgBiB,GCjG/CrK,GAAAiH,GAAAoD,EAAAhG,QAAAA,EAAAkG,MAAAtK,EAAAqC,SAAA+H,GAAA1C,QAAAkC,EDqGY,OCpGZ5J,GAAA7C,QAAAkN,GAAAA,EAAAlL,KAAAY,GAAA2J,EAAAP,gBAAAiB,GAAAC,GAAAA,EAAAtK,GAAAA,GDoGqBiH,GAAIA,EAAImD,UAAWA,EAAWG,MAAOvK,EAAIuK,UChG9DC,SAAA,SAAAd,EAAA1J,GACA,GAAAyK,GAAA3O,KAEAmL,EAAAyC,EAAAzC,GAAAjH,EAAAiH,GACAqD,EAAAxO,KAAAsN,gBAAAnC,GACAyD,EAAAJ,CDqGYrK,GAAE7C,QAAQkN,IClGtBxO,KAAAsN,gBAAAnC,MACA7G,EAAAkK,EAAA,SAAArI,GACAA,EAAAsI,QAAAvK,EAAAuK,MAAAE,EAAArB,gBAAAnC,GAAA7H,KAAA6C,GAAAyI,EAAAzI,IAEA,IAAAnG,KAAAsN,gBAAAnC,GAAA1J,cAAAzB,MAAAsN,gBAAAnC,UACAnL,MAAAsN,gBAAAnC,GDuGQyD,EAAQrG,QAAQkF,WCxGxBG,EAAA1J,EAAAoK,UAAAM,EAAA/C,WAIA1H,EAAA0K,KAAA,WACA,QAAAA,GAAAtJ,GDyGQ,GAAIsG,GAAUlG,UAAUlE,QAAU,GAAsBa,SAAjBqD,UAAU,MAAwBA,UAAU,GCvG3FmJ,EAAAnJ,UAAA,EAEAhE,GAAA3B,KAAA6O,GD0GQ7O,KAAK6L,QAAUA,EACf7L,KAAKmL,GCpHbhH,EAAAqC,SAAA,KDqHQxG,KAAKuF,KAAOA,EACZvF,KAAK4G,QAAU,GAAIzC,GAAEyC,QAAQ5G,MAE7BU,OAAO6F,OAAOvG,KAAM8O,GAChBjD,EAAQkD,OAAO/O,KC1G3BgP,OAAAnD,EAAAkD,OACA/O,KAAAiP,eAAAjP,KAAAkP,cDuKI,MCxKJ1L,GAAAqL,ID+GQ/K,IAAK,cACLjD,MAAO,eAEPiD,IC/GR,UDgHQjD,MAAO,SAAiBiD,GC7GhC,IAAA,GD8GgBjD,GAAQb,KAAK6L,QAAQ/H,GC9GrCqL,EAAAxJ,UAAAlE,OAAAmE,EAAAvE,MAAA8N,EAAA,EAAAA,EAAA,EAAA,GAAAC,EAAA,EAAAD,EAAAC,EAAAA,IDiHgBxJ,EAAKwJ,EAAQ,GAAKzJ,UAAUyJ,EAGhC,OAAOjL,GAAEuF,WAAW7I,GAASA,EAAMkF,MAAM/F,KAAM4F,GAAQ/E,KAG3DiD,ICrHR,SDsHQjD,MAAO,SAAgBwO,GACnB,IAAKlL,EAAEmL,SAASD,GAAU,KAAMA,EAEhC,KAAK,GAAIE,GAAS5J,UAAUlE,OAAQ+N,EAAOnO,MAAMkO,EAAS,EAAIA,EAAS,EAAI,GAAIE,EAAS,EAAYF,EAATE,EAAiBA,IACxGD,EAAKC,EAAS,GAAK9J,UAAU8J,ECrH7C,MAAA,IAAApH,OAAA,KAAArI,KAAAF,OAAAE,KAAAF,OAAAyF,KAAA,IAAA,IAAAvF,KAAAuF,KAAA,KAAA8J,EAAA,IAAAG,EAAApI,KAAA,SD2HQtD,IAAK,SACLjD,MAAO,SAAgBqD,GCvH/B,GAAAwL,GAAA1P,ID0HYyE,GAAOP,EAAK,SAAUrD,EAAOiD,GCzHzC,GAAA6L,GAAAD,EAAA5L,ED2HgB,OAAK6L,QCvHrBxL,EAAAuF,WAAAiG,KACAD,EAAA5L,GAAA,WACA,IAAA,GAAA8L,GAAAjK,UAAAlE,OAAAmE,EAAAvE,MAAAuO,GAAAC,EAAA,EAAAD,EAAAC,EAAAA,ID6H4BjK,EAAKiK,GAAUlK,UAAUkK,EAI7B,OADAjK,GAAK8F,QAAQiE,GACN9O,EAAMkF,MAAM2J,EAAQ9J,WAX/B8J,EAAO5L,GAAOjD,QCjHlCiD,IAAA,QDmIQjD,MAAO,WCjIf,GAAAiP,EDoIY,QAAQA,EAAW9P,KAAK4G,SAASyH,MAAMtI,MAAM+J,EAAUnK,eAIxDkJ,KCnIX1K,EAAA4L,WAAA,SAAAC,GAGA,QAAAD,GAAAxK,EAAAiH,EAAAyD,EAAAC,EAAArE,GDuIQlK,ECtIR3B,KAAA+P,EACA,IAAAI,GAAAlQ,EAAAD,KAAAU,OAAA8B,eAAAuN,GAAA5P,KAAAH,KAAAuF,EAAAsG,GACAW,IAAAA,EDwIY1M,OAAQmQ,ECvIpBG,cDyIYC,QAASH,EACTI,iBACA3F,aCtIZ,ODyIQwF,GAAOI,eAAiBJ,EAAO7D,QAAQ,YC3I/CE,EAAAxB,cAAAmF,GAEAA,EDuVI,MClWJ9P,GAAA0P,EAAAC,GDyJIxM,EAAauM,IACTjM,IAAK,cACLjD,MC7IR,WACA,GAAA2P,GAAAxQ,IDgJY,OADAA,MAAKyQ,gBAAkBzQ,KAAKsM,QAAQ,mBAAqBtM,KAAKF,QAAUE,KAAKF,OAAO2Q,iBAAmBzQ,KAAKwM,IAAIiE,gBACzGzQ,KAAKqO,OC9IxBrO,KAAAyQ,gBAAAC,MAAA1Q,MAAAA,KAAA2Q,qBAAA,SAAAC,GACA,GAAAC,GAAAnO,EAAAkO,EAAA,GDgJoBE,EAAWD,EAAM,EACrB,OAAOL,GAAOO,UAAYD,OAIlChN,IAAK,SACLjD,MAAO,SAAgBgL,GACnB,MAAO7L,MAAKgR,QChJxB,MAAAnF,EAAA7L,KAAAiR,cAAApF,GAAA,MDmJQ/H,IAAK,IACLjD,MAAO,SAAWsK,GACd,MAAOnL,MAAKkO,GAAG,IAAMlO,KCjJjCkR,WAAA/F,IAAA,MDoJQrH,IAAK,KACLjD,MAAO,SCrJfiN,GDsJY,MAAO9N,MAAKmR,SAASC,iBAAiBtD,MCnJlDhK,IAAA,UACAjD,MAAA,WDuJY,GAAIwQ,GCpJhBrR,KDsJgB6L,ECrJhBlG,UAAAlE,QAAA,GAAAa,SAAAqD,UAAA,MAAAA,UAAA,GACA2L,EAAA3L,UACA,EDyJY,OCvJZ3F,MAAAuR,SAAAvR,KAAAgO,OACA,kBDqJYhO,KCnJZiR,cAAApF,EDoJmB7L,KCpJnBqO,MAAArO,KAAAiP,eAAAjP,KAAAwR,mBAAA,WACA,MACAH,GAAAxG,QAAA,iBACA,WDoJgB,MAAOwG,GAAO/E,QAAQ,iBACvBtM,KAAKyR,cAAezR,KAAK0R,eAAgB,SAAUxK,GAClD,MAAOmK,GAAOM,gBCpJ9BzK,EAAAoK,IACAtR,KAAA4R,kBAAA5R,KAAA6R,aAAA,WACA,MAAAR,GAAA/E,QAAA,gBACA,WDqJgB,MAAO+E,GAAOxG,QAAQ,gBACvB7K,SAGP8D,IAAK,aCtJbjD,MAAA,SAAAiR,GDwJY9R,KAAKuR,QAAUO,ECtJ3B9R,KAAA+R,iBD0JQjO,IAAK,SACLjD,MCxJR,WDyJY,GAAImR,GCxJhBhS,ID0JY,OAAKA,MAAKuR,QAEHvR,KCzJnBqO,MAAA,WACA,MAAA2D,GAAAnH,QAAA,gBD0Je,WCzJf,MACAmH,GAAA1F,QAAA,gBACAtM,KAAAiS,cAAAjS,KAAAkS,cAAAlS,KAAAwR,mBAAA,WD0JgB,MAAOQ,GAAQT,QAAQY,OAAOH,KAC9BhS,KAAKoS,YAAa,WAClB,MAAOJ,GAAQ1F,QAAQ,eCrJvC,WACA,MAAA0F,GAAAnH,QAAA,eACA,WACA,aAAAmH,GAAAT,SACAvR,MAhBAA,KAAA4G,QAAAW,QAAAvH,SDyKQ8D,IAAK,iBCtJbjD,MAAA,WACA,ODwJgBwR,OAAQrS,KAAKwM,IAAI8F,OACjBC,KAAMvS,SCtJtB8D,IAAA,kBACAjD,MAAA,SAAAqG,EAAAoK,GD2JYtR,KAAKyQ,gBC3JjB+B,SAAAxS,KAAAkH,EAAAlH,KAAA+Q,UAAAO,MAGAxN,IAAA,oBACAjD,MAAA,SAAA4R,GACA,GAAAC,GAAA1S,IAEAyE,GAAAgO,GAAAzS,KAAAsM,QAAA,UAAA,SAAAzL,EAAAiD,GD4JgB,GC3JhBsF,GAAAtF,EAAA6O,QAAA,iBAAA,IAAAC,MAAA,OACApO,GAAAV,IAAAA,EAEA,KAAAsF,EAAA3H,QAAAiR,EAAA1E,OAAA,qBACAxJ,EAAAqO,UAAAzJ,EAAA,GACA,MAAAA,EAAA,GAAAhF,MAAA,KACAI,EAAA2G,GAAAuH,EAAAxB,WAAA9H,EAAA,GAAAhF,MAAA,EAAA,KACAI,EAAAsO,UAAA,ED4JoBtO,EAAOsJ,SAAW,QAAUtJ,EAAO2G,GAAK,MAExC3G,EAAO2G,GAAKuH,EAAQxB,WC5JxC9H,EAAA,ID6JoB5E,EAAOsJ,SAAW,IAAMtJ,EAAO2G,IC7JnD3G,EAAA+D,QAAAmK,EAAAK,oBAAAlS,EAAA2D,GAAAkO,EAAA/H,QAAA7G,GAAAU,OAGAV,IAAA,sBDkKQjD,MAAO,SAA6BmS,EAAaC,GChKzD,GAAAC,GAAAlT,KACA8S,EAAAG,EAAAH,SACA3H,EAAA8H,EAAA9H,GACAgI,EAAAnT,KAAAwM,IAAAX,QAAAsH,aAEA,OAAA,UAAAC,GDmKqBF,EAAQ3C,eAAeyC,IAAcE,EAAQlF,OAAO,6BAA8BgF,EAEvF,IAAItP,GAASS,EAAEwC,QCnK/BsB,eAAAmL,GDoKoBxN,GAAQwN,EACRjP,GAAEwC,QAAQ+B,SAAShF,EAAQyP,KCpK/CL,GAAAlN,EAAA8F,QAAAhI,EAAA2P,aAAA,MAAAjP,MAAA+G,EAAA1J,SACAyR,EAAA3C,eAAAyC,GAAAjN,MAAAmN,EAAAtN,QDyKQ9B,IAAK,cACLjD,MAAO,WCrKf,GAAAyS,GAAAtT,IDwKYyE,GAAOzE,KAAK2K,QAAS,SAAU9J,GAC3ByS,EAAQ/B,QAAQgC,kBAAkBD,EAASzS,EAAMgS,UAAWhS,EAAMiN,SAAUjN,EAAM0H,cCrKlGzE,IAAA,gBACAjD,MAAA,WACAb,KAAAuR,QAAAiC,qBAAAxT,SAEA8D,IAAA,oBD2KQjD,MAAO,WACH,GAAI4S,GC3KhBzT,IACA,OAAAA,MAAAqO,MAAA/J,EAAAtE,KAAAsM,QAAA,cAAA,SAAAnG,GACA,GAAA5E,GAAA4C,EAAAuF,WAAAvD,GAAAA,EAAAhG,KAAAsT,GAAAtN,CD6KgB,OC5KhB5E,GAAA4C,EAAAiJ,iBAAAO,QAAA8F,EAAAlS,GAAA,OAAA,SAAA6O,GACA,MAAA9L,GAAA8L,EAAA,SAAAjK,GD8KoB,GAAKA,EAAL,CACA,GAAIgF,GAAKhF,EAAKgF,GACVmD,EAAYnI,EAAKmI,UACjBG,EAAQtI,EAAKsI,MAAU5N,EAAQ4S,EAAQrD,WAAWjF,EACtDhH,GAAE7C,QAAQT,GAASA,EAAMyC,KAAKgL,GAAamF,EAAQrD,WAAWjF,GAAMtK,GAASA,EAAOyN,GAAaA,EC/KrHmF,EAAAnD,cAAA7B,GAAAtI,UDqLQrC,IClLR,qBDmLQjD,MAAO,WACH,GAAI6S,GAAU1T,ICjL1BA,MAAAoQ,cACA3L,EAAAzE,KAAAsQ,cAAA,SAAAzP,GDoLgB,MAAOsD,GAAEiJ,iBAAiBsB,SAASgF,EAAS7S,KAEhDb,KAAKsQ,oBAGTxM,IAAK,aACLjD,MAAO,SAAoBsK,GACvB,MAAOnL,MAAKmL,GAAKA,KAGrBrH,IAAK,gBACLjD,MAAO,eAEPiD,IAAK,eACLjD,MAAO,eAEPiD,IC9QR,eD+QQjD,MAAO,eAEPiD,IC/VR,cAAAjD,MA8JA,eAEAiD,IAAA,WDmMQ/B,IAAK,WACD,MAAO/B,MAAKuR,QAAUvR,KAAKuR,QAAQoC,YAAY3T,MAAQ,SAIxD+P,GACT5L,EAAE0K,MAEJ1K,EAAEyP,oBC3MF,SAAAC,GAWA,QAAAD,KAGA,MDiMQjS,GAAgB3B,KAAM4T,GCjM9B3T,EAAAD,KAAAU,OAAA8B,eAAAoR,GAAA7N,MAAA/F,KAAA2F,YDgSI,MAlGAtF,GAAUuT,EAAqBC,GAQ/BrQ,EAAaoQ,IACT9P,IAAK,cCnMbjD,MAAA,WACA,GAAAyG,GAAAxF,EAAApB,OAAA8B,eAAAoR,EAAAnT,WAAA,cAAAT,MAAAG,KAAAH,KDuMY,OADAA,MAAK8T,UACE9T,KAAKqO,MAAM/G,ECrM9BtH,KAAA+T,qBDwMQjQ,IAAK,eACLjD,MAAO,WACH,MAAOb,MAAKqO,MAAMrO,KAAKgU,mBCtMnChU,KAAAiU,iBACAnQ,IAAA,cDyMQjD,MAAO,WACH,MAAOb,MC1MnBkU,mBAEApQ,IAAA,mBD4MQjD,MAAO,WC1Mf,GAAAsT,GAAAnU,IAEAA,MAAAqO,MAAA5J,EAAAzE,KAAAsM,QAAA,SAAA,WACA,GAAAT,GAAAlG,UAAAlE,QAAA,GAAAa,SAAAqD,UAAA,MAAAA,UAAA,GACAJ,EAAAI,UAAA,GAEAoI,EAAA5J,EAAAuF,WAAAmC,GAAAA,EAAA1L,KAAAgU,GAAAtI,CD8MgB,OC7MhB1H,GAAAmL,SAAAvB,KAAAA,GAAA+D,OAAA/D,ID6MuBoG,EAAQ3H,IAAIX,EAAQuI,SAAW,gBAAkB,eAAe7O,EAAM4O,GAASxK,KAAK,SAAUxD,GACjG,GAAI5E,GAAI4E,CC3M5B,OD4MoB5E,GAAE8S,cAAgBtG,EAClBoG,EAAQL,OAAOvO,GAAQY,EC7M3CA,UDmNQrC,IC9MR,qBD+MQjD,MAAO,WACH,GAAIyT,GAAUtU,IAGd,OADAA,MAAKuU,YACEvU,KAAKqO,MAAMrO,KAAKwU,aAAclQ,EAAItE,KAAKkO,GAAG,iBAAkB,SAAU9F,GChNzF,GAAA0J,GAAAwC,EAAAG,cAAArM,EDkNgBkM,GCjNhBC,SAAAzC,EAAAvM,MAAAuM,QAGAhO,IAAA,eDmNQjD,MClNR,WACA,GAAA6T,GAAA1U,IDoNY,OAAOA,MAAKqO,MAAM5J,EAAOzE,KAAKoJ,MAAO,SAAUjD,GAC3C,GAAI2L,GAAS3L,EAAKkO,cCnNlCvC,MAEAA,KACA4C,EAAAC,QAAA7C,IAAA4C,EAAA1G,OAAA,WAAA8D,EAAA,mBDoNgB4C,EAAQC,QAAQ7C,GAAQ8C,KAAKzO,MAC7BnG,SCjNhB8D,IAAA,gBACAjD,MAAA,SAAAuH,GACA,GAAA7C,GAAA6C,EAAAiL,aAAA,cDqNY,OAAOrT,MCrNnBwM,IAAAiI,cAAArM,EAAA7C,EAAAvF,SDwNQ8D,IAAK,gBACLjD,MAAO,WACH,GAAI8T,GAAU3U,KCzR1BuU,QACA,OAAAI,UACA3U,MAAAuU,SD0RmBvU,KAAKqO,MAAM5J,EAAOkQ,EAAS,SAAU7C,GACxC,MAAOA,GAAO+C,UACd7U,OC7RhBA,QDgSQ8D,IAAK,QACL/B,IAAK,WCpSb,MAAA/B,MAAA8T,cAqEAhQ,IAAA,UDoOQ/B,IAAK,WACD,MAAO/B,MAAKuU,iBAIbX,GACTzP,EAAE4L,YAEJ5L,EAAE2Q,cC5OF,SAAAC,GAEA,QAAAD,KDgPQ,MC/ORnT,GAAA3B,KAAA8U,GD+Oe7U,EAA2BD,KAAMU,OAAO8B,eAAesS,GAAe/O,MAAM/F,KAAM2F,YA2E7F,MAhFAtF,GAAUyU,EAAeC,GCtO7BvR,EAAAsR,IACAhR,IAAA,oBD+OQjD,MC9OR,WD+OYiB,EAAKpB,OAAO8B,eAAesS,EAAcrU,WAAY,oBAAqBT,MAAMG,KAAKH,MACrF8B,EAAKpB,OAAO8B,eAAesS,EAAcrU,WAAY,oBAAqBT,MAAMG,KAAKH,KAAMA,KAAKsM,QAAQ,eAG5GxI,IAAK,sBChPbjD,MAAA,SAAA0E,EAAArB,GDkPY,GAAI8Q,MAAchV,KAAKsM,QAAQ,gBAAkBpI,EAAIJ,IACrD,OAAOkR,GClPnBhV,KAAAiV,cAAA1P,GAAAzD,EAAApB,OAAA8B,eAAAsS,EAAArU,WAAA,sBAAAT,MAAAG,KAAAH,KAAAuF,EAAArB,MDqPQJ,IAAK,gBACLjD,MAAO,SCrPf0E,GDsPY,GAAI2P,GAAUlV,KAEVmT,EAAgBnT,KAAKwM,IAAIX,QAAQsH,cCrPjDgC,EAAAnV,KAAAsM,QAAA,sBAEA8I,EAAAD,EAAA5P,GAEA8P,EAAArV,KAAAsM,QAAA,uBDyPgBgJ,ECtPhBD,EAAA9P,EDwPY,OAAO,UCvPnB2C,GDwPgB,GCvPhBxE,GACAS,EAAAwC,QAAAsB,eAAAmL,MDuPgB,KAAIjP,EAAEwC,QCvPtB+B,SAAAhF,EAAAyP,GDuPgB,CACAhP,ECxPhBwC,QACAkC,SAAAnF,EAAAyP,EDyPgB,ICxPhBjM,GAAAgO,EAAAK,kBAAA7R,EACAwR,GAAA7G,MAAAlK,EAAAuF,WAAA0L,GAAAA,EAAAjV,KAAA+U,EAAAhO,EAAAgB,GAAAhB,EAAA,SAAAsO,GACA,MAAAA,MAAA,EAAAN,EAAApV,OAAA2V,SAAAlQ,EAAAiQ,IAAA,GDyPmB,SAAUhR,GACT,MAAOA,MAAW,EAAQ8Q,GAAkBA,EAAenV,KAAK+U,EAAS1Q,IAAU,IACpFmF,KAAK,WCxPxB,MAAAxF,GAAAwC,QAAAoC,YAAArF,EAAAyP,IACA,WAAA,MAAAhP,GAAAwC,QAAAoC,YAAArF,EAAAyP,UAKArP,IAAA,oBACAjD,MAAA,SAAA6C,GD8PY,IC7PZ,GAAAgS,GAAA1V,KAAAmR,SACAvC,EAAAlL,EACAiS,GAAA,EACA/G,GAAAA,IAAA8G,GAAA,SAAA9G,EAAAgH,SD2PgBhH,EAAUA,EAAQiH,UCzPlCjH,KAAAA,EAAA8G,EACA,IAAAxO,GAAA,SAAA0H,EAAAgH,QAAAzR,EAAAwC,QAAAwB,YAAAyG,KDyQY,OAdAtK,GAAIsK,EAAQwC,iBAAiB,2BAA4B,SAAUjL,GCzP/E,GAAAA,IAAAzC,EAEA,MAFAiS,GAAAjS,EAAA2P,aAAA,kBACAnM,EAAAyO,GAAAjS,EAAA2P,aAAA,cD+PgB,IAAI9N,GAAOY,EAAKkN,aAAa,YAC7B,KAAIsC,GAAcA,IAAepQ,EAAjC,CC5PhB,GAAA1E,GAAAsF,EAAAkN,aAAA,cD+PoBvO,EAAIoC,EAAK3B,EC7P7BpB,GAAA7C,QAAAwD,GAAAA,EAAAxB,KAAAzC,GAAAqG,EAAA3B,GAAA,MAAAT,EAAAjE,GAAAiE,EAAAjE,MDgQmBqG,MAIR4N,GACT3Q,EAAE4L,YAEJ5L,EAAEa,KAAO,SCvQT8Q,GAEA,QAAA9Q,KD2QQ,MC1QRrD,GAAA3B,KAAAgF,GD0Qe/E,EAA2BD,KAAMU,OAAO8B,eAAewC,GAAMe,MAAM/F,KAAM2F,YAgFpF,MArFAtF,GAAU2E,EAAM8Q,GAQhBtS,EAAawB,IACTlB,IAAK,cC1QbjD,MAAA,WAEA,MADAb,MAAA+V,YACA/V,KAAAqO,MAAAvM,EAAApB,OAAA8B,eAAAwC,EAAAvE,WAAA,cAAAT,MAAAG,KAAAH,MAAAA,KAAAgW,2BAGAlS,IAAA,yBACAjD,MAAA,WACA,GAAAoV,GAAAjW,ID6QYA,MAAKkW,gBACLzR,EC3QZzE,KAAAsM,QAAA,YAAA,SAAAzL,EAAAiD,GACA,GAAA8H,GAAAqK,EAAAF,SAAAjS,GAAAmS,EAAAnW,OAAAqW,MAAAC,OAAAtS,ED4QqB8H,IAAOqK,EAAQjI,OAAO,YAAalK,GAEnCjD,IACLoV,EAAQC,aAAapS,IAAS8H,MAAOA,EAAO/K,MAAOA,EAAO0D,GAAI,WAClD1D,KAAU,GAAQoV,EAAQ1E,SAAS0E,EAAQI,OAAOJ,EAAQhF,eC7QtF9M,EAAAmL,SAAAzO,IAAAoV,EAAA3J,QAAAzL,WDmRQiD,IAAK,YACLjD,MAAO,WChRf,GAAAyV,GAAAtW,IAEAyE,GAAAzE,KAAAkW,aAAA,SAAArV,GDkRgB,MAAOyV,GAAQjL,SAASxK,EAAM+K,MAAO,UAAW/K,EAAM0D,SAI9DT,IAAK,cACLjD,MAAO,WCrRfb,KAAAsL,gBDuRYtL,KAAK+V,eCrRjBjS,IAAA,aDyRQjD,MCxRR,WD2RY,IAAK,GAFD0V,GAEKC,EAAS7Q,UCzR9BlE,OAAAmE,EAAAvE,MAAAmV,GAAAC,EAAA,EAAAD,EAAAC,EAAAA,ID0RgB7Q,EAAK6Q,GAAU9Q,UAAU8Q,IC1RzCF,EAAAzU,EAAApB,OAAA8B,eAAAwC,EAAAvE,WAAA,aAAAT,OAAAG,KAAA4F,MAAAwQ,GAAAvW,MAAAgG,OAAAJ,ID8RY5F,KAAK0W,eAGT5S,IC/RR,SDgSQjD,MAAO,WAGH,IAAK,GAFD8V,GAEKC,EAASjR,UAAUlE,OAAQmE,EAAOvE,MAAMuV,GAASC,EAAS,EAAYD,EAATC,EAAiBA,IACnFjR,EAAKiR,GAAUlR,UAAUkR,EAG7B7W,MAAKqO,OCnSjBsI,EAAA7U,EAAApB,OAAA8B,eAAAwC,EAAAvE,WAAA,SAAAT,OAAAG,KAAA4F,MAAA4Q,GAAA3W,MAAAgG,OAAAJ,IAAA5F,KAAA8W,YAAA9W,SDsSQ8D,IAAK,iBACLjD,MCtSR,WACA,GAAAkW,GAAA/W,KDwSgBkH,EAAOpF,EAAKpB,OAAO8B,eAAewC,EAAKvE,WAAY,iBAAkBT,MAAMG,KAAKH,KAOpF,OANAyE,GAAOzE,KAAK+V,SAAU,SAAUlV,EAAOiD,GCnVnD,MAAAoD,GAAApD,GAAAjD,EAAAkB,KAAA,KDsVY0C,EAAOzE,KAAKsM,QAAQ,mBAAoB,SAAUzL,EAAOiD,GCvSrE,MAAAoD,GAAApD,GAAAjD,EAAAV,KAAA4W,EAAA7P,KD0SmBA,MAIRlC,GACTb,EAAE2Q,eAEJ3Q,EAAEe,OAAS,SCjTX8R,GAEA,QAAA9R,KDqTQ,MCpTRvD,GAAA3B,KAAAkF,GAEAjF,EAAAD,KAAAU,OAAA8B,eAAA0C,GAAAa,MAAA/F,KAAA2F,YDsWI,MAzDAtF,GAAU6E,EAAQ8R,GAQlBxT,EAAa0B,IC9SjBpB,IAAA,cDgTQjD,MC/SR,WDkTY,MAFAb,MAAKwM,IAAIyK,SAASjX,KAAKuF,KAAO,KAAOvF,KAAKmL,IAAMnL,KAChDA,KAAKkX,mBACEpV,EAAKpB,OAAO8B,eChT/B0C,EAAAzE,WAAA,cAAAT,MAAAG,KAAAH,SDmTQ8D,IAAK,WACLjD,MAAO,SAAkB0E,EAAMiQ,GAC3B,MAAOxV,MAAKmX,OAAO1B,SCjT/BlQ,EAAAiQ,MAGA1R,IAAA,mBDkTQjD,MCjTR,WDkTYb,KAAKmX,OAASnX,KAAKwM,IAAI4K,aAAapX,KAAMA,KAAKsM,QAAQ,aAG3DxI,IAAK,cACLjD,MAAO,WAGH,aCtTZb,MAAAwM,IAAAyK,SAAAjX,KAAAuF,KAAA,KAAAvF,KA1BAmL,ID+UYnL,KAAKmX,OCrTjBE,WAAAvV,EAAApB,OAAA8B,eAAA0C,EAAAzE,WAAA,cAAAT,MAAAG,KAAAH,SDyTQ8D,IAAK,gBACLjD,MAAO,WACH,GAAIyW,GAAUtX,ICvT1B,OAAAA,MAAAqO,MAAAvM,EAAApB,OAAA8B,eA9BA0C,EAAAzE,WAAA,gBAAAT,MAAAG,KAAAH,MA8BA,WD0TgB,MC1ThBsX,GAAAH,OAAAI,wBD8TQzT,IAAK,eACLjD,MAAO,WCrVf,GAAA2W,GAAAxX,IDwVY,OAAOA,MAAKqO,MAAMvM,EAAKpB,OAAO8B,eAAe0C,EAAOzE,WAAY,eAAgBT,MAAMG,KAAKH,MAAO,WAC9F,MAAOwX,GAAQL,OAAOM,uBC/TtC3T,IAAA,QDoUQ/B,IAAK,WClUb,MAAA/B,MAAAmX,WDuUWjS,GACTf,EAAEyP,oBCrUJ,IAAA8D,IAAA,OAAA,QAAA,SAAA,SAEAvT,GAAAc,OAAA,SAAA0S,GD0UI,QAAS1S,GAAOuH,EAAKyD,EAAK7H,EAAI7C,GCtUlC5D,EAAA3B,KAAAiF,EDyUQ,IAAI2S,GAAU3X,EAA2BD,KAAMU,OAAO8B,eAAeyC,GAAQ9E,KAAKH,KAAMuF,GAAQ,aCvUxGiH,IAAAA,EDyUY1M,OAAQmQ,EACR4H,ICrVZzP,EDsVY0P,gBAKJ,OAFKF,GAAQC,KAAKD,EAAQ5J,OAAO,0CACjCxB,EAAIxB,cC7UZ4M,GD8UeA,EA2HX,MChdJvX,GAAA4E,EAAA0S,GAUAnU,EAAAyB,ID+UQnB,IC9UR,OD+UQjD,MAAO,SAAc+M,GC7U7B,GAAAmK,GAAA/X,KAIA6L,EAAAlG,UAAAlE,QAAA,GAAAa,SAAAqD,UAAA,MAAAA,UAAA,EAEA,OAAA3F,MAAAgY,WAAApK,GAEA/B,EAAAoM,eAAA,EAAAjY,KAAA4G,QAAAW,QAAAvH,KAAAkY,UAAAlY,KAAAkY,SAAAlH,QAAAnF,GAAA,GAGA7L,KAAAqO,MAAAlK,EAAAmL,SAAA1B,GAAA5N,KAAAwM,IAAA2L,cAAAvK,GAAAA,EAAA,SAAAzH,GDgVgB,MAHMA,aAAgBhC,GAAE4L,YACpBgI,EAAQ/J,OAAO,wDAEZ7H,IC/UvB,SAAAA,GACA,MAAA4R,GAAA1J,MAAAlI,EAAAoL,SAAApL,EAAAoL,QAAAsD,QAAA1O,IACA,WACA,MAAA4R,GAAAlD,UACA,SAAAuD,GAEA,GAAAC,GAAA3V,EAAA0V,EAAA,GACAjS,EAAAkS,EAAA,EDkVgBN,GAAQG,SAAW/R,CACnB,IAAImS,GAAOnS,EAAKrG,OAASqG,EAAKrG,OAAOyF,KAAO,IAAMY,EAAKZ,KAAOY,EAAKZ,IAGnE,OAFAwS,GAAQpE,cCjVxB4E,aAAA,eAAAD,GDkVgBnS,EAAKqS,WAAWT,GACT5R,GClVvB,SAAAA,GDoVgB,MClVhBA,GAAA6K,QAAAnF,GAAA,QDsVQ/H,IAAK,QACLjD,MAAO,WCjVf,GAAA4X,GAAAzY,IDoVY,OAAOA,MAAKqO,MAAMrO,KAAKkY,UAAYlY,KAAKkY,SAASQ,SAAU,WACvD,aAAcD,GAAQP,UACvBlY,SChVf8D,IAAA,KACAjD,MAAA,SAAAiN,GACA,MAAA9N,MAAA2T,cAAAvC,iBAAAtD,MDsVQhK,IAAK,aCnVbjD,MAAA,SAAA+M,GACA,MAAA5N,MAAAkY,SDqVgBlY,KAAKkY,SAAS3S,OAASqI,GAAmB,EAC1CA,GAAcA,EAAWzC,KAAOnL,KAAKkY,SAAS/M,IAAW,GACtD,GCvVnB,KD0VQrH,IAAK,cACLjD,MAAO,WACH,MAAOb,MAAK6X,OCrVxB/T,IAAA,SACAjD,MAAA,WDyVYb,KAAK2T,cCxVjBgF,UAAA,MAEA7U,IAAA,0BACAjD,MAAA,SAAA0E,GACA,GAAAqT,GAAA5Y,IAEA,OAAA,UAAAkI,GACA,GAAA0Q,EAAAd,WAAAvS,GAAA,CACA,GAAA7B,GAAAwE,EAAAxE,MD2VgBY,GAAIsU,ECzVpBd,WAAAvS,GAAA6D,MAAA,SAAAjD,GAGA,IAAA,GAFA0S,GAAAD,EAAAjF,cAAAvC,iBAAAjL,EAAA2H,UACAgL,GAAA,EACAvX,EAAA,EAAAA,EAAAsX,EAAApX,OAAAF,IAAA,CACA,GAAA6G,GAAAyQ,EAAAtX,ED0VwB,IAAI6G,IAAO1E,GAAU0E,EAAGQ,SAASlF,GAAS,CACtCoV,EAAU1Q,CACV,QCvV5B0Q,GAAA3S,EAAA5B,GAAApE,KAAAgG,EAAAyH,WAAA1F,UD+VQpE,IAAK,oBACLjD,MAAO,SAA2B+M,EAAYrI,EAAMuI,EAAUvJ,GAC1D,GAAIL,GAAMlE,KAAK8X,WAAWvS,EACrBrB,KACDA,EAAMlE,KAAK8X,WAAWvS,IAAUwT,SAAU/Y,KAAKgZ,wBAAwBzT,GAAO6D,UC5V9FjF,EAAAwC,QAAA2B,iBAAAtI,KAAA2T,cAAApO,EAAArB,EAAA6U,SAAA,KAAArB,EAAA/K,QAAApH,KD+VYrB,EAAIkF,MC9VhB9F,MAAAwK,SAAAA,EAAAvJ,GAAAA,EAAAqJ,WAAAA,ODiWQ9J,IAAK,uBC7VbjD,MAAA,SAAA+M,GACA,GAAAqL,GAAAjZ,IAEAyE,GAAAzE,KAAA8X,WAAA,SAAAjX,EAAAiD,GD+VgB,GC9VhBsF,MACAlF,EAAArD,CACAyD,GAAAJ,EAAAkF,MAAA,SAAAjD,GD+VwBA,EAAKyH,aAAeA,GAAYxE,EAAM9F,KAAK6C,KC3cnEjC,EAAAkF,MAAAA,EA6GA,IAAAA,EAAA3H,eDkW2BwX,GAAQnB,WAAWhU,GChW9CK,EAAAwC,QAAA8B,oBAAAwQ,EAAAtF,cAAA7P,EAAAI,EAAA6U,iBDuWW9T,GACTd,EAAE0K,MAEJ1K,EAAE+U,eC1WF,SAAAC,GD6WI,QAASD,GAAerN,GCtW5B,MDuWQlK,GAAgB3B,KAAMkZ,GCvW9BjZ,EAAAD,KAAAU,OAAA8B,eAAA0W,GAAA/Y,KAAAH,KAAA,kBAAA6L,GAAAuN,qBD+ZI,MA3DA/Y,GAAU6Y,EAAgBC,GCjW9B3V,EAAA0V,IACApV,IAAA,uBD0WQjD,MCzWR,SAAAuH,EAAAwF,GD0WY,GAAIyL,GAAUrZ,KAEVsZ,ICxWhBhV,GAAA8D,EAAAgJ,iBAAA,QAAA,SAAAjL,GD0WgB,GAAIgF,GC1WpBhF,EAAAkN,aAAA,KACAiG,GAAAnO,IAAAkO,EAAArL,OAAA,WAAA7C,EAAA,oBD2WgBmO,EAAKnO,IC1WrB,ED2WgBhF,EAAKoS,aC1WrB,KAAA3K,EAAAsD,WAAA/F,KD6WY,IC3WZoO,GAAAvZ,KAAAsM,QAAA,yBAAA,MAAA,cAAA,cD6WYhI,GAAIiV,EAAO,SAAUjB,GACjB,MAAOhU,GAAI8D,EAAGgJ,iBAAiB,IAAMkH,EAAO,KAAM,SAAUnS,GACxD,GAAItF,GC5WxBsF,EAAAkN,aAAAiF,GACAkB,EAAA,MAAA3Y,EAAA4Y,OAAA,GACAC,EAAAF,EAAA,IAAA5L,EAAAsD,WAAArQ,EAAAuD,MAAA,IAAAwJ,EAAAsD,WAAArQ,EACAsF,GAAAoS,aAAAD,EAAAoB,UAIA5V,IAAA,QACAjD,MAAA,SAAA+M,GD8WY,GC7WZzC,GAAAyC,EAAAzC,ED8WY,OAAInL,MAAKoZ,eAAejO,GAAYnL,KAAKoZ,eAAejO,GC5WpEnL,KAAAoZ,eAAAjO,GAAAnL,KAAA2Z,QAAA/L,MDgXQ9J,IC/WR,UDgXQjD,MAAO,SAAiB+M,GACpB,MAAIA,aAAsB7N,GAAQmF,OACvB0I,EChXvByC,QAAAuJ,mBAAAhM,EAAA,aAGA,WACA,MAAAA,GAAA9N,OAAAiR,cA1CAjN,IA4CA,WDmXQjD,MAAO,SAAkB+M,EAAY1G,EAAM4J,GCjXnD,GAAA1I,GAAAwF,EAAAuD,QDmXY/I,GCnXZuQ,UAAA7H,EAAA5J,GDoXYlH,KAAK6Z,qBAAqBzR,EAAIwF,OAI/BsL,GCrXX/U,EAAA0K,MAEA1K,EAAAiB,MAAA,SAAA0U,GAGA,QAAA1U,GAAA6K,EAAApE,GDuXQlK,EAAgB3B,KAAMoF,ECpX9B,IAAA2U,GAAA9Z,EAAAD,KAAAU,OAAA8B,eAAA4C,GAAAjF,KAAAH,KAAA,QAAA6L,GACAW,IAAAyD,EAAAzD,IACA1M,OAAAmQ,EDuXY+J,aC/WZ,ODkXQD,GAAQvN,IAAIxB,cAAc+O,GAE1BA,EAAQE,WAAaF,EAAQzN,QAAQ,aACrC7H,EAAOsV,EC1YfE,WAAA,SAAApZ,EAAAiD,GD2YoC,SAApBA,EAAIM,MAAM,EAAG,IACjB2V,EAAQ1O,SAAS0O,ECzX7BvN,IAAA1I,EAAA,SAAA0R,GACA,MAAA3U,GAAAV,KAAA4Z,EAAAG,iBAAA1E,OACAuE,EDicI,MA1FA1Z,GCtXJ+E,EAAA0U,GD6YItW,EC3XJ4B,ID4XQtB,IAAK,WC1XbjD,MAAA,SAAA0E,EAAAiQ,GACA,GAAA2E,GAAA7X,OACA8X,EAAA7U,EACA8U,EAAA7E,CAOA,ODqXgBrR,GAAES,SAASwV,KACXC,EAAID,EAAE5E,QACN4E,EAAIA,EAAE7U,MCzXtB4U,EAAAna,KAAAia,WAAAG,GACAD,GAAAna,KAAAgO,OAAA,gCAAAzI,GACAvF,KAAAqO,MAAA8L,EAAAha,KAAAH,KAAAka,iBAAAG,OD+XQvW,IAAK,cACLjD,MAAO,WACHb,KAAKsa,oBACLta,KAAKka,iBAAmBxZ,OAAO6F,QAC3B6P,OAAQpW,KAAKoW,OC9X7BtW,OAAAE,KAAAF,OACA0M,IAAAxM,KAAAwM,KACArI,EAAAwH,YDkYQ7H,IAAK,oBC9XbjD,MAAA,WDgYY,GC/XZ0Z,GAAAva,IDiYYyE,GAAOzE,KAAKsM,QAAQ,UAAW,SAAUzL,EAAOiD,GAC5C,GAAIgB,IAAKX,EAAEuF,WAAW7I,GAASA,EAAMV,KAAKoa,GAAW1Z,MACrD,OAAIiE,GAAE0V,UAAW,OC/XjCD,EAAAP,QAAAlW,GAAAyW,EAAA/N,IAAAiO,SAAAtE,MAAAC,OAAAtS,SAGAyW,EAAAP,QAAAlW,GAAAyW,EAAA/N,IAAAkO,aAAAH,EAAAzV,SAGAhB,IAAA,mBDkYQjD,MAAO,WACH,MAAOb,MAAKqO,MAAM5J,EAAOzE,KAAKga,QAAS,SAAUpO,GCjY7D,MAAAA,GAAAC,QAAA8O,YAAA,EAAAxW,EAAAwH,QAAA5J,IAAA6J,GAAA,WDsYQ9H,IAAK,kBACLjD,MAAO,WClYf,MAAAb,MAAAqO,MAAA5J,EAAAzE,KAAAga,QAAA,SAAApO,GACA,GAAA+O,GAAA/O,EAAAC,QAAA8O,QDqYgB,OAAOA,IAAYA,KAAa,EAAOxW,EAAEwH,QAAQ5J,IAAI6J,GAAS,WAItE9H,IAAK,WACLjD,MAAO,WC5cfb,KAAAsL,mBAqEAxH,IAAA,SD4YQ/B,IAAK,WACD,MAAO/B,MAAKga,YAIb5U,GC9YXjB,EAAA0K,MAEA1K,EAAAgB,MAAA,SAAAyV,GAGA,QAAAzV,GAAAgR,EAAAtK,GACAlK,EAAA3B,KAAAmF,EAEA,IAAA0V,GAAA5a,EAAAD,KAAAU,OAAA8B,eAAA2C,GAAAhF,KAAAH,KAAA,QAAA6L,GDgZYW,IAAK2J,EAAMrW,OAAO0M,IC/Y9B1M,OAAAqW,EAAArW,ODiZYqW,MAAOA,IAOX,OAJA0E,GAAQC,MAAQD,EC5YxBvO,QAAA,YACAuO,EAAA1O,OAAA0O,EAAAvO,QAAA,UAAAuO,EAAArO,IAAAX,QAAAkP,MACAF,EAAAG,QAAAta,OAAA6F,UAAAsU,EAAAvO,QAAA,WACAuO,EAAArO,IAAAxB,cAAA6P,GACAA,EAoBA,MDyWIxa,GC/YJ8E,EAAAyV,GDiaIpX,EAAa2B,IC5YjBrB,IAAA,MD8YQjD,MC7YR,SAAAqG,EAAA2D,GD8YY,GAAIoQ,GAAIjb,KAAK6L,QAAQjE,MAAQ5H,KAAKsM,QAAQ,QAASpF,GAAQA,CAC3DlH,MAAK8a,MAAQ9a,KAAK6L,QAAQpM,KAAOwb,EAAEjb,KAAK6L,QAAQpM,MAAQwb,EACpDpQ,GAAS7K,KC9YzBkb,aDiZQpX,IC9YR,MD+YQjD,MAAO,SAAasa,GAChB,MAAOA,GAAUxW,EAAM3E,KAAK8a,OAAS9a,KAAK8a,SAG9ChX,ICjZR,QDkZQjD,MAAO,SAAegK,GAClB7K,KAAK8a,MAAQ3W,EAAE7C,QAAQtB,KAAK8a,aACxBjQ,GAAS7K,KAAKkb,aAGtBpX,IAAK,UACLjD,MAAO,WACHb,KAAK6K,QAAQ,cAGjB/G,IAAK,OACLjD,MAAO,WACH,MAAOb,MAAKsM,QCjbxB,QAAA,MDobQxI,IAAK,UACL/B,IAAK,WACD,MAAOoC,GAAEwH,QCpbrBS,KAAApM,SDubQ8D,IAAK,SACL/B,IAAK,WC1cb,MAAA/B,MAAAgb,WA0CAlX,IAAA,ODqaQ/B,IAAK,WACD,MAAO/B,MAAK8a,UCpaxB3V,GACAhB,EAAA0K,MD0aA1K,EAAEiX,OAAS,SAAUC,GAiBjB,QAASD,GAAO5O,EAAKX,GAGjB,MAFAlK,GAAgB3B,KAAMob,GAEfnb,EChbfD,KAAAU,OAAA8B,eAAA4Y,GAAAjb,KAAAH,KAAA,SAAA6L,GAAAW,IAAAA,KD+dI,MC1eJnM,GAAA+a,EAAAC,GD0aI7X,EAAa4X,EAAQ,OCvazBtX,IAAA,WDyaQjD,MCxaR,SAAA0E,GDyaY,IAAKpB,EAAEmL,SAAS/J,GACZ,OAAS2K,OAAQ,KAAM3K,KAAMA,EAGjC,IAAIK,GAAOL,EAAKqN,MAAM,KAClB1C,EAAStK,EAAKnE,OAAS,EAAImE,EAAK0E,QAAU,IAE9C,QAAS4F,OAAQA,EAAQ3K,KAAMK,EAAK0E,QAAS1E,KAAMA,OCxa/DpC,EAAA4X,IDmbQtX,IAAK,eCjbbjD,MAAA,SAAAya,GACA,GAAAC,GAAAvb,KDobgBwb,EClbhBxb,KAAAwM,IAAAX,QACA4P,EAAAD,EAAAC,WDmbgBC,EClbhBF,EAAAE,YACA9b,EAAA4b,EAAA5b,IDmbgB+b,EClbhBF,EAAA,IAAAH,CAEA,OAAAtb,MAAA4G,QAAAjG,OAAA,SAAA4G,EAAAC,GDmboB5H,EACAgc,SAASD,GAAWpU,EAASC,GCjbjDD,EDkb2BmU,EClb3BA,EAAAvb,KAAAob,EAAA/O,IAAAmP,GDqb4BC,QAAQ,KAAOD,SAKnC7X,IAAK,qBACLjD,MAAO,SAA4BoP,EAAKqL,GACpC,MAAOtb,MAAK6b,aCrbxB5L,EAAA1K,KAAA,IAAA+V,MDwbQxX,IAAK,aACLjD,MAAO,SAAoB0E,GACvB,MAAOvF,MAAK6b,aCtbxBtW,EAAA,IAAAvF,KAAAwM,IAAAX,QAAAiQ,UAAAhc,WDybQgE,ICtbR,WDubQjD,MAAO,SAAkB0E,EAAM0K,GAC3B,MAAOjQ,MAAK4Z,mBAAmB3J,EAAK,GAAKjQ,KAAKwM,IAAIX,QAAQiQ,UAAUC,KAAOxW,MAG/EzB,IAAK,aCxbbjD,MAAA,SAAAya,GD0bY,GC1bZ/V,GAAAvF,KAAAwM,IAAAX,QAAAiQ,UAAAE,MD2bY,OAAOhc,MAAK6b,aAAaP,EAAOA,EAAO,IAAM/V,EAAOA,OAIrD6V,GC5bXjX,EAAA0K,MAEA1K,EAAA8X,YAAA,SAAAC,GAGA,QAAAD,GAAApQ,GAGA,MAFAlK,GAAA3B,KAAAic,GAEAhc,EAAAD,KAAAU,OAAA8B,eAAAyZ,GAAA9b,KAAAH,KAAA6L,GAAAA,EAAAtG,MAAA,cAAA7E,OAAA6F,QD8bYkV,WAAY,MC5bxBlP,QAAA,GACAE,UAAA,GACA0P,mBAAA,EACAC,cAAA3c,GAAAA,EAAA4c,SAAAC,KD8bYnJ,cC7bZ,WACAuI,YAAA,KACAX,MAAA,KACAN,SAAA,WAEAqB,WACAhc,OAAA,QD8bgBic,KAAM,QACNC,OCtdhB,WDwdWnQ,IC9bXyG,UACA2E,YACAsF,eAoFA,MA1GAlc,GAAA4b,EAAAC,GDydI1Y,EAAayY,IC/bjBnY,IAAA,cACAjD,MAAA,WACAb,KAAAyQ,gBAAAzQ,KAAAsM,QAAA,mBAAA,GAAAnI,GAAA+U,eACAlZ,KAAAwc,eAAA,UAAA,GAAArY,GAAAiX,OAAApb,OAAA,GDicYA,KAAKuR,QAAUvR,KAAKyU,cAAczU,KAAKsM,QAAQ,iBAAkB,aAGrExI,IAAK,iBACLjD,MAAO,SAAwB0E,EAAM2K,EAAQuM,GAGzC,MAFAzc,MAAKuc,SAAShX,GAAQ2K,ECnclCuM,IAAAzc,KAAA0c,eAAAxM,GDqcmBlQ,QAGX8D,ICncR,QDocQjD,MAAO,SCncf8b,GDocY,GCncZC,GAEAC,EAAA7c,IAGA,ODicgB2c,KAAa3c,KAAK4c,QAAU,GAAIzY,GAAE2Y,OAAO9c,OCjczDA,KAAAqO,MAAAsO,GAAAC,EAAA5c,KAAA4c,SAAAG,aAAAhX,MAAA6W,EAAAzb,EAAAnB,KAAAsM,QAAA,cAAA,EAAAtM,KAAAuR,QAAAqD,KAAA5U,KAAAsM,QAAA,aAAA,SAAAmO,GACA,MAAAoC,GAAApC,SAAAA,GACA,WACA,MAAAkC,IAAAE,EAAAD,QAAAI,OAAAL,IDoce3c,SCjcf8D,IAAA,OACAjD,MAAA,WACAb,KAAA4K,MDqcY5K,KAAKuR,QAAQsD,QACT7U,KAAK4c,SAAS5c,KAAK4c,QAAQK,WAGnCnZ,IAAK,WCpcbjD,MAAA,SAAAqc,EAAArS,GACA7K,KAAA4c,SDscY5c,KAAK4c,QAAQO,SAASD,EAAMrS,MCncxC/G,IAAA,WDucQjD,MCtcR,SAAA0E,EAAAiQ,GDucY,GAAI4E,GAAIjW,EAAES,SAASW,GAAQA,EAAKA,KAAOA,EACnC8U,EAAIlW,EAAES,SAASW,GAAQA,EAAKiQ,QAAUA,CAC1CxV,MAAK6K,QAAQ,OAASuP,ECvclCC,MD0cQvW,IAAK,OACLjD,MAAO,SAAciR,EAAQsL,EAAYvR,GACrC,MAAO7L,MAAKya,SAAS9F,QCxcjC7C,GAAA8C,KAAAwI,EAAAvR,MD2cQ/H,IAAK,aACLjD,MAAO,SAAoB0E,EAAM0K,GAC7B,MC5cZ1K,IAAAvF,KAAAuc,SAAAhX,IAAA0K,GAAAA,EAAAI,SAAArQ,KAAA0c,kBD+cQ5Y,IAAK,gBC5cbjD,MAAA,SAAA0E,EAAA8X,GD8cY,GAAIC,GC9chBtd,KACAud,EAAApZ,EAAAiX,OAAAoC,SAAAjY,GAEA6X,EAAAG,EAAAhY,KDgdgBkY,EAAaF,EAAmBrN,OAChCA,EAASlQ,KAAK0d,WAAWD,EAAYlb,OAEzC,OAAOvC,MAAKqO,MAAM6B,EAAOyN,WAAWP,GAAa,WAC7C,GAAIvR,GAAUlG,UAAUlE,QAAU,GAAsBa,SAAjBqD,UAAU,MAAwBA,UAAU,EAEnF,OAAOZ,GAAU6Y,aAAa/R,EAAQvG,KAAM8X,EAAYE,EAASD,EAAcnN,EAAQrE,QAI/F/H,IAAK,cCpdbjD,MAAA,SAAA0E,EAAA0K,GDsdY,GAAI4N,GCtdhB7d,KACA8d,EAAA3Z,EAAAiX,OAAAoC,SAAAjY,GAEAwY,EAAAD,EAAAvY,KDwdgBkY,EAAaK,EAAoB5N,OACjCA,EAASlQ,KAAK0d,WAAWD,EAAYxN,EAEzC,OAAOjQ,MAAKqO,MAAM6B,EAAO8N,SCxdrCD,EAAA9N,GAAA,WDydgB,GAAIpE,GAAUlG,UAAUlE,QAAU,GAAsBa,SAAjBqD,UAAU,MAAwBA,UAAU,ECzdnG,OAAAZ,GAAAkZ,WAAApS,EAAAvG,KAAAyY,EAAAF,EAAA5N,EAAAC,EAAArE,QD+dQ/H,IAAK,gBACLjD,MAAO,SAAuBuH,EAAI7C,EAAM0K,GACpC,GAAIiO,GC7dhB/Z,EAAAiX,OAAAoC,SAAAjY,GD+dgB4Y,EAAaD,EAAoB3Y,KC9djDD,EAAA4Y,EAAAhO,MDieY,OAAOnL,GAAUqZ,aAAa9Y,EAAMtF,KAAMiQ,EAAK7H,EAAI+V,MAGvDra,IAAK,eACLjD,MAAO,SAAsBoP,GCjerC,GAAApE,GAAAlG,UAAAlE,QAAA,GAAAa,SAAAqD,UAAA,MAAAA,UAAA,EDoeY,OAAOZ,GAAUsZ,YAAYxS,EAAQvG,KAAM2K,EAAKpE,MC1kB5D/H,IAwGA,eDseQjD,MAAO,SAAsBsV,GCperC,GAAAtK,GAAAlG,UAAAlE,QAAA,GAAAa,SAAAqD,UAAA,MAAAA,UAAA,EAEA,OAAAZ,GAAAuZ,YAAAzS,EAAAvG,KAAA6Q,EAAAtK,OAIAoQ,GDseE9X,EAAE0K,MCreJnO,OAAA6F,OAAApC,EAAA8X,YACAxb,UAAA0D,EAAAqG,MAGA,IAAA+T,GAAA9e,GAAAA,EAAA+e,SAAA,aAAA/e,GAAA+e,QDseIC,GAAkB,cAAe,UAAY,eAAgB,QCnejEC,EAAA,WACA,QAAAA,GAAAlS,EAAAwP,EAAAV,EAAA/W,GACA5C,EAAA3B,KAAA0e,EDueQ,IAAIC,GAAUrD,EAAK3I,QAAQ8L,EAAe,GAAIA,EAAe,IAAI9L,QAAQ8L,EAAe,GAAIA,EAAe,GAE3Gze,MAAK2e,QAAU,GAAIC,QAAO,IAAMD,EAAU,IAAKnS,EAAIX,QAAQsQ,kBAAoB,IAAM,MCre7Fnc,KAAAwM,IAAAA,EACAxM,KAAAgc,OAAAA,EDweQhc,KCveRsb,KAAAA,EDweQtb,KAAKuE,GAAKA,EA4Bd,MAzBAf,GAAakb,IACT5a,IAAK,QACLjD,MAAO,SAAeqc,GCze9B,MADAld,MAAA2e,QAAAE,UAAA,EACA7e,KAAA2e,QAAAG,KAAA5B,MAGApZ,IAAA,SACAjD,MAAA,SAAAqc,GACA,GAAA6B,GD4egBC,EAAUhf,IAEdA,MC7eZ2e,QAAAE,UAAA,CACA,IAAAjZ,GAAA5F,KAAA2e,QAAAM,KAAA/B,GAAA9Y,MAAA,GD8egB8a,EAAWlf,KAAKgc,OAAOmD,iBAAiBnf,KAAKsb,KAGjD,OC7gBZ4D,GAAA5b,KAAAtD,KAAAuE,KD6gBoBwa,EAAW/e,KAAKgc,QAAQ3N,MAAMtI,MAAMgZ,EAAU5d,EAAmBmD,EAAI4a,EAAU,SAAU3a,EAAIhD,GACjG,MAAO,UAAU0I,GC/ejC,MAAA1F,GAAAwB,MAAAiZ,EAAAhD,OAAAza,EAAA,GAAA0I,GAAAjE,OAAAJ,GAAAA,YDsfW8Y,ICjfXva,GAAA2Y,OAAA,SAAAsC,GDufI,QAAStC,GAAOtQ,GCnfpB7K,EAAA3B,KAAA8c,EDsfQ,ICtfRuC,GAAApf,EAAAD,KAAAU,OAAA8B,eAAAsa,GAAA3c,KAAAH,KAAA,aDufYwM,IAAKA,ECtfjB8S,WDwfYC,iBACAC,UCngBZ,IDygBQ,OC5fRH,GAAAI,eAAA,WACA,MAAAJ,GAAAK,SAAAL,EAAAM,aAEAN,ED8lBI,MCxmBJhf,GAAAyc,EAAAsC,GDsgBI5b,EAAasZ,ICxfjBhZ,IAAA,WD0fQjD,MCzfR,SAAAya,EAAAzQ,GD0fiB7K,KAAKwf,WACNjB,EACA9e,EAAK+e,QAAQoB,aC1f7BngB,EAAA4c,SAAAwD,MAAA,IAAAvE,GAEA7b,EAAAqgB,SAAAnN,QAAA,IAAA2I,GAGAzQ,KAAA,GAAA7K,KAAA0f,SAAApE,OD6fQxX,IAAK,SACLjD,MAAO,SAAgBkf,GACnB,IAAI/f,KAAKwf,UC3frB/f,ED2fY,CC1fZ0E,EAAAwC,QAAA2B,iBAAA7I,EAAA,aAAAO,KAAAyf,gBAAA,EAEA,IAAAvC,GAAAld,KAAA2f,YAAAI,CACA/f,MAAAwf,UAAA,ED4fgBtC,GAAMld,KAAKmd,SAASD,OCzfpCpZ,IAAA,QACAjD,MAAA,WD6fiBb,KAAKwf,WC3ftBrb,EAAAwC,QAAA8B,oBAAAhJ,EAAA,aAAAO,KAAAyf,gBACAzf,KAAAwf,UAAA,MAGA1b,IAAA,WD6fQjD,MAAO,SC5ffya,GD6fY,GC5fZA,IAAAtb,KAAAggB,cD4fY,CC3fZhgB,KAAAggB,cAAA1E,CD8fY,KAAK,GAAI/Z,GAAI,EAAGA,EAAIvB,KAAKsf,QAAQ7d,OAAQF,IAAK,CAC1C,GAAI0e,GAAQjgB,KAAKsf,QC7fjC/d,ED8fgB,IAAI0e,EAAMC,MAAM5E,GC7fhC,WD8foB2E,GAAME,OAAO7E,QAMzBxX,IAAK,eACLjD,MAAO,WACH,GClgBZuf,GAAApgB,KDogBgBqgB,EAAQjc,EAAMjE,KAAKwF,UACvB,OAAO3F,MAAKqO,MAAM/J,EAAI+b,EAAO,SAAU/E,GACnC,MAAO8E,GAAQ5T,ICngB/BkR,WAAApC,GAAAgF,WAAAhF,KDogBgB,SAAUzP,GACV,MAAOvH,GAAIuH,EAAS,SAAU0U,EAAQhf,GCpgBtD,MAAA6e,GAAAI,UAAAH,EAAA9e,GAAAgf,UAIAzc,IAAA,YDugBQjD,MCtgBR,SAAAya,EAAAzP,GDugBY,GAAI4U,GAAUzgB,KCpgB1B0gB,EAAA7U,EAAA6U,OACAC,EAAA9U,EAAA8U,YAEAlc,GAAAN,EAAAuF,WAAAgX,GAAAA,EAAA3a,MAAA/F,MAAA0gB,EAAA,SAAA7f,EAAAiD,GDugBgB,GAAIuW,IAAKiB,EAAO,IAAMxX,GAAK6O,QAAQ,WAAY,GAC/C8N,GAAQnB,QAAQ5T,QAAQ,GAAIgT,GAAM+B,EAAQjU,IAAKiU,EAASpG,EAAGxO,EAAQhL,OAGvE4D,ECxgBZN,EAAAuF,WAAAiX,GAAAA,EAAA5a,MAAA/F,MAAA2gB,EAAA,SAAA9f,EAAAiD,GDygBgB,GAAIuW,IAAKiB,EAAO,IAAMxX,GAAK6O,QAAQ,WAAY,GCvgB/D8N,GAAAlB,cAAAlF,GAAAxO,EAAAhL,QAIAiD,IAAA,mBDygBQjD,MCxgBR,SAAAya,GDygBY,GAAI9W,MCvgBhB4E,EAAAkS,EAAA1I,MAAA,ID2gBY,KCzgBZxJ,EAAAwD,MDygBmBxD,EAAM3H,OAAS,GAAG,CACrB,GAAIqC,GAAMsF,EAAMhC,KAAK,IACjBpH,MAAKuf,cCzgBzBzb,IAAAU,EAAAkH,QAAA1L,KAAAuf,cAAAzb,IACAsF,EAAAwD,MAxFA,MDomBgB5M,MAAKuf,cAAc,KAAK/a,EAAOkH,QAAQ1L,KAAKuf,cAAc,KCpmB1E/a,KA6FAV,IAAA,WACAjD,MAAA,WACA,MAAApB,GAAAqgB,SAAA5C,KAAA9Y,MAAA,OD+gBW0Y,GACT3Y,EAAE0K,KAEJ,IAAI+R,IC5gBJC,SAAA,GD8gBIC,QAAS,QACTC,YAAa,WACbC,eChhBJ,cDihBIla,OAAQ,SAAgBX,GACpB,MAAOA,IAiOf,OA7NAhC,GAAE8c,cAAgB,SAAUC,GC1gB5B,QAAAD,GAAA9K,EAAAtK,GACAlK,EAAA3B,KAAAihB,EAEA,IAAAE,GAAAlhB,EAAAD,KAAAU,OAAA8B,eAAAye,GAAA9gB,KAAAH,KAAAmW,EAAAtK,GAKA,ODihBQsV,GAAQrG,MAAQqG,EAAQ7U,QAAQ,YCphBxC6U,EAAAC,IDshBYC,KAAMF,EAAQ7U,QAAQ,SAAW,EACjCgV,UCxiBZ,EDyiBYT,SAAUM,EAAQ7U,QAAQ,aAAesU,EAAqBC,SAC9DC,QAASK,EAAQ7U,QCvhB7B,YAAAsU,EAAAE,QDwhBYC,YCxhBZI,EAAA7U,QAAA,gBAAAsU,EAAAG,YDyhBYC,eCzhBZG,EAAA7U,QAAA,mBAAAsU,EAAAI,gBACAG,ED2mBI,MC1nBJ9gB,GALA4gB,EAKAC,GDohBI1d,EAAayd,EAAe,OACxBnd,IAAK,aACLjD,MAAO,SAAoBiO,GCnhBnCpO,OAAA6F,OAAAqa,EAAA9R,ODyiBItL,EC1hBJyd,ID2hBQnd,IAAK;AACLjD,MAAO,WACH,GAAIqG,GAAOvB,UCnhBvBlE,QAAA,GAAAa,SAAAqD,UAAA,MAAAA,UAAA,GACAkF,EAAAlF,UAAA,EAEA3F,MAAAohB,GAAAG,YAAAra,EAAAlH,KAAAohB,GAAAJ,iBAAA,EACAhhB,KAAAohB,GAAAE,UAAAE,KAAAC,KArCAzhB,KAAAohB,GAAAG,YAAAvhB,KAAAohB,GAAAP,UAsCA/e,EAAApB,OAAA8B,eAAAye,EAAAxgB,WAAA,MAAAT,MAAAG,KAAAH,KAAAkH,EAAA2D,MDshBQ/G,IAAK,QCnhBbjD,MAAA,SAAAgK,GACA7K,KAAAohB,GAAAC,KAAA,EACArhB,KAAAohB,GAAAG,YAAA,EDqhBYvhB,KAAKohB,GAAGE,UAAY,EACpBxf,EAAKpB,OAAO8B,eAAeye,EAAcxgB,WAAY,QAAST,MAAMG,KAAKH,KAAM6K,MAGnF/G,ICvhBR,aDwhBQjD,MAAO,SAAoBwgB,GAEvB,MADIA,IAAQrhB,KAAKohB,GAAGE,WAAaD,GAAQ,IAAGrhB,KAAKohB,GAAGC,KAAOA,GACpDrhB,QAGX8D,IAAK,YACLjD,MAAO,WACH,MAAOb,MAAK0hB,WC3hBxB,MD8hBQ5d,IAAK,WACLjD,MAAO,WACH,MAAOb,MAAK0hB,WC9hBxB1hB,KAAAohB,GAAAE,cDiiBQxd,IAAK,WACLjD,MAAO,WACH,MAAOb,MAAK0hB,WC7jBxB1hB,KAAAohB,GAAAC,KAAA,MDgkBQvd,IAAK,WACLjD,MAAO,WACH,MCjkBZb,MAAA0hB,WAAA1hB,KAAAohB,GAAAC,KAAA,MAEAvd,IAAA,SACA/B,IAAA,WACA,GAAAqf,GAAAphB,KAAAohB,GACAC,EAAAD,EAAAC,KDmkBgBP,EAAUM,EAAGN,QACbC,EAAcK,EAAGL,YACjBF,EAAWO,EC/iB3BP,SACA/Z,EAAAhF,EAAApB,OAAA8B,eAAAye,EAAAxgB,WAAA,SAAAT,KDmjBY,OAFA8G,GCjjBZga,GAAAO,EDkjBYva,ECljBZia,GAAAF,EDmjBmBD,EAAqB9Z,OAAOA,MChjB/ChD,IAAA,WDojBQ/B,ICnjBR,WACA,GAAA4f,GAAA3hB,KAAAohB,GACAC,EAAAM,EAAAN,KDojBgBR,EAAWc,EAAId,SCljB/BU,EAAAI,EAAAJ,YAEA/c,EAAAlC,MAKA,ODgjBgBkC,GADAxE,KAAKkH,MAAQlH,KAAKkH,KAAKzF,OAAS,GACrB4f,KAAMA,EAAMO,OAAQP,EAAO,GAAKR,EAAW,EAAGgB,IAAKR,EAAOR,EAAUiB,MAAOP,ICpjBtGF,KAAAA,EAAAO,MAAA,EAAAC,IAAA,EAAAC,MAAA,GDyjBgBtd,EAAOqd,IAAMrd,EAAOsd,QAAOtd,EAAOqd,IAAMrd,EAAOsd,OCrjB/Dtd,MD0jBWyc,GACT9c,EAAEgB,OAEJhB,EAAE4d,cAAc,WAAY5d,EAAE8c,eAE9B9c,EAAE6d,YAAc,SC/jBhBC,GAEA,QAAAD,KDmkBQ,MClkBRrgB,GAAA3B,KAAAgiB,GDkkBe/hB,EAA2BD,KAAMU,OAAO8B,eAAewf,GAAajc,MAAM/F,KAAM2F,YAuG3F,MA5GAtF,GAAU2hB,EAAaC,GAQvBze,EAAawe,IACTle,IAAK,cACLjD,MAAO,WACHb,KAAK8T,UACL9T,KAAKkiB,gBCnkBjBpe,IAAA,WDukBQjD,MAAO,eCrkBfiD,IAAA,OACAjD,MAAA,SAAA+M,GDwkBY,GCvkBZuU,GAAAniB,KAEA6L,EAAAlG,UAAAlE,QAAA,GAAAa,SAAAqD,UAAA,MAAAA,UAAA,GAEAoI,EAAAH,EAAAyG,cDwkBgB+N,EAAMje,EAAEmL,SAAS1B,GCtkBjC9J,EAAA+H,EAAA/H,GACAse,IAAAxU,YAAAzJ,GAAA4L,YACA/P,KAAAgO,OAAA,yDAGAlK,GAAAiK,GACAA,EAAAjK,MAAAA,EAAAiK,EAAAjK,KDukBiBA,GAAK9D,KCrkBtBgO,OAAA,yBDskBY,ICrkBZ7H,GAAAnG,KAAA8T,OAAAhQ,EACA,OAAA9D,MAAAgY,WAAAlU,EAAAqC,EAAAyH,GACA/B,EAAAoM,eAAA,EAAAjY,KAAA4G,QAAAW,QAAApB,GACAA,EAAAkQ,OAAAxK,GDykBmB7L,KAAKqO,MAAM+T,EAAMpiB,KAAKwM,IAAI2L,cAAcvK,GAAcA,GAAa,SAAU1J,GAChF,MCxkBhBie,GAAA9T,MAAAnK,EAAAqN,SAAArN,EAAAqN,QAAAsD,QAAA3Q,IDykBe,WCxkBf,MAAAie,GAAA9T,MAAAlI,GAAAA,EAAAuS,SAAA,iBACAyJ,GAAArO,OAAAhQ,SD0kB2Bqe,GAAQD,UAAUpe,OCvkB7C,SAAAue,GACA,GAAAC,GAAA5f,EAAA2f,EAAA,GAGAne,EAAAoe,EAAA,GD0kBoBhK,EAAOpU,EAAIpE,OAASoE,EAAIpE,OAAOyF,KAAO,IAAMrB,EAAIqB,KAAOrB,EAAIqB,KAC3D6C,EAAK+Z,EAAQxO,YAAYzP,EAAKJ,ECpkBlD,OAHAqe,GAAArO,OAAAhQ,GAAAI,EACAkE,EAAAmQ,aAAA,eAAAD,GACApU,EAAAsU,WAAA2J,GACAje,EAAA8M,QAAAnF,GAAA,QAGA/H,IAAA,iBACAjD,MAAA,WACA,GAAAuH,GAAA3I,EAAA4c,SAAAkG,cAAA,MAEA,OADAviB,MAAA6X,IAAA2K,YAAApa,GACAA,KD6kBQtE,IAAK,cC1kBbjD,MAAA,SAAAsF,EAAArC,GACA,IAAAqC,EAAA,MAAAnG,MAAA6X,GACA,IAAA1Q,GAAArD,GAAAqC,EAAA8K,cAAAnN,KAAAqC,EAAAkO,cAAAvQ,GD6kBY,OADK9D,MAAKkiB,UAAU/a,KAAInH,KAAKkiB,UAAU/a,GAAKnH,KAAKyiB,eAAetb,EAAGhB,IAC5DnG,KAAKkiB,UAAU/a,MCzkBlCrD,IAAA,aACAjD,MAAA,SAAAiD,EAAAqC,EAAAyH,GD6kBY,MC5kBZzH,GD6kBmBA,EAAKZ,OAASqI,GAAcA,GAAcA,EAAWzC,KAAOhF,EAAKgF,IC7kBpF,KDglBQrH,IC5kBR,SD6kBQjD,MAAO,SAAgBsF,GACnB,IAAKA,EAED,WADArE,GAAKpB,OAAO8B,eC7kB5Bwf,EAAAvhB,WAAA,SAAAT,MAAAG,KAAAH,KDilBY,IAAIoI,GAAKpI,KC/kBrB2T,YAAAxN,EDglBYiC,GChlBZyN,WACA6M,YAAAta,MAGAtE,IAAA,QDglBQjD,MC9kBR,WAEA,GAAA8hB,GAAA3iB,ID+kBY,OAAOA,MAAKqO,MAAM5J,EAAOzE,KAAK8T,OAAQ,SAAU3N,GClqB5D,MAAAA,GAAAuS,WAoFA,WDilBgBiK,EAAQT,aACRS,EAAQ7O,gBACD6O,GAAQzK,UAChBlY,UAIJgiB,GACT7d,EAAEc,QACGlF","file":"drizzle.min.js","sourcesContent":[";(function(root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    define([], factory);\n  } else if (typeof exports === 'object') {\n    module.exports = factory();\n  } else {\n    root.Drizzle = factory();\n  }\n}(this, function() {\n'use strict';\n\nvar _get = function get(object, property, receiver) { if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { return get(parent, property, receiver); } } else if (\"value\" in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } };\n\nvar _slicedToArray = function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"]) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError(\"Invalid attempt to destructure non-iterable instance\"); } }; }();\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol ? \"symbol\" : typeof obj; };\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nfunction _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\n/*!\n * DrizzleJS v0.3.18\n * -------------------------------------\n * Copyright (c) 2016 Jaco Koo <jaco.koo@guyong.in>\n * Distributed under MIT license\n */\n\nvar Drizzle = {},\n    D = Drizzle,\n    slice = [].slice,\n    EMPTY = function EMPTY() {},\n    map = function map(arr, fn) {\n    var result = [];\n    if (!arr) return result;\n    if (arr.map) return arr.map(fn);\n\n    for (var i = 0; i < arr.length; i++) {\n        result.push(fn(arr[i], i, arr));\n    }\n    return result;\n},\n    mapObj = function mapObj(obj, fn) {\n    var result = [];\n    var key = undefined;\n    if (!obj) return result;\n\n    for (key in obj) {\n        if (D.hasOwnProperty.call(obj, key)) result.push(fn(obj[key], key, obj));\n    }\n\n    return result;\n},\n    clone = function clone(target) {\n    if (D.isObject(target)) {\n        var _ret = function () {\n            var result = {};\n            mapObj(target, function (value, key) {\n                return result[key] = clone(value);\n            });\n            return {\n                v: result\n            };\n        }();\n\n        if ((typeof _ret === 'undefined' ? 'undefined' : _typeof(_ret)) === \"object\") return _ret.v;\n    }\n\n    if (D.isArray(target)) {\n        return map(target, function (value) {\n            return clone(value);\n        });\n    }\n\n    return target;\n},\n    typeCache = {\n    View: {}, Region: {}, Module: {}, Model: {}, Store: {},\n\n    register: function register(type, name, clazz) {\n        this[type][name] = clazz;\n    },\n    create: function create(type, name) {\n        var Clazz = this[type][name] || D[type];\n\n        for (var _len = arguments.length, args = Array(_len > 2 ? _len - 2 : 0), _key = 2; _key < _len; _key++) {\n            args[_key - 2] = arguments[_key];\n        }\n\n        return new (Function.prototype.bind.apply(Clazz, [null].concat(args)))();\n    }\n};\n\nvar counter = 0,\n    root = null;\n\nif (typeof window !== 'undefined') {\n    root = window;\n}\n\nmap(['Function', 'Array', 'String', 'Object'], function (item) {\n    D['is' + item] = function (obj) {\n        return D.toString.call(obj) === '[object ' + item + ']';\n    };\n});\n\nmap(['Module', 'View', 'Region', 'Model', 'Store'], function (item) {\n    D['register' + item] = function (name, clazz) {\n        return typeCache.register(item, name, clazz);\n    };\n    typeCache['create' + item] = function (name) {\n        for (var _len2 = arguments.length, args = Array(_len2 > 1 ? _len2 - 1 : 0), _key2 = 1; _key2 < _len2; _key2++) {\n            args[_key2 - 1] = arguments[_key2];\n        }\n\n        return typeCache.create.apply(typeCache, [item, name].concat(args));\n    };\n});\n\nObject.assign(D, {\n    uniqueId: function uniqueId() {\n        var prefix = arguments.length <= 0 || arguments[0] === undefined ? '' : arguments[0];\n\n        return '' + prefix + ++counter;\n    },\n    adapt: function adapt(obj) {\n        Object.assign(D.Adapter, obj);\n    }\n});\n\nD.Adapter = {\n    Promise: Promise,\n\n    ajax: function ajax(params) {\n        var xhr = new XMLHttpRequest();\n        var url = params.url;\n        if (params.type === 'GET' && params.data) url += '?' + mapObj(params.data, function (v, k) {\n            return k + '=' + v;\n        }).join('&');\n        xhr.open(params.type, url, true);\n        var promise = new Promise(function (resolve, reject) {\n            xhr.onload = function () {\n                if (this.status >= 200 && this.status < 400) {\n                    resolve(JSON.parse(this.response));\n                    return;\n                }\n                reject(xhr);\n            };\n\n            xhr.onerror = function () {\n                reject(xhr);\n            };\n        });\n        xhr.send(params.data);\n        return promise;\n    },\n    ajaxResult: function ajaxResult(args) {\n        return args[0];\n    },\n    getEventTarget: function getEventTarget(e) {\n        return e.target;\n    },\n    getFormData: function getFormData(el) {\n        throw new Error('getFormData is not implemented', el);\n    },\n    addEventListener: function addEventListener(el, name, handler, useCapture) {\n        el.addEventListener(name, handler, useCapture);\n    },\n    removeEventListener: function removeEventListener(el, name, handler) {\n        el.removeEventListener(el, name, handler);\n    },\n    hasClass: function hasClass(el, clazz) {\n        return el.classList.contains(clazz);\n    },\n    addClass: function addClass(el, clazz) {\n        el.classList.add(clazz);\n    },\n    removeClass: function removeClass(el, clazz) {\n        el.classList.remove(clazz);\n    }\n};\n\nD.Promise = function () {\n    function Promiser(context) {\n        _classCallCheck(this, Promiser);\n\n        this.context = context;\n    }\n\n    _createClass(Promiser, [{\n        key: 'create',\n        value: function create(fn) {\n            var _this = this;\n\n            return new D.Adapter.Promise(function (resolve, reject) {\n                fn.call(_this.context, resolve, reject);\n            });\n        }\n    }, {\n        key: 'resolve',\n        value: function resolve(data) {\n            return D.Adapter.Promise.resolve(data);\n        }\n    }, {\n        key: 'reject',\n        value: function reject(data) {\n            return D.Adapter.Promise.reject(data);\n        }\n    }, {\n        key: 'parallel',\n        value: function parallel(items) {\n            var _this2 = this;\n\n            for (var _len3 = arguments.length, args = Array(_len3 > 1 ? _len3 - 1 : 0), _key3 = 1; _key3 < _len3; _key3++) {\n                args[_key3 - 1] = arguments[_key3];\n            }\n\n            return this.create(function (resolve, reject) {\n                var result = [],\n                    thenables = [],\n                    indexMap = {};\n                map(items, function (item, i) {\n                    var value = undefined;\n                    try {\n                        value = D.isFunction(item) ? item.apply(_this2.context, args) : item;\n                    } catch (e) {\n                        reject(e);\n                        return;\n                    }\n                    if (value && value.then) {\n                        indexMap[thenables.length] = i;\n                        thenables.push(value);\n                    } else {\n                        result[i] = value;\n                    }\n                });\n\n                if (thenables.length === 0) return resolve(result);\n\n                D.Adapter.Promise.all(thenables).then(function (as) {\n                    mapObj(indexMap, function (key, value) {\n                        return result[value] = as[key];\n                    });\n                    resolve(result);\n                }, function (as) {\n                    reject(as);\n                });\n            });\n        }\n    }, {\n        key: 'chain',\n        value: function chain() {\n            var _this3 = this;\n\n            for (var _len4 = arguments.length, args = Array(_len4), _key4 = 0; _key4 < _len4; _key4++) {\n                args[_key4] = arguments[_key4];\n            }\n\n            var prev = null;\n            var doRing = function doRing(rings, ring, resolve, reject) {\n                var nextRing = function nextRing(data) {\n                    prev = data;\n                    rings.length === 0 ? resolve(prev) : doRing(rings, rings.shift(), resolve, reject);\n                };\n\n                if (D.isArray(ring)) {\n                    ring.length === 0 ? nextRing([]) : _this3.parallel.apply(_this3, [ring].concat(_toConsumableArray(prev != null ? [prev] : []))).then(nextRing, reject);\n                } else {\n                    var value = undefined;\n                    try {\n                        value = D.isFunction(ring) ? ring.apply(_this3.context, prev != null ? [prev] : []) : ring;\n                    } catch (e) {\n                        reject(e);\n                        return;\n                    }\n\n                    value && value.then ? value.then(nextRing, reject) : nextRing(value);\n                }\n            };\n\n            if (args.length === 0) return this.resolve();\n\n            return this.create(function (resolve, reject) {\n                doRing(args, args.shift(), resolve, reject);\n            });\n        }\n    }]);\n\n    return Promiser;\n}();\n\nD.Event = {\n    on: function on(name, fn, ctx) {\n        this._events || (this._events = {});\n        (this._events[name] || (this._events[name] = [])).push({ fn: fn, ctx: ctx });\n    },\n    off: function off(name, fn) {\n        if (!this._events || !name || !this._events[name]) return;\n        if (!fn) {\n            delete this._events[name];\n            return;\n        }\n\n        var result = [];\n        map(this._events[name], function (item) {\n            if (item.fn !== fn) result.push(item);\n        });\n\n        if (result.length === 0) {\n            delete this._events[name];\n            return;\n        }\n        this._events[name] = result;\n    },\n    trigger: function trigger(name) {\n        for (var _len5 = arguments.length, args = Array(_len5 > 1 ? _len5 - 1 : 0), _key5 = 1; _key5 < _len5; _key5++) {\n            args[_key5 - 1] = arguments[_key5];\n        }\n\n        if (!name || !this._events || !this._events[name]) return this;\n        map(this._events[name], function (item) {\n            return item.fn.apply(item.ctx, args);\n        });\n    },\n    delegateEvent: function delegateEvent(to) {\n        var me = this,\n            id = '--' + to.id,\n            target = to;\n\n        Object.assign(target, {\n            _listeners: {},\n\n            listenTo: function listenTo(obj, name, fn, ctx) {\n                (target._listeners[name] || (target._listeners[name] = [])).push({ fn: fn, obj: obj });\n                obj.on(name, fn, ctx || target);\n            },\n            stopListening: function stopListening(obj, name, fn) {\n                mapObj(target._listeners, function (value, key) {\n                    var result = [];\n                    map(value, function (item) {\n                        var offIt = fn && item.fn === fn && name === key && obj === item.obj;\n                        offIt = offIt || !fn && name && name === key && obj === item.obj;\n                        offIt = offIt || !fn && !name && obj && obj === item.obj;\n                        offIt = offIt || !fn && !name && !obj;\n                        if (offIt) {\n                            item.obj.off(key, item.fn);\n                            return;\n                        }\n                        result.push(item);\n                    });\n\n                    target._listeners[key] = result;\n                    if (result.length === 0) {\n                        delete target._listeners[key];\n                    }\n                });\n            },\n            on: function on(name, fn, ctx) {\n                target.listenTo(me, name + id, fn, ctx);\n            },\n            off: function off(name, fn) {\n                target.stopListening(me, name && name + id, fn);\n            },\n            trigger: function trigger(name) {\n                if (!name) return target;\n\n                for (var _len6 = arguments.length, args = Array(_len6 > 1 ? _len6 - 1 : 0), _key6 = 1; _key6 < _len6; _key6++) {\n                    args[_key6 - 1] = arguments[_key6];\n                }\n\n                args.unshift(name + id) && me.trigger.apply(me, args);\n            }\n        });\n        return this;\n    }\n};\n\nD.Request = {\n    get: function get(model, options) {\n        return this._ajax('GET', model, model.params, options);\n    },\n    post: function post(model, options) {\n        return this._ajax('POST', model, model.data, options);\n    },\n    put: function put(model, options) {\n        return this._ajax('PUT', model, model.data, options);\n    },\n    del: function del(model, options) {\n        return this._ajax('DELETE', model, model.data, options);\n    },\n    save: function save(model, options) {\n        return model.data && model.data[model._idKey] ? this.put(model, options) : this.post(model, options);\n    },\n    _url: function _url(model) {\n        var parts = [],\n            prefix = model.module._option('urlPrefix', model) || '',\n            urlRoot = model.app._option('urlRoot', model) || '',\n            urlSuffix = model.app._option('urlSuffix', model) || '';\n        var base = model._url() || '';\n\n        urlRoot && parts.push(urlRoot);\n        prefix && parts.push(prefix);\n        parts.push(model.module.name);\n\n        while (base.indexOf('../') === 0) {\n            parts.pop();\n            base = base.slice(3);\n        }\n\n        base && parts.push(base);\n        model.data && model.data[model._idKey] && parts.push(model.data[model._idKey]);\n        urlSuffix && parts.push(parts.pop() + urlSuffix);\n\n        return parts.join('/');\n    },\n    _ajax: function _ajax(method, model, data, options) {\n        var params = Object.assign({ type: method }, options);\n\n        params.data = Object.assign({}, data, params.data);\n        params.url = this._url(model);\n\n        return model.Promise.create(function (resolve, reject) {\n            D.Adapter.ajax(params).then(function () {\n                for (var _len7 = arguments.length, args = Array(_len7), _key7 = 0; _key7 < _len7; _key7++) {\n                    args[_key7] = arguments[_key7];\n                }\n\n                model.set(D.Adapter.ajaxResult(args), !params.slient);\n                resolve(args);\n            }, function () {\n                for (var _len8 = arguments.length, args = Array(_len8), _key8 = 0; _key8 < _len8; _key8++) {\n                    args[_key8] = arguments[_key8];\n                }\n\n                return reject(args);\n            });\n        });\n    }\n};\n\nD.ComponentManager = {\n    _handlers: {},\n    _componentCache: {},\n\n    setDefaultHandler: function setDefaultHandler(creator) {\n        var destructor = arguments.length <= 1 || arguments[1] === undefined ? EMPTY : arguments[1];\n\n        this._defaultHandler = { creator: creator, destructor: destructor };\n    },\n    register: function register(name, creator, destructor) {\n        this._handlers[name] = { creator: creator, destructor: destructor || EMPTY };\n    },\n    _create: function _create(renderable, options) {\n        var _this4 = this;\n\n        var name = options.name;\n        var id = options.id;\n        var selector = options.selector;\n        var opt = options.options;\n\n        if (!name) renderable._error('Component name can not be null');\n\n        var handler = this._handlers[name] || this._defaultHandler;\n        if (!handler) renderable._error('No handler for component:', name);\n\n        var dom = selector ? renderable.$$(selector) : renderable.$(id);\n        var uid = id ? id : D.uniqueId('comp');\n\n        return renderable.chain(handler.creator(renderable, dom, opt), function (component) {\n            var cid = renderable.id + uid,\n                cache = _this4._componentCache[cid],\n                obj = { id: cid, handler: handler, index: D.uniqueId(cid), options: opt };\n\n            D.isArray(cache) ? cache.push(obj) : _this4._componentCache[cid] = cache ? [cache, obj] : obj;\n            return { id: id, component: component, index: obj.index };\n        });\n    },\n    _destroy: function _destroy(renderable, obj) {\n        var _this5 = this;\n\n        var id = renderable.id + obj.id,\n            cache = this._componentCache[id];\n        var current = cache;\n\n        if (D.isArray(cache)) {\n            this._componentCache[id] = [];\n            map(cache, function (item) {\n                item.index !== obj.index ? _this5._componentCache[id].push(item) : current = item;\n            });\n            this._componentCache[id].length === 0 && delete this._componentCache[id];\n        } else {\n            delete this._componentCache[id];\n        }\n\n        current.handler.destructor(renderable, obj.component, current.options);\n    }\n};\n\nD.Base = function () {\n    function Base(name) {\n        var options = arguments.length <= 1 || arguments[1] === undefined ? {} : arguments[1];\n        var defaults = arguments[2];\n\n        _classCallCheck(this, Base);\n\n        this.options = options;\n        this.id = D.uniqueId('D');\n        this.name = name;\n        this.Promise = new D.Promise(this);\n\n        Object.assign(this, defaults);\n        if (options.mixin) this._mixin(options.mixin);\n        this._loadedPromise = this._initialize();\n    }\n\n    _createClass(Base, [{\n        key: '_initialize',\n        value: function _initialize() {}\n    }, {\n        key: '_option',\n        value: function _option(key) {\n            var value = this.options[key];\n\n            for (var _len9 = arguments.length, args = Array(_len9 > 1 ? _len9 - 1 : 0), _key9 = 1; _key9 < _len9; _key9++) {\n                args[_key9 - 1] = arguments[_key9];\n            }\n\n            return D.isFunction(value) ? value.apply(this, args) : value;\n        }\n    }, {\n        key: '_error',\n        value: function _error(message) {\n            if (!D.isString(message)) throw message;\n\n            for (var _len10 = arguments.length, rest = Array(_len10 > 1 ? _len10 - 1 : 0), _key10 = 1; _key10 < _len10; _key10++) {\n                rest[_key10 - 1] = arguments[_key10];\n            }\n\n            throw new Error('[' + (this.module ? this.module.name + ':' : '') + this.name + '] ' + message + ' ' + rest.join(' '));\n        }\n    }, {\n        key: '_mixin',\n        value: function _mixin(obj) {\n            var _this6 = this;\n\n            mapObj(obj, function (value, key) {\n                var old = _this6[key];\n                if (!old) {\n                    _this6[key] = value;\n                    return;\n                }\n\n                if (D.isFunction(old)) {\n                    _this6[key] = function () {\n                        for (var _len11 = arguments.length, args = Array(_len11), _key11 = 0; _key11 < _len11; _key11++) {\n                            args[_key11] = arguments[_key11];\n                        }\n\n                        args.unshift(old);\n                        return value.apply(_this6, args);\n                    };\n                }\n            });\n        }\n    }, {\n        key: 'chain',\n        value: function chain() {\n            var _Promise;\n\n            return (_Promise = this.Promise).chain.apply(_Promise, arguments);\n        }\n    }]);\n\n    return Base;\n}();\n\nD.Renderable = function (_D$Base) {\n    _inherits(Renderable, _D$Base);\n\n    function Renderable(name, app, mod, loader, options) {\n        _classCallCheck(this, Renderable);\n\n        var _this7 = _possibleConstructorReturn(this, Object.getPrototypeOf(Renderable).call(this, name, options, {\n            app: app,\n            module: mod,\n            components: {},\n            _loader: loader,\n            _componentMap: {},\n            _events: {}\n        }));\n\n        _this7._eventHandlers = _this7._option('handlers');\n        app.delegateEvent(_this7);\n        return _this7;\n    }\n\n    _createClass(Renderable, [{\n        key: '_initialize',\n        value: function _initialize() {\n            var _this8 = this;\n\n            this._templateEngine = this._option('templateEngine') || this.module && this.module._templateEngine || this.app._templateEngine;\n            return this.chain([this._templateEngine._load(this), this._initializeEvents()], function (_ref) {\n                var _ref2 = _slicedToArray(_ref, 1);\n\n                var template = _ref2[0];\n                return _this8._template = template;\n            });\n        }\n    }, {\n        key: 'render',\n        value: function render(options) {\n            return this._render(options == null ? this.renderOptions : options, true);\n        }\n    }, {\n        key: '$',\n        value: function $(id) {\n            return this.$$('#' + this._wrapDomId(id))[0];\n        }\n    }, {\n        key: '$$',\n        value: function $$(selector) {\n            return this._element.querySelectorAll(selector);\n        }\n    }, {\n        key: '_render',\n        value: function _render() {\n            var _this9 = this;\n\n            var options = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];\n            var update = arguments[1];\n\n            if (!this._region) this._error('Region is null');\n\n            this.renderOptions = options;\n            return this.chain(this._loadedPromise, this._destroyComponents, function () {\n                return _this9.trigger('beforeRender');\n            }, function () {\n                return _this9._option('beforeRender');\n            }, this._beforeRender, this._serializeData, function (data) {\n                return _this9._renderTemplate(data, update);\n            }, this._renderComponents, this._afterRender, function () {\n                return _this9._option('afterRender');\n            }, function () {\n                return _this9.trigger('afterRender');\n            }, this);\n        }\n    }, {\n        key: '_setRegion',\n        value: function _setRegion(region) {\n            this._region = region;\n            this._bindEvents();\n        }\n    }, {\n        key: '_close',\n        value: function _close() {\n            var _this10 = this;\n\n            if (!this._region) return this.Promise.resolve(this);\n\n            return this.chain(function () {\n                return _this10.trigger('beforeClose');\n            }, function () {\n                return _this10._option('beforeClose');\n            }, this._beforeClose, [this._unbindEvents, this._destroyComponents, function () {\n                return _this10._region._empty(_this10);\n            }], this._afterClose, function () {\n                return _this10._option('afterClose');\n            }, function () {\n                return _this10.trigger('afterClose');\n            }, function () {\n                return delete _this10._region;\n            }, this);\n        }\n    }, {\n        key: '_serializeData',\n        value: function _serializeData() {\n            return {\n                Global: this.app.global,\n                Self: this\n            };\n        }\n    }, {\n        key: '_renderTemplate',\n        value: function _renderTemplate(data, update) {\n            this._templateEngine._execute(this, data, this._template, update);\n        }\n    }, {\n        key: '_initializeEvents',\n        value: function _initializeEvents(events) {\n            var _this11 = this;\n\n            mapObj(events || this._option('events'), function (value, key) {\n                var items = key.replace(/(^\\s+)|(\\s+$)/g, '').split(/\\s+/),\n                    result = { key: key };\n\n                if (items.length !== 2) _this11._error('Invalid event key');\n                result.eventType = items[0];\n                if (items[1].slice(-1) === '*') {\n                    result.id = _this11._wrapDomId(items[1].slice(0, -1));\n                    result.haveStar = true;\n                    result.selector = '[id^=' + result.id + ']';\n                } else {\n                    result.id = _this11._wrapDomId(items[1]);\n                    result.selector = '#' + result.id;\n                }\n                result.handler = _this11._createEventHandler(value, result);\n                _this11._events[key] = result;\n            });\n        }\n    }, {\n        key: '_createEventHandler',\n        value: function _createEventHandler(handlerName, _ref3) {\n            var _this12 = this;\n\n            var haveStar = _ref3.haveStar;\n            var id = _ref3.id;\n            var disabledClass = this.app.options.disabledClass;\n\n            return function (event) {\n                if (!_this12._eventHandlers[handlerName]) _this12._error('No event handler for name:', handlerName);\n\n                var target = D.Adapter.getEventTarget(event),\n                    args = [event];\n                if (D.Adapter.hasClass(target, disabledClass)) return;\n                if (haveStar) args.unshift(target.getAttribute('id').slice(id.length));\n                _this12._eventHandlers[handlerName].apply(_this12, args);\n            };\n        }\n    }, {\n        key: '_bindEvents',\n        value: function _bindEvents() {\n            var _this13 = this;\n\n            mapObj(this._events, function (value) {\n                _this13._region._delegateDomEvent(_this13, value.eventType, value.selector, value.handler);\n            });\n        }\n    }, {\n        key: '_unbindEvents',\n        value: function _unbindEvents() {\n            this._region._undelegateDomEvents(this);\n        }\n    }, {\n        key: '_renderComponents',\n        value: function _renderComponents() {\n            var _this14 = this;\n\n            return this.chain(map(this._option('components'), function (item) {\n                var i = D.isFunction(item) ? item.call(_this14) : item;\n                return i ? D.ComponentManager._create(_this14, i) : null;\n            }), function (components) {\n                return map(components, function (item) {\n                    if (!item) return;\n                    var id = item.id;\n                    var component = item.component;\n                    var index = item.index;var value = _this14.components[id];\n                    D.isArray(value) ? value.push(component) : _this14.components[id] = value ? [value, component] : component;\n                    _this14._componentMap[index] = item;\n                });\n            });\n        }\n    }, {\n        key: '_destroyComponents',\n        value: function _destroyComponents() {\n            var _this15 = this;\n\n            this.components = {};\n            mapObj(this._componentMap, function (value) {\n                return D.ComponentManager._destroy(_this15, value);\n            });\n            this._componentMap = {};\n        }\n    }, {\n        key: '_wrapDomId',\n        value: function _wrapDomId(id) {\n            return this.id + id;\n        }\n    }, {\n        key: '_beforeRender',\n        value: function _beforeRender() {}\n    }, {\n        key: '_afterRender',\n        value: function _afterRender() {}\n    }, {\n        key: '_beforeClose',\n        value: function _beforeClose() {}\n    }, {\n        key: '_afterClose',\n        value: function _afterClose() {}\n    }, {\n        key: '_element',\n        get: function get() {\n            return this._region ? this._region._getElement(this) : null;\n        }\n    }]);\n\n    return Renderable;\n}(D.Base);\n\nD.RenderableContainer = function (_D$Renderable) {\n    _inherits(RenderableContainer, _D$Renderable);\n\n    function RenderableContainer() {\n        _classCallCheck(this, RenderableContainer);\n\n        return _possibleConstructorReturn(this, Object.getPrototypeOf(RenderableContainer).apply(this, arguments));\n    }\n\n    _createClass(RenderableContainer, [{\n        key: '_initialize',\n        value: function _initialize() {\n            var promise = _get(Object.getPrototypeOf(RenderableContainer.prototype), '_initialize', this).call(this);\n\n            this._items = {};\n            return this.chain(promise, this._initializeItems);\n        }\n    }, {\n        key: '_afterRender',\n        value: function _afterRender() {\n            return this.chain(this._initializeRegions, this._renderItems);\n        }\n    }, {\n        key: '_afterClose',\n        value: function _afterClose() {\n            return this._closeRegions();\n        }\n    }, {\n        key: '_initializeItems',\n        value: function _initializeItems() {\n            var _this17 = this;\n\n            this.chain(mapObj(this._option('items'), function () {\n                var options = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];\n                var name = arguments[1];\n\n                var opt = D.isFunction(options) ? options.call(_this17) : options;\n                if (D.isString(opt)) opt = { region: opt };\n\n                return _this17.app[options.isModule ? '_createModule' : '_createView'](name, _this17).then(function (item) {\n                    var i = item;\n                    i.moduleOptions = opt;\n                    _this17._items[name] = item;\n                    return item;\n                });\n            }));\n        }\n    }, {\n        key: '_initializeRegions',\n        value: function _initializeRegions() {\n            var _this18 = this;\n\n            this._regions = {};\n            return this.chain(this.closeRegions, map(this.$$('[data-region]'), function (el) {\n                var region = _this18._createRegion(el);\n                _this18._regions[region.name] = region;\n            }));\n        }\n    }, {\n        key: '_renderItems',\n        value: function _renderItems() {\n            var _this19 = this;\n\n            return this.chain(mapObj(this.items, function (item) {\n                var region = item.moduleOptions.region;\n\n                if (!region) return;\n                if (!_this19.regions[region]) _this19._error('Region: ' + region + ' is not defined');\n                _this19.regions[region].show(item);\n            }), this);\n        }\n    }, {\n        key: '_createRegion',\n        value: function _createRegion(el) {\n            var name = el.getAttribute('data-region');\n            return this.app._createRegion(el, name, this);\n        }\n    }, {\n        key: '_closeRegions',\n        value: function _closeRegions() {\n            var regions = this._regions;\n            if (!regions) return this;\n            delete this._regions;\n            return this.chain(mapObj(regions, function (region) {\n                return region.close();\n            }), this);\n        }\n    }, {\n        key: 'items',\n        get: function get() {\n            return this._items || {};\n        }\n    }, {\n        key: 'regions',\n        get: function get() {\n            return this._regions || {};\n        }\n    }]);\n\n    return RenderableContainer;\n}(D.Renderable);\n\nD.ActionCreator = function (_D$Renderable2) {\n    _inherits(ActionCreator, _D$Renderable2);\n\n    function ActionCreator() {\n        _classCallCheck(this, ActionCreator);\n\n        return _possibleConstructorReturn(this, Object.getPrototypeOf(ActionCreator).apply(this, arguments));\n    }\n\n    _createClass(ActionCreator, [{\n        key: '_initializeEvents',\n        value: function _initializeEvents() {\n            _get(Object.getPrototypeOf(ActionCreator.prototype), '_initializeEvents', this).call(this);\n            _get(Object.getPrototypeOf(ActionCreator.prototype), '_initializeEvents', this).call(this, this._option('actions'));\n        }\n    }, {\n        key: '_createEventHandler',\n        value: function _createEventHandler(name, obj) {\n            var isAction = !!(this._option('actions') || {})[obj.key];\n            return isAction ? this._createAction(name) : _get(Object.getPrototypeOf(ActionCreator.prototype), '_createEventHandler', this).call(this, name, obj);\n        }\n    }, {\n        key: '_createAction',\n        value: function _createAction(name) {\n            var _this21 = this;\n\n            var disabledClass = this.app.options.disabledClass;\n\n            var _ref4 = this._option('dataForActions') || {};\n\n            var dataForAction = _ref4[name];\n\n            var _ref5 = this._option('actionCallbacks') || {};\n\n            var actionCallback = _ref5[name];\n\n            return function (e) {\n                var target = D.Adapter.getEventTarget(event);\n                if (D.Adapter.hasClass(target, disabledClass)) return;\n                D.Adapter.addClass(target, disabledClass);\n\n                var data = _this21._getActionPayload(target);\n                _this21.chain(D.isFunction(dataForAction) ? dataForAction.call(_this21, data, e) : data, function (payload) {\n                    return payload !== false ? _this21.module.dispatch(name, payload) : false;\n                }, function (result) {\n                    return result !== false ? actionCallback && actionCallback.call(_this21, result) : false;\n                }).then(function () {\n                    return D.Adapter.removeClass(target, disabledClass);\n                }, function () {\n                    return D.Adapter.removeClass(target, disabledClass);\n                });\n            };\n        }\n    }, {\n        key: '_getActionPayload',\n        value: function _getActionPayload(target) {\n            var rootEl = this._element;\n            var current = target,\n                targetName = false;\n            while (current && current !== rootEl && current.tagName !== 'FORM') {\n                current = current.parentNode;\n            }current || (current = rootEl);\n            var data = current.tagName === 'FORM' ? D.Adapter.getFormData(current) : {};\n            map(current.querySelectorAll('[data-name][data-value]'), function (item) {\n                if (item === target) {\n                    targetName = target.getAttribute('data-name');\n                    data[targetName] = target.getAttribute('data-value');\n                    return;\n                }\n\n                var name = item.getAttribute('data-name');\n                if (targetName && targetName === name) return;\n\n                var value = item.getAttribute('data-value'),\n                    v = data[name];\n                D.isArray(v) ? v.push(value) : data[name] = v == null ? value : [v, value];\n            });\n            return data;\n        }\n    }]);\n\n    return ActionCreator;\n}(D.Renderable);\n\nD.View = function (_D$ActionCreator) {\n    _inherits(View, _D$ActionCreator);\n\n    function View() {\n        _classCallCheck(this, View);\n\n        return _possibleConstructorReturn(this, Object.getPrototypeOf(View).apply(this, arguments));\n    }\n\n    _createClass(View, [{\n        key: '_initialize',\n        value: function _initialize() {\n            this.bindings = {};\n            return this.chain(_get(Object.getPrototypeOf(View.prototype), '_initialize', this).call(this), this._initializeDataBinding);\n        }\n    }, {\n        key: '_initializeDataBinding',\n        value: function _initializeDataBinding() {\n            var _this23 = this;\n\n            this._dataBinding = {};\n            mapObj(this._option('bindings'), function (value, key) {\n                var model = _this23.bindings[key] = _this23.module.store.models[key];\n                if (!model) _this23._error('No model:', key);\n\n                if (!value) return;\n                _this23._dataBinding[key] = { model: model, value: value, fn: function fn() {\n                        if (value === true && _this23._region) _this23.render(_this23.renderOptions);\n                        if (D.isString(value)) _this23._option(value);\n                    } };\n            });\n        }\n    }, {\n        key: '_bindData',\n        value: function _bindData() {\n            var _this24 = this;\n\n            mapObj(this._dataBinding, function (value) {\n                return _this24.listenTo(value.model, 'changed', value.fn);\n            });\n        }\n    }, {\n        key: '_unbindData',\n        value: function _unbindData() {\n            this.stopListening();\n            this.bindings = {};\n        }\n    }, {\n        key: '_setRegion',\n        value: function _setRegion() {\n            var _get2;\n\n            for (var _len12 = arguments.length, args = Array(_len12), _key12 = 0; _key12 < _len12; _key12++) {\n                args[_key12] = arguments[_key12];\n            }\n\n            (_get2 = _get(Object.getPrototypeOf(View.prototype), '_setRegion', this)).call.apply(_get2, [this].concat(args));\n            this._bindData();\n        }\n    }, {\n        key: '_close',\n        value: function _close() {\n            var _get3;\n\n            for (var _len13 = arguments.length, args = Array(_len13), _key13 = 0; _key13 < _len13; _key13++) {\n                args[_key13] = arguments[_key13];\n            }\n\n            this.chain((_get3 = _get(Object.getPrototypeOf(View.prototype), '_close', this)).call.apply(_get3, [this].concat(args)), this._unbindData, this);\n        }\n    }, {\n        key: '_serializeData',\n        value: function _serializeData() {\n            var _this25 = this;\n\n            var data = _get(Object.getPrototypeOf(View.prototype), '_serializeData', this).call(this);\n            mapObj(this.bindings, function (value, key) {\n                return data[key] = value.get(true);\n            });\n            mapObj(this._option('dataForTemplate'), function (value, key) {\n                return data[key] = value.call(_this25, data);\n            });\n            return data;\n        }\n    }]);\n\n    return View;\n}(D.ActionCreator);\n\nD.Module = function (_D$RenderableContaine) {\n    _inherits(Module, _D$RenderableContaine);\n\n    function Module() {\n        _classCallCheck(this, Module);\n\n        return _possibleConstructorReturn(this, Object.getPrototypeOf(Module).apply(this, arguments));\n    }\n\n    _createClass(Module, [{\n        key: '_initialize',\n        value: function _initialize() {\n            this.app._modules[this.name + '--' + this.id] = this;\n            this._initializeStore();\n            return _get(Object.getPrototypeOf(Module.prototype), '_initialize', this).call(this);\n        }\n    }, {\n        key: 'dispatch',\n        value: function dispatch(name, payload) {\n            return this._store.dispatch(name, payload);\n        }\n    }, {\n        key: '_initializeStore',\n        value: function _initializeStore() {\n            this._store = this.app._createStore(this, this._option('store'));\n        }\n    }, {\n        key: '_afterClose',\n        value: function _afterClose() {\n            delete this.app._modules[this.name + '--' + this.id];\n            this._store._destory();\n            return _get(Object.getPrototypeOf(Module.prototype), '_afterClose', this).call(this);\n        }\n    }, {\n        key: '_beforeRender',\n        value: function _beforeRender() {\n            var _this27 = this;\n\n            return this.chain(_get(Object.getPrototypeOf(Module.prototype), '_beforeRender', this).call(this), function () {\n                return _this27._store._loadEagerModels();\n            });\n        }\n    }, {\n        key: '_afterRender',\n        value: function _afterRender() {\n            var _this28 = this;\n\n            return this.chain(_get(Object.getPrototypeOf(Module.prototype), '_afterRender', this).call(this), function () {\n                return _this28._store._loadLazyModels();\n            });\n        }\n    }, {\n        key: 'store',\n        get: function get() {\n            return this._store;\n        }\n    }]);\n\n    return Module;\n}(D.RenderableContainer);\n\nvar CAPTURES = ['blur', 'focus', 'scroll', 'resize'];\n\nD.Region = function (_D$Base2) {\n    _inherits(Region, _D$Base2);\n\n    function Region(app, mod, el, name) {\n        _classCallCheck(this, Region);\n\n        var _this29 = _possibleConstructorReturn(this, Object.getPrototypeOf(Region).call(this, name || 'Region', {}, {\n            app: app,\n            module: mod,\n            _el: el,\n            _delegated: {}\n        }));\n\n        if (!_this29._el) _this29._error('The DOM element for region is required');\n        app.delegateEvent(_this29);\n        return _this29;\n    }\n\n    _createClass(Region, [{\n        key: 'show',\n        value: function show(renderable) {\n            var _this30 = this;\n\n            var options = arguments.length <= 1 || arguments[1] === undefined ? {} : arguments[1];\n\n            if (this._isCurrent(renderable)) {\n                if (options.forceRender === false) return this.Promise.resolve(this._current);\n                return this._current._render(options, true);\n            }\n\n            return this.chain(D.isString(renderable) ? this.app._createModule(renderable) : renderable, function (item) {\n                if (!(item instanceof D.Renderable)) {\n                    _this30._error('The item is expected to be an instance of Renderable');\n                }\n                return item;\n            }, [function (item) {\n                return _this30.chain(item._region && item._region.close(), item);\n            }, function () {\n                return _this30.close();\n            }], function (_ref6) {\n                var _ref7 = _slicedToArray(_ref6, 1);\n\n                var item = _ref7[0];\n\n                _this30._current = item;\n                var attr = item.module ? item.module.name + ':' + item.name : item.name;\n                _this30._getElement().setAttribute('data-current', attr);\n                item._setRegion(_this30);\n                return item;\n            }, function (item) {\n                return item._render(options, false);\n            });\n        }\n    }, {\n        key: 'close',\n        value: function close() {\n            var _this31 = this;\n\n            return this.chain(this._current && this._current._close(), function () {\n                return delete _this31._current;\n            }, this);\n        }\n    }, {\n        key: '$$',\n        value: function $$(selector) {\n            return this._getElement().querySelectorAll(selector);\n        }\n    }, {\n        key: '_isCurrent',\n        value: function _isCurrent(renderable) {\n            if (!this._current) return false;\n            if (this._current.name === renderable) return true;\n            if (renderable && renderable.id === this._current.id) return true;\n            return false;\n        }\n    }, {\n        key: '_getElement',\n        value: function _getElement() {\n            return this._el;\n        }\n    }, {\n        key: '_empty',\n        value: function _empty() {\n            this._getElement().innerHTML = '';\n        }\n    }, {\n        key: '_createDelegateListener',\n        value: function _createDelegateListener(name) {\n            var _this32 = this;\n\n            return function (e) {\n                if (!_this32._delegated[name]) return;\n                var target = e.target;\n\n                map(_this32._delegated[name].items, function (item) {\n                    var els = _this32._getElement().querySelectorAll(item.selector);\n                    var matched = false;\n                    for (var i = 0; i < els.length; i++) {\n                        var el = els[i];\n                        if (el === target || el.contains(target)) {\n                            matched = el;\n                            break;\n                        }\n                    }\n                    matched && item.fn.call(item.renderable, e);\n                });\n            };\n        }\n    }, {\n        key: '_delegateDomEvent',\n        value: function _delegateDomEvent(renderable, name, selector, fn) {\n            var obj = this._delegated[name];\n            if (!obj) {\n                obj = this._delegated[name] = { listener: this._createDelegateListener(name), items: [] };\n                D.Adapter.addEventListener(this._getElement(), name, obj.listener, CAPTURES.indexOf(name) !== -1);\n            }\n            obj.items.push({ selector: selector, fn: fn, renderable: renderable });\n        }\n    }, {\n        key: '_undelegateDomEvents',\n        value: function _undelegateDomEvents(renderable) {\n            var _this33 = this;\n\n            mapObj(this._delegated, function (value, key) {\n                var items = [],\n                    obj = value;\n                map(obj.items, function (item) {\n                    if (item.renderable !== renderable) items.push(item);\n                });\n                obj.items = items;\n                if (items.length === 0) {\n                    delete _this33._delegated[key];\n                    D.Adapter.removeEventListener(_this33._getElement(), key, obj.listener);\n                }\n            });\n        }\n    }]);\n\n    return Region;\n}(D.Base);\n\nD.TemplateEngine = function (_D$Base3) {\n    _inherits(TemplateEngine, _D$Base3);\n\n    function TemplateEngine(options) {\n        _classCallCheck(this, TemplateEngine);\n\n        return _possibleConstructorReturn(this, Object.getPrototypeOf(TemplateEngine).call(this, 'Template Engine', options, { _templateCache: {} }));\n    }\n\n    _createClass(TemplateEngine, [{\n        key: 'executeIdReplacement',\n        value: function executeIdReplacement(el, renderable) {\n            var _this35 = this;\n\n            var used = {};\n            map(el.querySelectorAll('[id]'), function (item) {\n                var id = item.getAttribute('id');\n                if (used[id]) _this35._error('Dom ID: ' + id + ' is already used');\n                used[id] = true;\n                item.setAttribute('id', renderable._wrapDomId(id));\n            });\n\n            var attrs = this._option('attributesReferToId') || ['for', 'data-target', 'data-parent'];\n\n            map(attrs, function (attr) {\n                return map(el.querySelectorAll('[' + attr + ']'), function (item) {\n                    var value = item.getAttribute(attr),\n                        withHash = value.charAt(0) === '#',\n                        wrapped = withHash ? '#' + renderable._wrapDomId(value.slice(1)) : renderable._wrapDomId(value);\n                    item.setAttribute(attr, wrapped);\n                });\n            });\n        }\n    }, {\n        key: '_load',\n        value: function _load(renderable) {\n            var id = renderable.id;\n            if (this._templateCache[id]) return this._templateCache[id];\n            return this._templateCache[id] = this._loadIt(renderable);\n        }\n    }, {\n        key: '_loadIt',\n        value: function _loadIt(renderable) {\n            if (renderable instanceof Drizzle.Module) {\n                return renderable._loader.loadModuleResource(renderable, 'templates');\n            }\n\n            return function () {\n                return renderable.module._template;\n            };\n        }\n    }, {\n        key: '_execute',\n        value: function _execute(renderable, data, template /* , update */) {\n            var el = renderable._element;\n            el.innerHTML = template(data);\n            this.executeIdReplacement(el, renderable);\n        }\n    }]);\n\n    return TemplateEngine;\n}(D.Base);\n\nD.Store = function (_D$Base4) {\n    _inherits(Store, _D$Base4);\n\n    function Store(mod, options) {\n        _classCallCheck(this, Store);\n\n        var _this36 = _possibleConstructorReturn(this, Object.getPrototypeOf(Store).call(this, 'Store', options, {\n            app: mod.app,\n            module: mod,\n            _models: {}\n        }));\n\n        _this36.app.delegateEvent(_this36);\n\n        _this36._callbacks = _this36._option('callbacks');\n        mapObj(_this36._callbacks, function (value, key) {\n            if (key.slice(0, 4) !== 'app.') return;\n            _this36.listenTo(_this36.app, key, function (payload) {\n                return value.call(_this36._callbackContext, payload);\n            });\n        });\n        return _this36;\n    }\n\n    _createClass(Store, [{\n        key: 'dispatch',\n        value: function dispatch(name, payload) {\n            var callback = undefined,\n                n = name,\n                p = payload;\n            if (D.isObject(n)) {\n                p = n.payload;\n                n = n.name;\n            }\n\n            callback = this._callbacks[n];\n            if (!callback) this._error('No action callback for name: ' + name);\n            return this.chain(callback.call(this._callbackContext, p));\n        }\n    }, {\n        key: '_initialize',\n        value: function _initialize() {\n            this._initializeModels();\n            this._callbackContext = Object.assign({\n                models: this.models,\n                module: this.module,\n                app: this.app\n            }, D.Request);\n        }\n    }, {\n        key: '_initializeModels',\n        value: function _initializeModels() {\n            var _this37 = this;\n\n            mapObj(this._option('models'), function (value, key) {\n                var v = (D.isFunction(value) ? value.call(_this37) : value) || {};\n                if (v.shared === true) {\n                    _this37._models[key] = _this37.app.viewport.store.models[key];\n                    return;\n                }\n                _this37._models[key] = _this37.app._createModel(_this37, v);\n            });\n        }\n    }, {\n        key: '_loadEagerModels',\n        value: function _loadEagerModels() {\n            return this.chain(mapObj(this._models, function (model) {\n                return model.options.autoLoad === true ? D.Request.get(model) : null;\n            }));\n        }\n    }, {\n        key: '_loadLazyModels',\n        value: function _loadLazyModels() {\n            return this.chain(mapObj(this._models, function (model) {\n                var autoLoad = model.options.autoLoad;\n\n                return autoLoad && autoLoad !== true ? D.Request.get(model) : null;\n            }));\n        }\n    }, {\n        key: '_destory',\n        value: function _destory() {\n            this.stopListening();\n        }\n    }, {\n        key: 'models',\n        get: function get() {\n            return this._models;\n        }\n    }]);\n\n    return Store;\n}(D.Base);\n\nD.Model = function (_D$Base5) {\n    _inherits(Model, _D$Base5);\n\n    function Model(store, options) {\n        _classCallCheck(this, Model);\n\n        var _this38 = _possibleConstructorReturn(this, Object.getPrototypeOf(Model).call(this, 'Model', options, {\n            app: store.module.app,\n            module: store.module,\n            store: store\n        }));\n\n        _this38._data = _this38._option('data') || {};\n        _this38._idKey = _this38._option('idKey') || _this38.app.options.idKey;\n        _this38._params = Object.assign({}, _this38._option('params'));\n        _this38.app.delegateEvent(_this38);\n        return _this38;\n    }\n\n    _createClass(Model, [{\n        key: 'set',\n        value: function set(data, trigger) {\n            var d = this.options.parse ? this._option('parse', data) : data;\n            this._data = this.options.root ? d[this.options.root] : d;\n            if (trigger) this.changed();\n        }\n    }, {\n        key: 'get',\n        value: function get(cloneIt) {\n            return cloneIt ? clone(this._data) : this._data;\n        }\n    }, {\n        key: 'clear',\n        value: function clear(trigger) {\n            this._data = D.isArray(this._data) ? [] : {};\n            if (trigger) this.changed();\n        }\n    }, {\n        key: 'changed',\n        value: function changed() {\n            this.trigger('changed');\n        }\n    }, {\n        key: '_url',\n        value: function _url() {\n            return this._option('url') || '';\n        }\n    }, {\n        key: 'fullUrl',\n        get: function get() {\n            return D.Request._url(this);\n        }\n    }, {\n        key: 'params',\n        get: function get() {\n            return this._params;\n        }\n    }, {\n        key: 'data',\n        get: function get() {\n            return this._data;\n        }\n    }]);\n\n    return Model;\n}(D.Base);\n\nD.Loader = function (_D$Base6) {\n    _inherits(Loader, _D$Base6);\n\n    _createClass(Loader, null, [{\n        key: '_analyse',\n        value: function _analyse(name) {\n            if (!D.isString(name)) {\n                return { loader: null, name: name };\n            }\n\n            var args = name.split(':'),\n                loader = args.length > 1 ? args.shift() : null;\n\n            return { loader: loader, name: args.shift(), args: args };\n        }\n    }]);\n\n    function Loader(app, options) {\n        _classCallCheck(this, Loader);\n\n        return _possibleConstructorReturn(this, Object.getPrototypeOf(Loader).call(this, 'Loader', options, { app: app }));\n    }\n\n    _createClass(Loader, [{\n        key: 'loadResource',\n        value: function loadResource(path) {\n            var _this40 = this;\n\n            var _app$options = this.app.options;\n            var scriptRoot = _app$options.scriptRoot;\n            var getResource = _app$options.getResource;\n            var amd = _app$options.amd;\n            var fullPath = scriptRoot + '/' + path;\n\n            return this.Promise.create(function (resolve, reject) {\n                if (amd) {\n                    require([fullPath], resolve, reject);\n                } else if (getResource) {\n                    resolve(getResource.call(_this40.app, fullPath));\n                } else {\n                    resolve(require('./' + fullPath));\n                }\n            });\n        }\n    }, {\n        key: 'loadModuleResource',\n        value: function loadModuleResource(mod, path) {\n            return this.loadResource(mod.name + '/' + path);\n        }\n    }, {\n        key: 'loadModule',\n        value: function loadModule(name) {\n            return this.loadResource(name + '/' + this.app.options.fileNames.module);\n        }\n    }, {\n        key: 'loadView',\n        value: function loadView(name, mod) {\n            return this.loadModuleResource(mod, '' + this.app.options.fileNames.view + name);\n        }\n    }, {\n        key: 'loadRouter',\n        value: function loadRouter(path) {\n            var name = this.app.options.fileNames.router;\n            return this.loadResource(path ? path + '/' + name : name);\n        }\n    }]);\n\n    return Loader;\n}(D.Base);\n\nD.Application = function (_D$Base7) {\n    _inherits(Application, _D$Base7);\n\n    function Application(options) {\n        _classCallCheck(this, Application);\n\n        return _possibleConstructorReturn(this, Object.getPrototypeOf(Application).call(this, options && options.name || 'Application', Object.assign({\n            scriptRoot: 'app',\n            urlRoot: '',\n            urlSuffix: '',\n            caseSensitiveHash: false,\n            defaultRegion: root && root.document.body,\n            disabledClass: 'disabled',\n            getResource: null,\n            idKey: 'id',\n            viewport: 'viewport',\n\n            fileNames: {\n                module: 'index',\n                view: 'view-',\n                router: 'router'\n            }\n        }, options), {\n            global: {},\n            _modules: {},\n            _loaders: {}\n        }));\n    }\n\n    _createClass(Application, [{\n        key: '_initialize',\n        value: function _initialize() {\n            this._templateEngine = this._option('templateEngine') || new D.TemplateEngine();\n            this.registerLoader('default', new D.Loader(this), true);\n            this._region = this._createRegion(this._option('defaultRegion'), 'Region');\n        }\n    }, {\n        key: 'registerLoader',\n        value: function registerLoader(name, loader, isDefault) {\n            this._loaders[name] = loader;\n            if (isDefault) this._defaultLoader = loader;\n            return this;\n        }\n    }, {\n        key: 'start',\n        value: function start(defaultHash) {\n            var _router,\n                _this42 = this;\n\n            if (defaultHash) this._router = new D.Router(this);\n\n            return this.chain(defaultHash ? (_router = this._router)._mountRoutes.apply(_router, _toConsumableArray(this._option('routers'))) : false, this._region.show(this._option('viewport')), function (viewport) {\n                return _this42.viewport = viewport;\n            }, function () {\n                return defaultHash && _this42._router._start(defaultHash);\n            }, this);\n        }\n    }, {\n        key: 'stop',\n        value: function stop() {\n            this.off();\n            this._region.close();\n            if (this._router) this._router._stop();\n        }\n    }, {\n        key: 'navigate',\n        value: function navigate(hash, trigger) {\n            if (!this._router) return;\n            this._router.navigate(hash, trigger);\n        }\n    }, {\n        key: 'dispatch',\n        value: function dispatch(name, payload) {\n            var n = D.isObject(name) ? name.name : name,\n                p = D.isObject(name) ? name.payload : payload;\n            this.trigger('app.' + n, p);\n        }\n    }, {\n        key: 'show',\n        value: function show(region, moduleName, options) {\n            return this.viewport.regions[region].show(moduleName, options);\n        }\n    }, {\n        key: '_getLoader',\n        value: function _getLoader(name, mod) {\n            return name && this._loaders[name] || mod && mod._loader || this._defaultLoader;\n        }\n    }, {\n        key: '_createModule',\n        value: function _createModule(name, parentModule) {\n            var _this43 = this;\n\n            var _D$Loader$_analyse = D.Loader._analyse(name);\n\n            var moduleName = _D$Loader$_analyse.name;\n            var loaderName = _D$Loader$_analyse.loader;\n            var loader = this._getLoader(loaderName, parent);\n\n            return this.chain(loader.loadModule(moduleName), function () {\n                var options = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];\n\n                return typeCache.createModule(options.type, moduleName, _this43, parentModule, loader, options);\n            });\n        }\n    }, {\n        key: '_createView',\n        value: function _createView(name, mod) {\n            var _this44 = this;\n\n            var _D$Loader$_analyse2 = D.Loader._analyse(name);\n\n            var viewName = _D$Loader$_analyse2.name;\n            var loaderName = _D$Loader$_analyse2.loader;\n            var loader = this._getLoader(loaderName, mod);\n\n            return this.chain(loader.loadView(viewName, mod), function () {\n                var options = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];\n\n                return typeCache.createView(options.type, viewName, _this44, mod, loader, options);\n            });\n        }\n    }, {\n        key: '_createRegion',\n        value: function _createRegion(el, name, mod) {\n            var _D$Loader$_analyse3 = D.Loader._analyse(name);\n\n            var regionName = _D$Loader$_analyse3.name;\n            var type = _D$Loader$_analyse3.loader;\n\n            return typeCache.createRegion(type, this, mod, el, regionName);\n        }\n    }, {\n        key: '_createStore',\n        value: function _createStore(mod) {\n            var options = arguments.length <= 1 || arguments[1] === undefined ? {} : arguments[1];\n\n            return typeCache.createStore(options.type, mod, options);\n        }\n    }, {\n        key: '_createModel',\n        value: function _createModel(store) {\n            var options = arguments.length <= 1 || arguments[1] === undefined ? {} : arguments[1];\n\n            return typeCache.createModel(options.type, store, options);\n        }\n    }]);\n\n    return Application;\n}(D.Base);\n\nObject.assign(D.Application.prototype, D.Event);\n\nvar PUSH_STATE_SUPPORTED = root && root.history && 'pushState' in root.history;\nvar ROUTER_REGEXPS = [/:([\\w\\d]+)/g, '([^\\/]+)', /\\*([\\w\\d]+)/g, '(.*)'];\n\nvar Route = function () {\n    function Route(app, router, path, fn) {\n        _classCallCheck(this, Route);\n\n        var pattern = path.replace(ROUTER_REGEXPS[0], ROUTER_REGEXPS[1]).replace(ROUTER_REGEXPS[2], ROUTER_REGEXPS[3]);\n\n        this.pattern = new RegExp('^' + pattern + '$', app.options.caseSensitiveHash ? 'g' : 'gi');\n\n        this.app = app;\n        this.router = router;\n        this.path = path;\n        this.fn = fn;\n    }\n\n    _createClass(Route, [{\n        key: 'match',\n        value: function match(hash) {\n            this.pattern.lastIndex = 0;\n            return this.pattern.test(hash);\n        }\n    }, {\n        key: 'handle',\n        value: function handle(hash) {\n            var _router2,\n                _this45 = this;\n\n            this.pattern.lastIndex = 0;\n            var args = this.pattern.exec(hash).slice(1),\n                handlers = this.router._getInterceptors(this.path);\n\n            handlers.push(this.fn);\n            return (_router2 = this.router).chain.apply(_router2, _toConsumableArray(map(handlers, function (fn, i) {\n                return function (prev) {\n                    return fn.apply(_this45.router, i > 0 ? [prev].concat(args) : args);\n                };\n            })));\n        }\n    }]);\n\n    return Route;\n}();\n\nD.Router = function (_D$Base8) {\n    _inherits(Router, _D$Base8);\n\n    function Router(app) {\n        _classCallCheck(this, Router);\n\n        var _this46 = _possibleConstructorReturn(this, Object.getPrototypeOf(Router).call(this, 'Router', {}, {\n            app: app,\n            _routes: [],\n            _interceptors: {},\n            _started: false\n        }));\n\n        _this46._EVENT_HANDLER = function () {\n            return _this46._dispath(_this46._getHash());\n        };\n        return _this46;\n    }\n\n    _createClass(Router, [{\n        key: 'navigate',\n        value: function navigate(path, trigger) {\n            if (!this._started) return;\n            if (PUSH_STATE_SUPPORTED) {\n                root.history.pushState({}, root.document.title, '#' + path);\n            } else {\n                root.location.replace('#' + path);\n            }\n\n            if (trigger !== false) this._dispath(path);\n        }\n    }, {\n        key: '_start',\n        value: function _start(defaultPath) {\n            if (this._started || !root) return;\n            D.Adapter.addEventListener(root, 'hashchange', this._EVENT_HANDLER, false);\n\n            var hash = this._getHash() || defaultPath;\n            this._started = true;\n            if (hash) this.navigate(hash);\n        }\n    }, {\n        key: '_stop',\n        value: function _stop() {\n            if (!this._started) return;\n            D.Adapter.removeEventListener(root, 'hashchange', this._EVENT_HANDLER);\n            this._started = false;\n        }\n    }, {\n        key: '_dispath',\n        value: function _dispath(path) {\n            if (path === this._previousHash) return;\n            this._previousHash = path;\n\n            for (var i = 0; i < this._routes.length; i++) {\n                var route = this._routes[i];\n                if (route.match(path)) {\n                    route.handle(path);\n                    return;\n                }\n            }\n        }\n    }, {\n        key: '_mountRoutes',\n        value: function _mountRoutes() {\n            var _this47 = this;\n\n            var paths = slice.call(arguments);\n            return this.chain(map(paths, function (path) {\n                return _this47.app._getLoader(path).loadRouter(path);\n            }), function (options) {\n                return map(options, function (option, i) {\n                    return _this47._addRoute(paths[i], option);\n                });\n            });\n        }\n    }, {\n        key: '_addRoute',\n        value: function _addRoute(path, options) {\n            var _this48 = this;\n\n            var routes = options.routes;\n            var interceptors = options.interceptors;\n\n            mapObj(D.isFunction(routes) ? routes.apply(this) : routes, function (value, key) {\n                var p = (path + '/' + key).replace(/^\\/|\\/$/g, '');\n                _this48._routes.unshift(new Route(_this48.app, _this48, p, options[value]));\n            });\n\n            mapObj(D.isFunction(interceptors) ? interceptors.apply(this) : interceptors, function (value, key) {\n                var p = (path + '/' + key).replace(/^\\/|\\/$/g, '');\n                _this48._interceptors[p] = options[value];\n            });\n        }\n    }, {\n        key: '_getInterceptors',\n        value: function _getInterceptors(path) {\n            var result = [],\n                items = path.split('/');\n\n            items.pop();\n            while (items.length > 0) {\n                var key = items.join('/');\n                if (this._interceptors[key]) result.unshift(this._interceptors[key]);\n                items.pop();\n            }\n\n            if (this._interceptors['']) result.unshift(this._interceptors['']);\n            return result;\n        }\n    }, {\n        key: '_getHash',\n        value: function _getHash() {\n            return root.location.hash.slice(1);\n        }\n    }]);\n\n    return Router;\n}(D.Base);\n\nvar PAGE_DEFAULT_OPTIONS = {\n    pageSize: 10,\n    pageKey: '_page',\n    pageSizeKey: 'pageSize',\n    recordCountKey: 'recordCount',\n    params: function params(item) {\n        return item;\n    }\n};\n\nD.PageableModel = function (_D$Model) {\n    _inherits(PageableModel, _D$Model);\n\n    _createClass(PageableModel, null, [{\n        key: 'setDefault',\n        value: function setDefault(defaults) {\n            Object.assign(PAGE_DEFAULT_OPTIONS, defaults);\n        }\n    }]);\n\n    function PageableModel(store, options) {\n        _classCallCheck(this, PageableModel);\n\n        var _this49 = _possibleConstructorReturn(this, Object.getPrototypeOf(PageableModel).call(this, store, options));\n\n        _this49._data = _this49._option('data') || [];\n        _this49._p = {\n            page: _this49._option('page') || 1,\n            pageCount: 0,\n            pageSize: _this49._option('pageSize') || PAGE_DEFAULT_OPTIONS.pageSize,\n            pageKey: _this49._option('pageKey') || PAGE_DEFAULT_OPTIONS.pageKey,\n            pageSizeKey: _this49._option('pageSizeKey') || PAGE_DEFAULT_OPTIONS.pageSizeKey,\n            recordCountKey: _this49._option('recordCountKey') || PAGE_DEFAULT_OPTIONS.recordCountKey\n        };\n        return _this49;\n    }\n\n    _createClass(PageableModel, [{\n        key: 'set',\n        value: function set() {\n            var data = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];\n            var trigger = arguments[1];\n\n            this._p.recordCount = data[this._p.recordCountKey] || 0;\n            this._p.pageCount = Math.ceil(this._p.recordCount / this._p.pageSize);\n            _get(Object.getPrototypeOf(PageableModel.prototype), 'set', this).call(this, data, trigger);\n        }\n    }, {\n        key: 'clear',\n        value: function clear(trigger) {\n            this._p.page = 1;\n            this._p.recordCount = 0;\n            this._p.pageCount = 0;\n            _get(Object.getPrototypeOf(PageableModel.prototype), 'clear', this).call(this, trigger);\n        }\n    }, {\n        key: 'turnToPage',\n        value: function turnToPage(page) {\n            if (page <= this._p.pageCount && page >= 1) this._p.page = page;\n            return this;\n        }\n    }, {\n        key: 'firstPage',\n        value: function firstPage() {\n            return this.turnToPage(1);\n        }\n    }, {\n        key: 'lastPage',\n        value: function lastPage() {\n            return this.turnToPage(this._p.pageCount);\n        }\n    }, {\n        key: 'nextPage',\n        value: function nextPage() {\n            return this.turnToPage(this._p.page + 1);\n        }\n    }, {\n        key: 'prevPage',\n        value: function prevPage() {\n            return this.turnToPage(this._p.page - 1);\n        }\n    }, {\n        key: 'params',\n        get: function get() {\n            var _p = this._p;\n            var page = _p.page;\n            var pageKey = _p.pageKey;\n            var pageSizeKey = _p.pageSizeKey;\n            var pageSize = _p.pageSize;\n\n            var params = _get(Object.getPrototypeOf(PageableModel.prototype), 'params', this);\n            params[pageKey] = page;\n            params[pageSizeKey] = pageSize;\n            return PAGE_DEFAULT_OPTIONS.params(params);\n        }\n    }, {\n        key: 'pageInfo',\n        get: function get() {\n            var _p2 = this._p;\n            var page = _p2.page;\n            var pageSize = _p2.pageSize;\n            var recordCount = _p2.recordCount;\n\n            var result = undefined;\n            if (this.data && this.data.length > 0) {\n                result = { page: page, start: (page - 1) * pageSize + 1, end: page * pageSize, total: recordCount };\n            } else {\n                result = { page: page, start: 0, end: 0, total: 0 };\n            }\n\n            if (result.end > result.total) result.end = result.total;\n            return result;\n        }\n    }]);\n\n    return PageableModel;\n}(D.Model);\n\nD.registerModel('pageable', D.PageableModel);\n\nD.MultiRegion = function (_D$Region) {\n    _inherits(MultiRegion, _D$Region);\n\n    function MultiRegion() {\n        _classCallCheck(this, MultiRegion);\n\n        return _possibleConstructorReturn(this, Object.getPrototypeOf(MultiRegion).apply(this, arguments));\n    }\n\n    _createClass(MultiRegion, [{\n        key: '_initialize',\n        value: function _initialize() {\n            this._items = {};\n            this._elements = {};\n        }\n    }, {\n        key: 'activate',\n        value: function activate() {}\n    }, {\n        key: 'show',\n        value: function show(renderable) {\n            var _this51 = this;\n\n            var options = arguments.length <= 1 || arguments[1] === undefined ? {} : arguments[1];\n\n            var opt = renderable.moduleOptions,\n                str = D.isString(renderable);\n            var key = options.key;\n            if (!str && !(renderable instanceof D.Renderable)) {\n                this._error('The item is expected to be an instance of Renderable');\n            }\n\n            if (!key && opt && opt.key) key = opt.key;\n            if (!key) this._error('Region key is required');\n            var item = this._items[key];\n\n            if (this._isCurrent(key, item, renderable)) {\n                if (options.forceRender === false) return this.Promise.resolve(item);\n                return item.render(options);\n            }\n\n            return this.chain(str ? this.app._createModule(renderable) : renderable, [function (obj) {\n                return _this51.chain(obj._region && obj._region.close(), obj);\n            }, function () {\n                return _this51.chain(item && item._close(), function () {\n                    delete _this51._items[key];\n                    delete _this51._elements[key];\n                });\n            }], function (_ref8) {\n                var _ref9 = _slicedToArray(_ref8, 1);\n\n                var obj = _ref9[0];\n\n                var attr = obj.module ? obj.module.name + ':' + obj.name : obj.name,\n                    el = _this51._getElement(obj, key);\n\n                _this51._items[key] = obj;\n                el.setAttribute('data-current', attr);\n                obj._setRegion(_this51);\n                return obj._render(options, false);\n            });\n        }\n    }, {\n        key: '_createElement',\n        value: function _createElement() {\n            var el = root.document.createElement('div');\n            this._el.appendChild(el);\n            return el;\n        }\n    }, {\n        key: '_getElement',\n        value: function _getElement(item, key) {\n            if (!item) return this._el;\n            var k = key || item.renderOptions.key || item.moduleOptions.key;\n            if (!this._elements[k]) this._elements[k] = this._createElement(k, item);\n            return this._elements[k];\n        }\n    }, {\n        key: '_isCurrent',\n        value: function _isCurrent(key, item, renderable) {\n            if (!item) return false;\n            return item.name === renderable || renderable && renderable.id === item.id;\n        }\n    }, {\n        key: '_empty',\n        value: function _empty(item) {\n            if (!item) {\n                _get(Object.getPrototypeOf(MultiRegion.prototype), '_empty', this).call(this);\n                return;\n            }\n\n            var el = this._getElement(item);\n            el.parentNode.removeChild(el);\n        }\n    }, {\n        key: 'close',\n        value: function close() {\n            var _this52 = this;\n\n            return this.chain(mapObj(this._items, function (item) {\n                return item._close();\n            }), function () {\n                _this52._elements = {};\n                _this52._items = {};\n                delete _this52._current;\n            }, this);\n        }\n    }]);\n\n    return MultiRegion;\n}(D.Region);\nreturn Drizzle;\n}));\n","/*!\n * DrizzleJS v0.3.18\n * -------------------------------------\n * Copyright (c) 2016 Jaco Koo <jaco.koo@guyong.in>\n * Distributed under MIT license\n */\n\nconst Drizzle = {},\n    D = Drizzle,\n    slice = [].slice,\n    EMPTY = () => {},\n\n    map = (arr, fn) => {\n        const result = [];\n        if (!arr) return result;\n        if (arr.map) return arr.map(fn);\n\n        for (let i = 0; i < arr.length; i ++) {\n            result.push(fn(arr[i], i, arr));\n        }\n        return result;\n    },\n\n    mapObj = (obj, fn) => {\n        const result = [];\n        let key;\n        if (!obj) return result;\n\n        for (key in obj) {\n            if (D.hasOwnProperty.call(obj, key)) result.push(fn(obj[key], key, obj));\n        }\n\n        return result;\n    },\n\n    clone = (target) => {\n        if (D.isObject(target)) {\n            const result = {};\n            mapObj(target, (value, key) => result[key] = clone(value));\n            return result;\n        }\n\n        if (D.isArray(target)) {\n            return map(target, (value) => clone(value));\n        }\n\n        return target;\n    },\n\n    typeCache = {\n        View: {}, Region: {}, Module: {}, Model: {}, Store: {},\n\n        register (type, name, clazz) {\n            this[type][name] = clazz;\n        },\n\n        create (type, name, ...args) {\n            const Clazz = this[type][name] || D[type];\n            return new Clazz(...args);\n        }\n    };\n\nlet counter = 0, root = null;\n\nif (typeof window !== 'undefined') {\n    root = window;\n}\n\nmap(['Function', 'Array', 'String', 'Object'], (item) => {\n    D[`is${item}`] = function(obj) {\n        return D.toString.call(obj) === `[object ${item}]`;\n    };\n});\n\nmap(['Module', 'View', 'Region', 'Model', 'Store'], (item) => {\n    D['register' + item] = (name, clazz) => typeCache.register(item, name, clazz);\n    typeCache['create' + item] = (name, ...args) => typeCache.create(item, name, ...args);\n});\n\nObject.assign(D, {\n    uniqueId (prefix = '') {\n        return `${prefix}${++counter}`;\n    },\n\n    adapt (obj) {\n        Object.assign(D.Adapter, obj);\n    }\n});\n\nD.Adapter = {\n    Promise,\n\n    ajax (params) {\n        const xhr = new XMLHttpRequest();\n        let url = params.url;\n        if (params.type === 'GET' && params.data) url += '?' + (mapObj(params.data, (v, k) => `${k}=${v}`)).join('&');\n        xhr.open(params.type, url, true);\n        const promise = new Promise((resolve, reject) => {\n            xhr.onload = function() {\n                if (this.status >= 200 && this.status < 400) {\n                    resolve(JSON.parse(this.response));\n                    return;\n                }\n                reject(xhr);\n            };\n\n            xhr.onerror = () => {\n                reject(xhr);\n            };\n        });\n        xhr.send(params.data);\n        return promise;\n    },\n\n    ajaxResult (args) { return args[0]; },\n\n    getEventTarget (e) { return e.target; },\n\n    getFormData (el) { throw new Error('getFormData is not implemented', el); },\n\n    addEventListener (el, name, handler, useCapture) {\n        el.addEventListener(name, handler, useCapture);\n    },\n\n    removeEventListener (el, name, handler) {\n        el.removeEventListener(el, name, handler);\n    },\n\n    hasClass (el, clazz) { return el.classList.contains(clazz); },\n\n    addClass (el, clazz) { el.classList.add(clazz); },\n\n    removeClass (el, clazz) { el.classList.remove(clazz); }\n};\n\nD.Promise = class Promiser {\n    constructor (context) {\n        this.context = context;\n    }\n\n    create (fn) {\n        return new D.Adapter.Promise((resolve, reject) => {\n            fn.call(this.context, resolve, reject);\n        });\n    }\n\n    resolve (data) {\n        return D.Adapter.Promise.resolve(data);\n    }\n\n    reject (data) {\n        return D.Adapter.Promise.reject(data);\n    }\n\n    parallel (items, ...args) {\n        return this.create((resolve, reject) => {\n            const result = [], thenables = [], indexMap = {};\n            map(items, (item, i) => {\n                let value;\n                try {\n                    value = D.isFunction(item) ? item.apply(this.context, args) : item;\n                } catch (e) {\n                    reject(e);\n                    return;\n                }\n                if (value && value.then) {\n                    indexMap[thenables.length] = i;\n                    thenables.push(value);\n                } else {\n                    result[i] = value;\n                }\n            });\n\n            if (thenables.length === 0) return resolve(result);\n\n            D.Adapter.Promise.all(thenables).then((as) => {\n                mapObj(indexMap, (key, value) => result[value] = as[key]);\n                resolve(result);\n            }, (as) => {\n                reject(as);\n            });\n        });\n    }\n\n    chain (...args) {\n        let prev = null;\n        const doRing = (rings, ring, resolve, reject) => {\n            const nextRing = (data) => {\n                prev = data;\n                rings.length === 0 ? resolve(prev) : doRing(rings, rings.shift(), resolve, reject);\n            };\n\n            if (D.isArray(ring)) {\n                ring.length === 0 ? nextRing([]) :\n                    this.parallel(ring, ...(prev != null ? [prev] : [])).then(nextRing, reject);\n            } else {\n                let value;\n                try {\n                    value = D.isFunction(ring) ? ring.apply(this.context, prev != null ? [prev] : []) : ring;\n                } catch (e) {\n                    reject(e);\n                    return;\n                }\n\n                value && value.then ? value.then(nextRing, reject) : nextRing(value);\n            }\n        };\n\n        if (args.length === 0) return this.resolve();\n\n        return this.create((resolve, reject) => {\n            doRing(args, args.shift(), resolve, reject);\n        });\n    }\n};\n\nD.Event = {\n    on (name, fn, ctx) {\n        this._events || (this._events = {});\n        (this._events[name] || (this._events[name] = [])).push({ fn, ctx });\n    },\n\n    off (name, fn) {\n        if (!this._events || !name || !this._events[name]) return;\n        if (!fn) {\n            delete this._events[name];\n            return;\n        }\n\n        const result = [];\n        map(this._events[name], (item) => {if (item.fn !== fn) result.push(item);});\n\n        if (result.length === 0) {\n            delete this._events[name];\n            return;\n        }\n        this._events[name] = result;\n    },\n\n    trigger (name, ...args) {\n        if (!name || !this._events || !this._events[name]) return this;\n        map(this._events[name], (item) => item.fn.apply(item.ctx, args));\n    },\n\n    delegateEvent (to) {\n        const me = this, id = '--' + to.id, target = to;\n\n        Object.assign(target, {\n            _listeners: {},\n\n            listenTo (obj, name, fn, ctx) {\n                (target._listeners[name] || (target._listeners[name] = [])).push({ fn, obj });\n                obj.on(name, fn, ctx || target);\n            },\n\n            stopListening (obj, name, fn) {\n                mapObj(target._listeners, (value, key) => {\n                    const result = [];\n                    map(value, (item) => {\n                        let offIt = fn && (item.fn === fn && name === key && obj === item.obj);\n                        offIt = offIt || (!fn && name && (name === key && obj === item.obj));\n                        offIt = offIt || (!fn && !name && obj && obj === item.obj);\n                        offIt = offIt || (!fn && !name && !obj);\n                        if (offIt) {\n                            item.obj.off(key, item.fn);\n                            return;\n                        }\n                        result.push(item);\n                    });\n\n                    target._listeners[key] = result;\n                    if (result.length === 0) {\n                        delete target._listeners[key];\n                    }\n                });\n            },\n\n            on (name, fn, ctx) {\n                target.listenTo(me, name + id, fn, ctx);\n            },\n\n            off (name, fn) {\n                target.stopListening(me, (name && name + id), fn);\n            },\n\n            trigger (name, ...args) {\n                if (!name) return target;\n                args.unshift(name + id) && me.trigger(...args);\n            }\n        });\n        return this;\n    }\n};\n\nD.Request = {\n    get (model, options) {\n        return this._ajax('GET', model, model.params, options);\n    },\n\n    post (model, options) {\n        return this._ajax('POST', model, model.data, options);\n    },\n\n    put (model, options) {\n        return this._ajax('PUT', model, model.data, options);\n    },\n\n    del (model, options) {\n        return this._ajax('DELETE', model, model.data, options);\n    },\n\n    save (model, options) {\n        return model.data && model.data[model._idKey] ? this.put(model, options) : this.post(model, options);\n    },\n\n    _url (model) {\n        const parts = [],\n            prefix = model.module._option('urlPrefix', model) || '',\n            urlRoot = model.app._option('urlRoot', model) || '',\n            urlSuffix = model.app._option('urlSuffix', model) || '';\n        let base = model._url() || '';\n\n        urlRoot && parts.push(urlRoot);\n        prefix && parts.push(prefix);\n        parts.push(model.module.name);\n\n        while (base.indexOf('../') === 0) {\n            parts.pop();\n            base = base.slice(3);\n        }\n\n        base && parts.push(base);\n        model.data && model.data[model._idKey] && parts.push(model.data[model._idKey]);\n        urlSuffix && parts.push(parts.pop() + urlSuffix);\n\n        return parts.join('/');\n    },\n\n    _ajax (method, model, data, options) {\n        const params = Object.assign({ type: method }, options);\n\n        params.data = Object.assign({}, data, params.data);\n        params.url = this._url(model);\n\n        return model.Promise.create((resolve, reject) => {\n            D.Adapter.ajax(params).then((...args) => {\n                model.set(D.Adapter.ajaxResult(args), !params.slient);\n                resolve(args);\n            }, (...args) => reject(args));\n        });\n    }\n};\n\nD.ComponentManager = {\n    _handlers: {},\n    _componentCache: {},\n\n    setDefaultHandler (creator, destructor = EMPTY) {\n        this._defaultHandler = { creator, destructor };\n    },\n\n    register (name, creator, destructor) {\n        this._handlers[name] = { creator, destructor: destructor || EMPTY };\n    },\n\n    _create (renderable, options) {\n        const { name, id, selector, options: opt } = options;\n        if (!name) renderable._error('Component name can not be null');\n\n        const handler = this._handlers[name] || this._defaultHandler;\n        if (!handler) renderable._error('No handler for component:', name);\n\n        const dom = selector ? renderable.$$(selector) : renderable.$(id);\n        const uid = id ? id : D.uniqueId('comp');\n\n        return renderable.chain(handler.creator(renderable, dom, opt), (component) => {\n            const cid = renderable.id + uid,\n                cache = this._componentCache[cid],\n                obj = { id: cid, handler, index: D.uniqueId(cid), options: opt };\n\n            D.isArray(cache) ? cache.push(obj) : this._componentCache[cid] = cache ? [cache, obj] : obj;\n            return { id, component, index: obj.index };\n        });\n    },\n\n    _destroy (renderable, obj) {\n        const id = renderable.id + obj.id, cache = this._componentCache[id];\n        let current = cache;\n\n        if (D.isArray(cache)) {\n            this._componentCache[id] = [];\n            map(cache, (item) => {\n                item.index !== obj.index ? this._componentCache[id].push(item) : current = item;\n            });\n            this._componentCache[id].length === 0 && delete this._componentCache[id];\n        } else {\n            delete this._componentCache[id];\n        }\n\n        current.handler.destructor(renderable, obj.component, current.options);\n    }\n};\n\nD.Base = class Base {\n    constructor (name, options = {}, defaults) {\n        this.options = options;\n        this.id = D.uniqueId('D');\n        this.name = name;\n        this.Promise = new D.Promise(this);\n\n        Object.assign(this, defaults);\n        if (options.mixin) this._mixin(options.mixin);\n        this._loadedPromise = this._initialize();\n    }\n\n    _initialize () {\n    }\n\n    _option (key, ...args) {\n        const value = this.options[key];\n        return D.isFunction(value) ? value.apply(this, args) : value;\n    }\n\n    _error (message, ...rest) {\n        if (!D.isString(message)) throw message;\n        throw new Error(`[${this.module ? this.module.name + ':' : ''}${this.name}] ${message} ${rest.join(' ')}`);\n    }\n\n    _mixin (obj) {\n        mapObj(obj, (value, key) => {\n            const old = this[key];\n            if (!old) {\n                this[key] = value;\n                return;\n            }\n\n            if (D.isFunction(old)) {\n                this[key] = (...args) => {\n                    args.unshift(old);\n                    return value.apply(this, args);\n                };\n            }\n        });\n    }\n\n    chain (...args) {\n        return this.Promise.chain(...args);\n    }\n};\n\nD.Renderable = class Renderable extends D.Base {\n    constructor (name, app, mod, loader, options) {\n        super(name, options, {\n            app,\n            module: mod,\n            components: {},\n            _loader: loader,\n            _componentMap: {},\n            _events: {}\n        });\n        this._eventHandlers = this._option('handlers');\n        app.delegateEvent(this);\n    }\n\n    _initialize () {\n        this._templateEngine = this._option('templateEngine')\n            || this.module && this.module._templateEngine || this.app._templateEngine;\n        return this.chain(\n            [this._templateEngine._load(this), this._initializeEvents()],\n            ([template]) => this._template = template\n        );\n    }\n\n    render (options) {\n        return this._render(options == null ? this.renderOptions : options, true);\n    }\n\n    $ (id) {\n        return this.$$('#' + this._wrapDomId(id))[0];\n    }\n\n    $$ (selector) {\n        return this._element.querySelectorAll(selector);\n    }\n\n    _render (options = {}, update) {\n        if (!this._region) this._error('Region is null');\n\n        this.renderOptions = options;\n        return this.chain(\n            this._loadedPromise,\n            this._destroyComponents,\n            () => this.trigger('beforeRender'),\n            () => this._option('beforeRender'),\n            this._beforeRender,\n            this._serializeData,\n            (data) => this._renderTemplate(data, update),\n            this._renderComponents,\n            this._afterRender,\n            () => this._option('afterRender'),\n            () => this.trigger('afterRender'),\n            this\n        );\n    }\n\n    _setRegion (region) {\n        this._region = region;\n        this._bindEvents();\n    }\n\n    _close () {\n        if (!this._region) return this.Promise.resolve(this);\n\n        return this.chain(\n            () => this.trigger('beforeClose'),\n            () => this._option('beforeClose'),\n            this._beforeClose,\n            [this._unbindEvents, this._destroyComponents, () => this._region._empty(this)],\n            this._afterClose,\n            () => this._option('afterClose'),\n            () => this.trigger('afterClose'),\n            () => delete this._region,\n            this\n        );\n    }\n\n    get _element () {\n        return this._region ? this._region._getElement(this) : null;\n    }\n\n    _serializeData () {\n        return {\n            Global: this.app.global,\n            Self: this\n        };\n    }\n\n    _renderTemplate (data, update) {\n        this._templateEngine._execute(this, data, this._template, update);\n    }\n\n    _initializeEvents (events) {\n        mapObj(events || this._option('events'), (value, key) => {\n            const items = key.replace(/(^\\s+)|(\\s+$)/g, '').split(/\\s+/), result = { key };\n\n            if (items.length !== 2) this._error('Invalid event key');\n            result.eventType = items[0];\n            if (items[1].slice(-1) === '*') {\n                result.id = this._wrapDomId(items[1].slice(0, -1));\n                result.haveStar = true;\n                result.selector = `[id^=${result.id}]`;\n            } else {\n                result.id = this._wrapDomId(items[1]);\n                result.selector = `#${result.id}`;\n            }\n            result.handler = this._createEventHandler(value, result);\n            this._events[key] = result;\n        });\n    }\n\n    _createEventHandler (handlerName, { haveStar, id }) {\n        const { disabledClass } = this.app.options;\n        return (event) => {\n            if (!this._eventHandlers[handlerName]) this._error('No event handler for name:', handlerName);\n\n            const target = D.Adapter.getEventTarget(event), args = [event];\n            if (D.Adapter.hasClass(target, disabledClass)) return;\n            if (haveStar) args.unshift(target.getAttribute('id').slice(id.length));\n            this._eventHandlers[handlerName].apply(this, args);\n        };\n    }\n\n    _bindEvents () {\n        mapObj(this._events, (value) => {\n            this._region._delegateDomEvent(this, value.eventType, value.selector, value.handler);\n        });\n    }\n\n    _unbindEvents () {\n        this._region._undelegateDomEvents(this);\n    }\n\n    _renderComponents () {\n        return this.chain(map(this._option('components'), (item) => {\n            const i = D.isFunction(item) ? item.call(this) : item;\n            return i ? D.ComponentManager._create(this, i) : null;\n        }), (components) => map(components, (item) => {\n            if (!item) return;\n            const { id, component, index } = item, value = this.components[id];\n            D.isArray(value) ? value.push(component) : (this.components[id] = (value ? [value, component] : component));\n            this._componentMap[index] = item;\n        }));\n    }\n\n    _destroyComponents () {\n        this.components = {};\n        mapObj(this._componentMap, (value) => D.ComponentManager._destroy(this, value));\n        this._componentMap = {};\n    }\n\n    _wrapDomId (id) {\n        return this.id + id;\n    }\n\n    _beforeRender () {}\n    _afterRender () {}\n    _beforeClose () {}\n    _afterClose () {}\n};\n\nD.RenderableContainer = class RenderableContainer extends D.Renderable {\n\n    get items () {\n        return this._items || {};\n    }\n\n    get regions () {\n        return this._regions || {};\n    }\n\n    _initialize () {\n        const promise = super._initialize();\n\n        this._items = {};\n        return this.chain(promise, this._initializeItems);\n    }\n\n    _afterRender () {\n        return this.chain(this._initializeRegions, this._renderItems);\n    }\n\n    _afterClose () {\n        return this._closeRegions();\n    }\n\n    _initializeItems () {\n        this.chain(mapObj(this._option('items'), (options = {}, name) => {\n            let opt = D.isFunction(options) ? options.call(this) : options;\n            if (D.isString(opt)) opt = { region: opt };\n\n            return this.app[options.isModule ? '_createModule' : '_createView'](name, this).then((item) => {\n                const i = item;\n                i.moduleOptions = opt;\n                this._items[name] = item;\n                return item;\n            });\n        }));\n    }\n\n    _initializeRegions () {\n        this._regions = {};\n        return this.chain(this.closeRegions, map(this.$$('[data-region]'), (el) => {\n            const region = this._createRegion(el);\n            this._regions[region.name] = region;\n        }));\n    }\n\n    _renderItems () {\n        return this.chain(mapObj(this.items, (item) => {\n            const { region } = item.moduleOptions;\n            if (!region) return;\n            if (!this.regions[region]) this._error(`Region: ${region} is not defined`);\n            this.regions[region].show(item);\n        }), this);\n    }\n\n    _createRegion (el) {\n        const name = el.getAttribute('data-region');\n        return this.app._createRegion(el, name, this);\n    }\n\n    _closeRegions () {\n        const regions = this._regions;\n        if (!regions) return this;\n        delete this._regions;\n        return this.chain(mapObj(regions, (region) => region.close()), this);\n    }\n};\n\nD.ActionCreator = class ActionCreator extends D.Renderable {\n    _initializeEvents () {\n        super._initializeEvents();\n        super._initializeEvents(this._option('actions'));\n    }\n\n    _createEventHandler (name, obj) {\n        const isAction = !!(this._option('actions') || {})[obj.key];\n        return isAction ? this._createAction(name) : super._createEventHandler(name, obj);\n    }\n\n    _createAction (name) {\n        const { disabledClass } = this.app.options,\n            { [name]: dataForAction } = this._option('dataForActions') || {},\n            { [name]: actionCallback } = this._option('actionCallbacks') || {};\n\n        return (e) => {\n            const target = D.Adapter.getEventTarget(event);\n            if (D.Adapter.hasClass(target, disabledClass)) return;\n            D.Adapter.addClass(target, disabledClass);\n\n            const data = this._getActionPayload(target);\n            this.chain(\n                D.isFunction(dataForAction) ? dataForAction.call(this, data, e) : data,\n                (payload) => payload !== false ? this.module.dispatch(name, payload) : false,\n                (result) => result !== false ? actionCallback && actionCallback.call(this, result) : false\n            ).then(\n                () => D.Adapter.removeClass(target, disabledClass),\n                () => D.Adapter.removeClass(target, disabledClass)\n            );\n        };\n    }\n\n    _getActionPayload (target) {\n        const rootEl = this._element;\n        let current = target, targetName = false;\n        while (current && current !== rootEl && current.tagName !== 'FORM') current = current.parentNode;\n\n        current || (current = rootEl);\n        const data = current.tagName === 'FORM' ? D.Adapter.getFormData(current) : {};\n        map(current.querySelectorAll('[data-name][data-value]'), (item) => {\n            if (item === target) {\n                targetName = target.getAttribute('data-name');\n                data[targetName] = target.getAttribute('data-value');\n                return;\n            }\n\n            const name = item.getAttribute('data-name');\n            if (targetName && targetName === name) return;\n\n            const value = item.getAttribute('data-value'), v = data[name];\n            D.isArray(v) ? v.push(value) : (data[name] = v == null ? value : [v, value]);\n        });\n        return data;\n    }\n};\n\nD.View = class View extends D.ActionCreator {\n    _initialize () {\n        this.bindings = {};\n        return this.chain(super._initialize(), this._initializeDataBinding);\n    }\n\n    _initializeDataBinding () {\n        this._dataBinding = {};\n        mapObj(this._option('bindings'), (value, key) => {\n            const model = this.bindings[key] = this.module.store.models[key];\n            if (!model) this._error('No model:', key);\n\n            if (!value) return;\n            this._dataBinding[key] = { model, value, fn: () => {\n                if (value === true && this._region) this.render(this.renderOptions);\n                if (D.isString(value)) this._option(value);\n            } };\n        });\n    }\n\n    _bindData () {\n        mapObj(this._dataBinding, (value) => this.listenTo(value.model, 'changed', value.fn));\n    }\n\n    _unbindData () {\n        this.stopListening();\n        this.bindings = {};\n    }\n\n    _setRegion (...args) {\n        super._setRegion(...args);\n        this._bindData();\n    }\n\n    _close (...args) {\n        this.chain(super._close(...args), this._unbindData, this);\n    }\n\n    _serializeData () {\n        const data = super._serializeData();\n        mapObj(this.bindings, (value, key) => data[key] = value.get(true));\n        mapObj(this._option('dataForTemplate'), (value, key) => data[key] = value.call(this, data));\n        return data;\n    }\n\n};\n\nD.Module = class Module extends D.RenderableContainer {\n    _initialize () {\n        this.app._modules[`${this.name}--${this.id}`] = this;\n        this._initializeStore();\n        return super._initialize();\n    }\n\n    get store () {\n        return this._store;\n    }\n\n    dispatch (name, payload) {\n        return this._store.dispatch(name, payload);\n    }\n\n    _initializeStore () {\n        this._store = this.app._createStore(this, this._option('store'));\n    }\n\n    _afterClose () {\n        delete this.app._modules[`${this.name}--${this.id}`];\n        this._store._destory();\n        return super._afterClose();\n    }\n\n    _beforeRender () {\n        return this.chain(super._beforeRender(), () => this._store._loadEagerModels());\n    }\n\n    _afterRender () {\n        return this.chain(super._afterRender(), () => this._store._loadLazyModels());\n    }\n};\n\nconst CAPTURES = ['blur', 'focus', 'scroll', 'resize'];\n\nD.Region = class Region extends D.Base {\n    constructor (app, mod, el, name) {\n        super(name || 'Region', {}, {\n            app,\n            module: mod,\n            _el: el,\n            _delegated: {}\n        });\n\n        if (!this._el) this._error('The DOM element for region is required');\n        app.delegateEvent(this);\n    }\n\n    show (renderable, options = {}) {\n        if (this._isCurrent(renderable)) {\n            if (options.forceRender === false) return this.Promise.resolve(this._current);\n            return this._current._render(options, true);\n        }\n\n        return this.chain(\n            D.isString(renderable) ? this.app._createModule(renderable) : renderable,\n            (item) => {\n                if (!(item instanceof D.Renderable)) {\n                    this._error('The item is expected to be an instance of Renderable');\n                }\n                return item;\n            }, [\n                (item) => this.chain(item._region && item._region.close(), item),\n                () => this.close()\n            ],\n            ([item]) => {\n                this._current = item;\n                const attr = item.module ? `${item.module.name}:${item.name}` : item.name;\n                this._getElement().setAttribute('data-current', attr);\n                item._setRegion(this);\n                return item;\n            },\n            (item) => item._render(options, false)\n        );\n    }\n\n    close () {\n        return this.chain(\n            this._current && this._current._close(),\n            () => delete this._current,\n            this\n        );\n    }\n\n    $$ (selector) {\n        return this._getElement().querySelectorAll(selector);\n    }\n\n    _isCurrent (renderable) {\n        if (!this._current) return false;\n        if (this._current.name === renderable) return true;\n        if (renderable && renderable.id === this._current.id) return true;\n        return false;\n    }\n\n    _getElement () {\n        return this._el;\n    }\n\n    _empty () {\n        this._getElement().innerHTML = '';\n    }\n\n    _createDelegateListener (name) {\n        return (e) => {\n            if (!this._delegated[name]) return;\n            const { target } = e;\n            map(this._delegated[name].items, (item) => {\n                const els = this._getElement().querySelectorAll(item.selector);\n                let matched = false;\n                for (let i = 0; i < els.length; i ++) {\n                    const el = els[i];\n                    if (el === target || el.contains(target)) {\n                        matched = el;\n                        break;\n                    }\n                }\n                matched && item.fn.call(item.renderable, e);\n            });\n        };\n    }\n\n    _delegateDomEvent (renderable, name, selector, fn) {\n        let obj = this._delegated[name];\n        if (!obj) {\n            obj = this._delegated[name] = { listener: this._createDelegateListener(name), items: [] };\n            D.Adapter.addEventListener(this._getElement(), name, obj.listener, CAPTURES.indexOf(name) !== -1);\n        }\n        obj.items.push({ selector, fn, renderable });\n    }\n\n    _undelegateDomEvents (renderable) {\n        mapObj(this._delegated, (value, key) => {\n            const items = [], obj = value;\n            map(obj.items, (item) => {\n                if (item.renderable !== renderable) items.push(item);\n            });\n            obj.items = items;\n            if (items.length === 0) {\n                delete this._delegated[key];\n                D.Adapter.removeEventListener(this._getElement(), key, obj.listener);\n            }\n        });\n    }\n};\n\nD.TemplateEngine = class TemplateEngine extends D.Base {\n    constructor (options) {\n        super('Template Engine', options, { _templateCache: {} });\n    }\n\n    executeIdReplacement (el, renderable) {\n        const used = {};\n        map(el.querySelectorAll('[id]'), (item) => {\n            const id = item.getAttribute('id');\n            if (used[id]) this._error(`Dom ID: ${id} is already used`);\n            used[id] = true;\n            item.setAttribute('id', renderable._wrapDomId(id));\n        });\n\n        const attrs = this._option('attributesReferToId') || ['for', 'data-target', 'data-parent'];\n\n        map(attrs, (attr) => map(el.querySelectorAll(`[${attr}]`), (item) => {\n            const value = item.getAttribute(attr),\n                withHash = value.charAt(0) === '#',\n                wrapped = withHash ? `#${renderable._wrapDomId(value.slice(1))}` : renderable._wrapDomId(value);\n            item.setAttribute(attr, wrapped);\n        }));\n    }\n\n    _load (renderable) {\n        const id = renderable.id;\n        if (this._templateCache[id]) return this._templateCache[id];\n        return this._templateCache[id] = this._loadIt(renderable);\n    }\n\n    _loadIt (renderable) {\n        if (renderable instanceof Drizzle.Module) {\n            return renderable._loader.loadModuleResource(renderable, 'templates');\n        }\n\n        return () => renderable.module._template;\n    }\n\n    _execute (renderable, data, template /* , update */) {\n        const el = renderable._element;\n        el.innerHTML = template(data);\n        this.executeIdReplacement(el, renderable);\n    }\n\n};\n\nD.Store = class Store extends D.Base {\n    constructor (mod, options) {\n        super('Store', options, {\n            app: mod.app,\n            module: mod,\n            _models: {}\n        });\n\n        this.app.delegateEvent(this);\n\n        this._callbacks = this._option('callbacks');\n        mapObj(this._callbacks, (value, key) => {\n            if (key.slice(0, 4) !== 'app.') return;\n            this.listenTo(this.app, key, (payload) => value.call(this._callbackContext, payload));\n        });\n    }\n\n    get models () {return this._models;}\n\n    dispatch (name, payload) {\n        let callback, n = name, p = payload;\n        if (D.isObject(n)) {\n            p = n.payload;\n            n = n.name;\n        }\n\n        callback = this._callbacks[n];\n        if (!callback) this._error(`No action callback for name: ${name}`);\n        return this.chain(callback.call(this._callbackContext, p));\n    }\n\n    _initialize () {\n        this._initializeModels();\n        this._callbackContext = Object.assign({\n            models: this.models,\n            module: this.module,\n            app: this.app\n        }, D.Request);\n    }\n\n    _initializeModels () {\n        mapObj(this._option('models'), (value, key) => {\n            const v = (D.isFunction(value) ? value.call(this) : value) || {};\n            if (v.shared === true) {\n                this._models[key] = this.app.viewport.store.models[key];\n                return;\n            }\n            this._models[key] = this.app._createModel(this, v);\n        });\n    }\n\n    _loadEagerModels () {\n        return this.chain(mapObj(this._models, (model) => {\n            return model.options.autoLoad === true ? D.Request.get(model) : null;\n        }));\n    }\n\n    _loadLazyModels () {\n        return this.chain(mapObj(this._models, (model) => {\n            const { autoLoad } = model.options;\n            return autoLoad && autoLoad !== true ? D.Request.get(model) : null;\n        }));\n    }\n\n    _destory () {\n        this.stopListening();\n    }\n};\n\nD.Model = class Model extends D.Base {\n    constructor (store, options) {\n        super('Model', options, {\n            app: store.module.app,\n            module: store.module,\n            store\n        });\n\n        this._data = this._option('data') || {};\n        this._idKey = this._option('idKey') || this.app.options.idKey;\n        this._params = Object.assign({}, this._option('params'));\n        this.app.delegateEvent(this);\n    }\n\n    get fullUrl () { return D.Request._url(this); }\n\n    get params () { return this._params; }\n\n    get data () { return this._data; }\n\n    set (data, trigger) {\n        const d = this.options.parse ? this._option('parse', data) : data;\n        this._data = this.options.root ? d[this.options.root] : d;\n        if (trigger) this.changed();\n    }\n\n    get (cloneIt) {\n        return cloneIt ? clone(this._data) : this._data;\n    }\n\n    clear (trigger) {\n        this._data = D.isArray(this._data) ? [] : {};\n        if (trigger) this.changed();\n    }\n\n    changed () { this.trigger('changed'); }\n\n    _url () {\n        return this._option('url') || '';\n    }\n};\n\nD.Loader = class Loader extends D.Base {\n    static _analyse (name) {\n        if (!D.isString(name)) {\n            return { loader: null, name };\n        }\n\n        const args = name.split(':'),\n            loader = args.length > 1 ? args.shift() : null;\n\n        return { loader, name: args.shift(), args };\n    }\n\n    constructor (app, options) {\n        super('Loader', options, { app });\n    }\n\n    loadResource (path) {\n        const { scriptRoot, getResource, amd } = this.app.options,\n            fullPath = `${scriptRoot}/${path}`;\n\n        return this.Promise.create((resolve, reject) => {\n            if (amd) {\n                require([fullPath], resolve, reject);\n            } else if (getResource) {\n                resolve(getResource.call(this.app, fullPath));\n            } else {\n                resolve(require(`./${fullPath}`));\n            }\n        });\n    }\n\n    loadModuleResource (mod, path) {\n        return this.loadResource(`${mod.name}/${path}`);\n    }\n\n    loadModule (name) {\n        return this.loadResource(`${name}/${this.app.options.fileNames.module}`);\n    }\n\n    loadView (name, mod) {\n        return this.loadModuleResource(mod, `${this.app.options.fileNames.view}${name}`);\n    }\n\n    loadRouter (path) {\n        const name = this.app.options.fileNames.router;\n        return this.loadResource(path ? `${path}/${name}` : name);\n    }\n};\n\nD.Application = class Application extends D.Base {\n    constructor (options) {\n        super(options && options.name || 'Application', Object.assign({\n            scriptRoot: 'app',\n            urlRoot: '',\n            urlSuffix: '',\n            caseSensitiveHash: false,\n            defaultRegion: root && root.document.body,\n            disabledClass: 'disabled',\n            getResource: null,\n            idKey: 'id',\n            viewport: 'viewport',\n\n            fileNames: {\n                module: 'index',\n                view: 'view-',\n                router: 'router'\n            }\n        }, options), {\n            global: {},\n            _modules: {},\n            _loaders: {}\n        });\n    }\n\n    _initialize () {\n        this._templateEngine = this._option('templateEngine') || new D.TemplateEngine();\n        this.registerLoader('default', new D.Loader(this), true);\n        this._region = this._createRegion(this._option('defaultRegion'), 'Region');\n    }\n\n    registerLoader (name, loader, isDefault) {\n        this._loaders[name] = loader;\n        if (isDefault) this._defaultLoader = loader;\n        return this;\n    }\n\n    start (defaultHash) {\n        if (defaultHash) this._router = new D.Router(this);\n\n        return this.chain(\n            defaultHash ? this._router._mountRoutes(...this._option('routers')) : false,\n            this._region.show(this._option('viewport')),\n            (viewport) => this.viewport = viewport,\n            () => defaultHash && this._router._start(defaultHash),\n            this\n        );\n    }\n\n    stop () {\n        this.off();\n        this._region.close();\n        if (this._router) this._router._stop();\n    }\n\n    navigate (hash, trigger) {\n        if (!this._router) return;\n        this._router.navigate(hash, trigger);\n    }\n\n    dispatch (name, payload) {\n        const n = D.isObject(name) ? name.name : name,\n            p = D.isObject(name) ? name.payload : payload;\n        this.trigger(`app.${n}`, p);\n    }\n\n    show (region, moduleName, options) {\n        return this.viewport.regions[region].show(moduleName, options);\n    }\n\n    _getLoader (name, mod) {\n        return name && this._loaders[name] || mod && mod._loader || this._defaultLoader;\n    }\n\n    _createModule (name, parentModule) {\n        const { name: moduleName, loader: loaderName } = D.Loader._analyse(name),\n            loader = this._getLoader(loaderName, parent);\n\n        return this.chain(loader.loadModule(moduleName), (options = {}) => {\n            return typeCache.createModule(options.type, moduleName, this, parentModule, loader, options);\n        });\n    }\n\n    _createView (name, mod) {\n        const { name: viewName, loader: loaderName } = D.Loader._analyse(name),\n            loader = this._getLoader(loaderName, mod);\n\n        return this.chain(loader.loadView(viewName, mod), (options = {}) => {\n            return typeCache.createView(options.type, viewName, this, mod, loader, options);\n        });\n    }\n\n    _createRegion (el, name, mod) {\n        const { name: regionName, loader: type } = D.Loader._analyse(name);\n        return typeCache.createRegion(type, this, mod, el, regionName);\n    }\n\n    _createStore (mod, options = {}) {\n        return typeCache.createStore(options.type, mod, options);\n    }\n\n    _createModel (store, options = {}) {\n        return typeCache.createModel(options.type, store, options);\n    }\n};\n\nObject.assign(D.Application.prototype, D.Event);\n\nconst PUSH_STATE_SUPPORTED = root && root.history && ('pushState' in root.history);\nconst ROUTER_REGEXPS = [/:([\\w\\d]+)/g, '([^\\/]+)', /\\*([\\w\\d]+)/g, '(.*)'];\n\nclass Route {\n    constructor (app, router, path, fn) {\n        const pattern = path\n            .replace(ROUTER_REGEXPS[0], ROUTER_REGEXPS[1])\n            .replace(ROUTER_REGEXPS[2], ROUTER_REGEXPS[3]);\n\n        this.pattern = new RegExp(`^${pattern}$`, app.options.caseSensitiveHash ? 'g' : 'gi');\n\n        this.app = app;\n        this.router = router;\n        this.path = path;\n        this.fn = fn;\n    }\n\n    match (hash) {\n        this.pattern.lastIndex = 0;\n        return this.pattern.test(hash);\n    }\n\n    handle (hash) {\n        this.pattern.lastIndex = 0;\n        const args = this.pattern.exec(hash).slice(1),\n            handlers = this.router._getInterceptors(this.path);\n\n        handlers.push(this.fn);\n        return this.router.chain(...map(handlers, (fn, i) => {\n            return (prev) => fn.apply(this.router, (i > 0 ? [prev].concat(args) : args));\n        }));\n    }\n}\n\nD.Router = class Router extends D.Base {\n    constructor (app) {\n        super('Router', {}, {\n            app,\n            _routes: [],\n            _interceptors: {},\n            _started: false\n        });\n\n        this._EVENT_HANDLER = () => this._dispath(this._getHash());\n    }\n\n    navigate (path, trigger) {\n        if (!this._started) return;\n        if (PUSH_STATE_SUPPORTED) {\n            root.history.pushState({}, root.document.title, '#' + path);\n        } else {\n            root.location.replace('#' + path);\n        }\n\n        if (trigger !== false) this._dispath(path);\n    }\n\n    _start (defaultPath) {\n        if (this._started || !root) return;\n        D.Adapter.addEventListener(root, 'hashchange', this._EVENT_HANDLER, false);\n\n        const hash = this._getHash() || defaultPath;\n        this._started = true;\n        if (hash) this.navigate(hash);\n    }\n\n    _stop () {\n        if (!this._started) return;\n        D.Adapter.removeEventListener(root, 'hashchange', this._EVENT_HANDLER);\n        this._started = false;\n    }\n\n    _dispath (path) {\n        if (path === this._previousHash) return;\n        this._previousHash = path;\n\n        for (let i = 0; i < this._routes.length; i++) {\n            const route = this._routes[i];\n            if (route.match(path)) {\n                route.handle(path);\n                return;\n            }\n        }\n    }\n\n    _mountRoutes () {\n        const paths = slice.call(arguments);\n        return this.chain(\n            map(paths, (path) => this.app._getLoader(path).loadRouter(path)),\n            (options) => map(options, (option, i) => this._addRoute(paths[i], option))\n        );\n    }\n\n    _addRoute (path, options) {\n        const { routes, interceptors } = options;\n\n        mapObj(D.isFunction(routes) ? routes.apply(this) : routes, (value, key) => {\n            const p = `${path}/${key}`.replace(/^\\/|\\/$/g, '');\n            this._routes.unshift(new Route(this.app, this, p, options[value]));\n        });\n\n        mapObj(D.isFunction(interceptors) ? interceptors.apply(this) : interceptors, (value, key) => {\n            const p = `${path}/${key}`.replace(/^\\/|\\/$/g, '');\n            this._interceptors[p] = options[value];\n        });\n    }\n\n    _getInterceptors (path) {\n        const result = [], items = path.split('/');\n\n        items.pop();\n        while (items.length > 0) {\n            const key = items.join('/');\n            if (this._interceptors[key]) result.unshift(this._interceptors[key]);\n            items.pop();\n        }\n\n        if (this._interceptors['']) result.unshift(this._interceptors['']);\n        return result;\n    }\n\n    _getHash () {\n        return root.location.hash.slice(1);\n    }\n\n};\n\nconst PAGE_DEFAULT_OPTIONS = {\n    pageSize: 10,\n    pageKey: '_page',\n    pageSizeKey: 'pageSize',\n    recordCountKey: 'recordCount',\n    params: (item) => item\n};\n\nD.PageableModel = class PageableModel extends D.Model {\n    static setDefault (defaults) {\n        Object.assign(PAGE_DEFAULT_OPTIONS, defaults);\n    }\n\n    constructor (store, options) {\n        super(store, options);\n\n        this._data = this._option('data') || [];\n        this._p = {\n            page: this._option('page') || 1,\n            pageCount: 0,\n            pageSize: this._option('pageSize') || PAGE_DEFAULT_OPTIONS.pageSize,\n            pageKey: this._option('pageKey') || PAGE_DEFAULT_OPTIONS.pageKey,\n            pageSizeKey: this._option('pageSizeKey') || PAGE_DEFAULT_OPTIONS.pageSizeKey,\n            recordCountKey: this._option('recordCountKey') || PAGE_DEFAULT_OPTIONS.recordCountKey\n        };\n    }\n\n    set (data = {}, trigger) {\n        this._p.recordCount = data[this._p.recordCountKey] || 0;\n        this._p.pageCount = Math.ceil(this._p.recordCount / this._p.pageSize);\n        super.set(data, trigger);\n    }\n\n    get params () {\n        const { page, pageKey, pageSizeKey, pageSize } = this._p;\n        const params = super.params;\n        params[pageKey] = page;\n        params[pageSizeKey] = pageSize;\n        return PAGE_DEFAULT_OPTIONS.params(params);\n    }\n\n    clear (trigger) {\n        this._p.page = 1;\n        this._p.recordCount = 0;\n        this._p.pageCount = 0;\n        super.clear(trigger);\n    }\n\n    turnToPage (page) {\n        if (page <= this._p.pageCount && page >= 1) this._p.page = page;\n        return this;\n    }\n\n    firstPage () { return this.turnToPage(1); }\n\n    lastPage () { return this.turnToPage(this._p.pageCount); }\n\n    nextPage () { return this.turnToPage(this._p.page + 1); }\n\n    prevPage () { return this.turnToPage(this._p.page - 1); }\n\n    get pageInfo () {\n        const { page, pageSize, recordCount } = this._p;\n        let result;\n        if (this.data && this.data.length > 0) {\n            result = { page, start: (page - 1) * pageSize + 1, end: page * pageSize, total: recordCount };\n        } else {\n            result = { page, start: 0, end: 0, total: 0 };\n        }\n\n        if (result.end > result.total) result.end = result.total;\n        return result;\n    }\n};\n\nD.registerModel('pageable', D.PageableModel);\n\nD.MultiRegion = class MultiRegion extends D.Region {\n    _initialize () {\n        this._items = {};\n        this._elements = {};\n    }\n\n    activate () {}\n\n    show (renderable, options = {}) {\n        const opt = renderable.moduleOptions, str = D.isString(renderable);\n        let key = options.key;\n        if (!str && !(renderable instanceof D.Renderable)) {\n            this._error('The item is expected to be an instance of Renderable');\n        }\n\n        if (!key && opt && opt.key) key = opt.key;\n        if (!key) this._error('Region key is required');\n        const item = this._items[key];\n\n        if (this._isCurrent(key, item, renderable)) {\n            if (options.forceRender === false) return this.Promise.resolve(item);\n            return item.render(options);\n        }\n\n        return this.chain(\n            str ? this.app._createModule(renderable) : renderable,\n            [\n                (obj) => this.chain(obj._region && obj._region.close(), obj),\n                () => this.chain(item && item._close(), () => {\n                    delete this._items[key];\n                    delete this._elements[key];\n                })\n            ],\n            ([obj]) => {\n                const attr = obj.module ? `${obj.module.name}:${obj.name}` : obj.name,\n                    el = this._getElement(obj, key);\n\n                this._items[key] = obj;\n                el.setAttribute('data-current', attr);\n                obj._setRegion(this);\n                return obj._render(options, false);\n            }\n        );\n    }\n\n    _createElement () {\n        const el = root.document.createElement('div');\n        this._el.appendChild(el);\n        return el;\n    }\n\n    _getElement (item, key) {\n        if (!item) return this._el;\n        const k = key || item.renderOptions.key || item.moduleOptions.key;\n        if (!this._elements[k]) this._elements[k] = this._createElement(k, item);\n        return this._elements[k];\n    }\n\n    _isCurrent (key, item, renderable) {\n        if (!item) return false;\n        return item.name === renderable || (renderable && renderable.id === item.id);\n    }\n\n    _empty (item) {\n        if (!item) {\n            super._empty();\n            return;\n        }\n\n        const el = this._getElement(item);\n        el.parentNode.removeChild(el);\n    }\n\n    close () {\n        return this.chain(\n            mapObj(this._items, (item) => item._close()),\n            () => {\n                this._elements = {};\n                this._items = {};\n                delete this._current;\n            },\n            this\n        );\n    }\n};\n"],"sourceRoot":"/source/"}