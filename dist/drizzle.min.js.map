{"version":3,"names":[],"mappings":"","sources":["drizzle.min.js"],"sourcesContent":["/*!\n * DrizzleJS v0.3.3\n * -------------------------------------\n * Copyright (c) 2015 Jaco Koo <jaco.koo@guyong.in>\n * Distributed under MIT license\n */\n\"use strict\";!function(t,e){var i;\"function\"==typeof define&&define.amd?define([\"handlebars.runtime\"],function(i){return e(t,i[\"default\"])}):module&&module.exports?(i=require(\"handlebars/runtime\")[\"default\"],module.exports=e(t,i)):t.Drizzle=e(t,t.Handlebars)}(window,function(t,e){var i,n={},s=n,o=0,r=n.toString,a=n.hasOwnProperty,u=[].slice,h=function(){},l=function(t,e,i){var n,s=[];if(!t)return s;for(n in t)a.call(t,n)&&s.push(e.call(i,t[n],n));return s},c=function(t,e,i){var n,s=[];if(!t)return s;if(t.map)return t.map(e,i);for(n=0;n<t.length;n++)s.push(e.call(i,t[n],n));return s},d=function(){return u.call(arguments).join(\"/\").replace(/\\/{2,}/g,\"/\").replace(/^\\/|\\/$/g,\"\")};return c([\"Function\",\"Array\",\"String\",\"Object\"],function(t){n[\"is\"+t]=function(e){return r.call(e)===\"[object \"+t+\"]\"}}),n.uniqueId=function(t){return(t||\"\")+ ++o},n.assign=function(t){return t?(c(u.call(arguments,1),function(e){e&&l(e,function(e,i){t[i]=e})}),t):t},n.extend=function(t,e,i){function n(){this.constructor=t}return l(e,function(i,n){a.call(e,n)&&(t[n]=i)}),n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,l(i,function(e,i){t.prototype[i]=e}),t},i=s.Adapter={Promise:t.Promise,ajax:null,hasClass:function(t,e){return t.classList.contains(e)},addClass:function(t,e){return t.classList.add(e)},removeClass:function(t,e){return t.classList.remove(e)},componentHandler:function(t){return{creator:function(){throw new Error(\"Component [\"+t+\"] is not defined\")}}},delegateDomEvent:h,undelegateDomEvents:h,getFormData:h},s.Promise=function(t){this.context=t},s.assign(s.Promise.prototype,{create:function(t){var e=this.context;return new i.Promise(function(i,n){t.call(e,i,n)})},resolve:function(t){return i.Promise.resolve(t)},reject:function(t){return i.Promise.reject(t)},when:function(t){var e,n=u.call(arguments,1);return e=s.isFunction(t)?t.apply(this.context,n):t,i.Promise.resolve(e)},chain:function(){var t,e=this,n=null,o=function(t,r,a,u,h){var l;l=s.isArray(u)?i.Promise.all(c(u,function(t){return e.when.apply(e,h>0?[t,n]:[t])})):e.when.apply(e,h>0?[u,n]:[u]),l.then(function(e){n=e,0===t.length?r(n):o(t,r,a,t.shift(),h+1)},function(t){a(t)})};return t=u.call(arguments),0===t.length?this.resolve():this.create(function(e,i){o(t,e,i,t.shift(),0)})}}),s.Event={on:function(t,e,i){return this.events||(this.events={}),this.events[t]||(this.events[t]=[]),this.events[t].push({fn:e,ctx:i}),this},off:function(t,e,i){return this.events&&t&&this.events[t]?e?(c(this.events[t],function(n){var s=[];(n.fn!==e||i&&i!==n.ctx)&&s.push(n),this.events[t]=s},this),this.events[t].length||delete this.events[t],this):delete this.events[t]&&this:this},trigger:function(t){var e;return t&&this.events&&this.events[t]?(e=u.call(arguments,1),c(this.events[t],function(t){t.fn.apply(t.ctx,e)}),this):this},delegateEvent:function(t){var e=this,i=\"--\"+t.id;return n.assign(t,{on:function(n,s){return t.listenTo(e,n+i,s),this},off:function(n,s){return t.stopListening(e,n&&n+i,s),this},trigger:function(t){var n;return t?(n=u.call(arguments),n.unshift(t+i),e.trigger.apply(e,n),this):this},listenTo:function(t,e,i){return this.listeners||(this.listeners={}),this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push({obj:t,fn:i}),t.on(e,i,this),this},stopListening:function(t,e,i){return this.listeners?t?(l(this.listeners,function(n,s){e&&e!==s||(this.listeners[s]=[],c(n,function(e){e.obj!==t||i&&i!==e.fn?this.listeners[s].push(e):e.obj.off(s,e.fn,this)},this))},this),this):(l(this.listeners,function(t,e){c(t,function(t){t.obj.off(e,t.fn,this)},this)},this),this.listeners={},this):this}}),this}},s.Request={url:function(t){var e=t.app.options,i=t.url(),n=[e.urlRoot];for(t.module.options.urlPrefix&&n.push(t.module.options.urlPrefix),n.push(t.module.name);0===i.indexOf(\"../\");)n.pop(),i=i.slice(3);return n.push(i),t.data.id&&n.push(t.data.id),e.urlSuffix&&n.push(n.pop()+e.urlSuffix),d.apply(null,n)},get:function(t,e){return this.ajax({type:\"GET\"},t,t.getParams(),e)},post:function(t,e){return this.ajax({type:\"POST\"},t,t.data,e)},put:function(t,e){return this.ajax({type:\"PUT\"},t,t.data,e)},del:function(t,e){return this.ajax({type:\"DELETE\"},t,t.data,e)},save:function(t,e){return t.data.id?this.put(t,e):this.post(t,e)},ajax:function(t,e,n,o){return o||(o={}),s.assign(t,o),s.assign(n,o.data),t.url=this.url(e),t.data=n,new i.Promise(function(n,s){i.ajax(t).then(function(){var t=u.call(arguments),i=t[0];e.set(i).changed(),n(t)},function(){s(u.call(arguments))})})}},s.Factory={types:{},register:function(t,e){this.types[t]=e},create:function(t){var e,i,n=u.call(arguments,1),s=function(){};return t=this.types[t]||this,s.prototype=t.prototype,i=new s,e=t.apply(i,n),Object(e)===e?e:i}},s.Base=function(t,e){this.options=e||{},this.id=s.uniqueId(t),this.Promise=new s.Promise(this),this.initialize()},s.assign(s.Base.prototype,{initialize:h,option:function(t){var e=this.options[t];return s.isFunction(e)?e.call(this):e},error:function(t){var e;if(!s.isString(t))throw t;throw e=this.module?[\"[\",this.module.name,\":\"]:[\"[\"],e=e.concat([this.name,\"] \",t]),new Error(e.join(\"\"))},mixin:function(t){t&&l(t,function(t,e){var i,n=this;s.isFunction(t)?(i=this[e],this[e]=function(){var e=u.call(arguments);return i&&e.unshift(i),t.apply(n,e)}):this[e]||(this[e]=t)},this)}}),function(){var i={scriptRoot:\"app\",urlRoot:\"\",urlSuffix:\"\",caseSensitiveHash:!1,defaultRegion:t.document.body,disabledClass:\"disabled\",attributesReferToId:[\"for\",\"data-target\",\"data-parent\"],fileNames:{module:\"index\",templates:\"templates\",view:\"view-\",template:\"template-\",router:\"router\"},pagination:{pageSize:10,pageKey:\"_page\",pageSizeKey:\"_pageSize\",recordCountKey:\"recordCount\"}};s.Application=function(t){var e=s.assign({},i,t);this.modules={},this.global={},this.loaders={},this.regions=[],s.Application.__super__.constructor.call(this,\"A\",e)},s.extend(s.Application,s.Base,{initialize:function(){this.registerLoader(new s.SimpleLoader(this)),this.registerLoader(new s.Loader(this),!0),this.setRegion(new s.Region(this,null,this.options.defaultRegion)),l(s.Helpers,function(t,e){this.registerHelper(e,t)},this)},registerLoader:function(t,e){this.loaders[t.name]=t,e&&(this.defaultLoader=t)},registerHelper:function(t,i){var n=this;e.registerHelper(t,function(){var t=u.call(arguments);return i.apply(this,[n,e].concat(t))})},getLoader:function(t){var e=s.Loader.analyse(t).loader;return e&&this.loader[e]?this.loaders[e]:this.defaultLoader},setRegion:function(t){this.region=t,this.regions.unshift(t)},load:function(){return this.Promise.chain(c(arguments,function(t){return this.getLoader(t).loadModule(t)}))},show:function(t,e){return this.region.show(t,e)},destory:function(){return this.off(),this.Promise.chain(c(this.regions,function(t){return t.close()}))},startRoute:function(t){var e=u.call(arguments,1),i=this.router;return this.router||(i=this.router=new s.Router(this)),this.Promise.chain(i.mountRoutes.apply(i,e),function(){return i.start(t)})},navigate:function(t,e){return this.router.navigate(t,e)},dispatch:function(t,e){e||(e=t.payload,t=t.name),this.trigger(\"app.\"+t,e)},message:{success:function(t,e){alert(e||t)},info:function(t,e){alert(e||t)},error:function(t,e){alert(e||t)}}}),s.assign(s.Application.prototype,s.Event)}(),s.Model=function(t,e,i){this.app=t,this.module=e,i||(i={}),this.params=s.assign({},i.params),s.Model.__super__.constructor.call(this,\"D\",i),this.app.delegateEvent(this)},s.extend(s.Model,s.Base,{initialize:function(){this.data=this.options.data||{}},url:function(){return this.option(\"url\")||\"\"},getFullUrl:function(){return s.Request.url(this)},getParams:function(){return s.assign({},this.params)},set:function(t,e){var i=this.options.parse,n=s.isFunction(i)?i.call(this,t):t;return this.data=this.options.root?n[this.options.root]:n,e&&this.changed(),this},changed:function(){this.trigger(\"change\")},clear:function(t){return this.data=s.isArray(this.data)?[]:{},t&&this.changed(),this}}),s.assign(s.Model,s.Factory),s.Region=function(t,e,i,n){this.app=t,this.module=e,this.el=i,this.name=n||\"default\",i||this.error(\"The DOM element for region is not found\"),s.Region.__super__.constructor.call(this,\"R\")},s.extend(s.Region,s.Base,{isCurrent:function(t){return this.current?s.isObject(t)&&t.id===this.current.id?!0:s.isString(t)&&s.Loader.analyse(t).name===this.current.name?!0:!1:!1},show:function(t,e){return e||(e={}),this.isCurrent(t)?e.forceRender===!1?this.Promise.resolve(this.current):this.current.render():(s.isString(t)&&(t=this.app.getLoader(t).loadModule(t)),this.Promise.chain(t,function(t){return t.render||t.setRegion||this.error(\"Can not render \"+t),t},[function(t){return this.Promise.chain(t.region&&t.region.close(),t)},function(){return this.close()}],function(t){var e=t[0],i=e.module?e.module.name+\":\"+e.name:e.name;return this.current=e,this.getElement().setAttribute(\"data-current\",i),e.setRegion(this)},function(t){return t.render(e)}))},close:function(){return this.Promise.chain(this.current&&this.current.close(),delete this.current,this)},getElement:function(){return this.el},$$:function(t){return this.el.querySelectorAll(t)},empty:function(){this.el.innerHTML=\"\"},delegateDomEvent:function(t,e,n,s){var o=e+\".events\"+this.id+t.id;i.delegateDomEvent(this.el,o,n,s)},undelegateDomEvents:function(t){i.undelegateDomEvents(this.el,\".events\"+this.id+t.id)}}),s.assign(s.Region,s.Factory),s.View=function(t,e,i,n){this.app=e.app,this.name=t,this.module=e,this.loader=i,this.components={},this.eventKeys={},s.View.__super__.constructor.call(this,\"V\",n||{}),this.eventHandlers=this.option(\"handlers\")||{},this.app.delegateEvent(this)},s.extend(s.View,s.Base,{initialize:function(){this.options.mixin&&this.mixin(this.options.mixin),this.loadedPromise=this.loadTemplate()},loadTemplate:function(){var t;return this.module.separatedTemplate===!0?(t=this.option(\"template\")||this.name,this.Promise.chain(this.app.getLoader(t).loadSeparatedTemplate(this,t),function(t){this.template=t})):this.Promise.chain(this.module.loadedPromise,function(){this.template=this.module.template})},bindData:function(){return this.Promise.chain(this.module.loadedPromise,function(){var t=this.option(\"bind\")||{},e=this;this.data={},l(t,function(t,i){var n=e.data[i]=e.module.store[i];n||e.error(\"No model:\"+i),t===!0&&e.listenTo(n,\"change\",function(){e.region&&e.render(e.renderOptions)})})})},unbindData:function(){this.stopListening(),delete this.data},getElement:function(){return this.region?this.region.getElement(this):null},wrapDomId:function(t){return this.id+t},$:function(t){return this.$$(\"#\"+this.wrapDomId(t))[0]},$$:function(t){return this.getElement().querySelectorAll(t)},setRegion:function(t){return this.region=t,this.virtualEl=this.getElement().cloneNode(),this.bindEvents(),this.bindActions(),this.bindData(),this},close:function(){return this.region?this.Promise.chain(function(){return this.option(\"beforeClose\")},this.beforeClose,[this.unbindEvents,this.unbindData,this.destroyComponents,function(){return this.region.empty(this)}],function(){return this.option(\"afterClose\")},this.afterClose,function(){delete this.region},this):this.Promise.resolve(this)},analyseEventKey:function(t){var e,i,n,s;return this.eventKeys[t]?this.eventKeys[t]:(e=t.replace(/(^\\s+)|(\\s+$)/g,\"\").split(/\\s+/),s=e[1],s||this.error(\"Id is required\"),i=\"*\"===s.slice(-1),n=this.wrapDomId(i?s.slice(0,-1):s),this.eventKeys[t]=[e[0],s,i,n,i?\"[id^=\"+n+\"]\":\"#\"+n],this.eventKeys[t])},bindEvents:function(){l(this.option(\"events\"),function(t,e){var n,s,o,r,a=this;a.eventHandlers[t]||a.error(\"No event handler:\"+t),o=a.analyseEventKey(e),n=o[2],s=o[3],r=function(e){var o=e.target||e.srcElement,r=[e];i.hasClass(o,a.app.options.disabledClass)||(n&&r.unshift(o.getAttribute(\"id\").slice(s.length)),a.eventHandlers[t].apply(a,r))},a.delegateEvent(e,r)},this)},bindActions:function(){l(this.option(\"actions\"),function(t,e){s.isString(t)&&this.delegateEvent(e,this.createActionEventHandler(t))},this)},createActionEventHandler:function(t){var e=this.getElement(),n=this,o=(this.option(\"dataForAction\")||{})[t],r=this.app.options.disabledClass;return function(a){var u,h,l;if(h=u=a.target||a.srcElement,!i.hasClass(u,r)){for(i.addClass(u,r);h&&h!==e&&\"FORM\"!==h.tagName;)h=h.parentNode;l=n.getActionData(h,u),s.isFunction(o)&&(l=o.call(n,l,a)),n.Promise.chain(l,function(e){return e!==!1?n.module.dispatch(t,e):void 0},function(){i.removeClass(u,r)})}}},getActionData:function(t,e){var n,o,r,a,u=!1;return t||(t=this.getElement()),n=\"FORM\"===t.tagName?i.getFormData(t):{},c(t.querySelectorAll(\"[data-name][data-value]\"),function(t){u=u||t===e,o=t.getAttribute(\"data-name\"),r=t.getAttribute(\"data-value\"),a=n[o],a?(s.isArray(a)||(a=n[o]=[n[o]]),a.push(r)):n[o]=r}),u&&(o=e.getAttribute(\"data-name\"),n[o]=e.getAttribute(\"data-value\")),n},delegateEvent:function(t,e){var i=this.analyseEventKey(t),n=i[0],s=i[4];this.region.delegateDomEvent(this,n,s,e)},unbindEvents:function(){this.region.undelegateDomEvents(this)},render:function(t){return this.region||this.error(\"Region is null\"),this.renderOptions=t||{},this.Promise.chain(this.loadedPromise,this.destroyComponents,function(){return this.option(\"beforeRender\")},this.beforeRender,this.serializeData,this.renderTemplate,this.renderComponent,this.afterRender,function(){return this.option(\"afterRender\")},this)},serializeData:function(){var t={};return l(this.data,function(e,i){t[i]=e.data}),l(this.option(\"dataForTemplate\"),function(e,i){t[i]=e.call(this,t)},this),t.Global=this.app.global,t.View=this,t},renderTemplate:function(t){var e,i,n={},s=this;this.virtualEl.innerHTML=this.template(t),c(this.virtualEl.querySelectorAll(\"[id]\"),function(t){e=t.getAttribute(\"id\"),n[e]&&s.error(e+\" already used\"),n[e]=!0,t.setAttribute(\"id\",s.wrapDomId(e))}),c(this.app.options.attributesReferToId,function(t){c(s.virtualEl.querySelectorAll(\"[\"+t+\"]\"),function(n){e=n.getAttribute(t),i=\"#\"===e.charAt(0),n.setAttribute(t,i?\"#\"+s.wrapDomId(e.slice(1)):s.wrapDomId(e))})}),this.updateDom()},updateDom:function(){this.getElement().innerHTML=this.virtualEl.innerHTML},renderComponent:function(){return this.Promise.chain(c(this.option(\"components\"),function(t){return s.isFunction(t)&&(t=t.call(this)),t?s.View.ComponentManager.create(this,t):null},this),function(t){c(t,function(t){t&&(this.components[t.id]=t.component)},this)})},destroyComponents:function(){l(this.components,function(t,e){s.View.ComponentManager.destroy(e,this,t)}),this.components={}},beforeClose:h,beforeRender:h,afterRender:h,afterClose:h}),s.assign(s.View,s.Factory),s.View.ComponentManager={handlers:{},componentCache:{},createDefaultHandler:i.componentHandler(),register:function(t,e,i){this.handlers[t]={creator:e,destructor:i||h}},create:function(t,e){var i,n,o,r=this;return e&&e.name||this.error(\"Component name can not be null\"),i=this.handlers[e.name]||this.createDefaultHandler(e.name),n=e.selector?t.$$(e.selector):t.$(e.id),o=e.id||s.uniqueId(\"comp\"),t.Promise.chain(i.creator(t,n,e.options),function(n){return r.componentCache[t.id+o]={handler:i,id:o,options:e.options},{id:o,component:n}})},destroy:function(t,e,i){var n=this.componentCache[e.id+t];delete this.componentCache[e.id+t],n.handler.destructor&&n.handler.destructor(e,i,n.options)}},s.Module=function(t,e,i,n){this.name=t,this.app=e,this.loader=i,n||(n={}),this.separatedTemplate=n.separatedTemplate===!0,s.Module.__super__.constructor.call(this,\"M\",n),this.app.modules[this.id]=this,this.actions=this.option(\"actions\")||{},this.app.delegateEvent(this)},s.extend(s.Module,s.Base,{initialize:function(){this.options.mixin&&this.mixin(this.options.mixin),this.loadedPromise=this.Promise.chain([this.loadTemplate(),this.loadItems()]),this.initLayout(),this.initStore(),this.actionContext=s.assign({store:this.store},s.Request)},initLayout:function(){var t=this.option(\"layout\");this.layout=new s.Module.Layout(\"layout\",this,this.loader,t)},initStore:function(){this.store={},this.autoLoadAfterRender=[],this.autoLoadBeforeRender=[],l(this.option(\"store\")||{},function(t,e){s.isFunction(t)&&(t=t.call(this)||{}),t.autoLoad&&(t.autoLoad===!0?this.autoLoadBeforeRender:this.autoLoadAfterRender).push(e),this.store[e]=s.Model.create(t.type,this.app,this,t)},this)},loadTemplate:function(){return this.separatedTemplate?void 0:this.Promise.chain(this.loader.loadTemplate(this),function(t){this.template=t})},loadItems:function(){var t=this;return this.items={},this.inRegionItems={},this.Promise.chain(l(this.option(\"items\")||{},function(e,i){var n;s.isFunction(e)&&(e=e.call(t)),s.isString(e)&&(e={region:e}),n=e.isModule?\"loadModule\":\"loadView\",t.app.getLoader(i)[n](i,t,e).then(function(i){i.moduleOptions=e,t.items[i.name]=i,e.region&&(t.inRegionItems[e.region]=i)})}))},setRegion:function(t){return this.region=t,this.Promise.chain(function(){return this.layout.setRegion(t)},function(){return this.layout.render()},this.bindGlobalAction,this.initRegions,this)},bindGlobalAction:function(){var t=this.actionContext;l(this.actions,function(e,i){\"app.\"===i.slice(0,4)&&this.listenTo(this.app,i,function(i){e.call(t,i)})})},close:function(){return this.Promise.chain(function(){return this.option(\"beforeClose\")},this.beforeClose,function(){return this.layout.close()},this.closeRegions,this.afterClose,function(){return this.option(\"afterClose\")},function(){return this.stopListening(),delete this.app.modules[this.id],delete this.region,this})},render:function(t){return this.region||this.error(\"region is null\"),this.renderOptions=t||{},this.Promise.chain(this.loadedPromise,function(){return this.option(\"beforeRender\")},this.beforeRender,this.fetchDataBeforeRender,this.renderItems,this.afterRender,function(){return this.option(\"afterRender\")},this.fetchDataAfterRender,this)},closeRegions:function(){var t=this.regions;return delete this.regions,this.Promise.chain(l(t,function(t){return t.close()}))},initRegions:function(){var t,e;this.regions&&this.closeRegions(),this.regions={},c(this.layout.$$(\"[data-region]\"),function(i){t=i.getAttribute(\"data-region\"),e=i.getAttribute(\"region-type\"),this.regions[t]=s.Region.create(e,this.app,this,i,t)},this)},renderItems:function(){return this.Promise.chain(l(this.inRegionItems,function(t,e){this.regions[e]||this.error(\"Region:\"+e+\" is not defined\"),this.regions[e].show(t)},this))},fetchDataBeforeRender:function(){return this.Promise.chain(c(this.autoLoadBeforeRender,function(t){return s.Request.get(this.store[t])},this))},fetchDataAfterRender:function(){return this.Promise.chain(c(this.autoLoadAfterRender,function(t){return s.Request.get(this.store[t])},this))},dispatch:function(t,e){var i;return e||(e=t.payload,t=t.name),i=this.actions[t],s.isFunction(i)||this.error(\"No action handler for \"+t),this.Promise.chain(function(){i.call(this.actionContext,e)})},beforeClose:h,beforeRender:h,afterRender:h,afterClose:h}),s.Module.Layout=function(){s.Module.Layout.__super__.constructor.apply(this,arguments)},s.extend(s.Module.Layout,s.View,{initialize:function(){this.isLayout=!0,this.loadedPromise=this.loadTemplate()},bindActions:h,bindData:h}),s.Loader=function(t){this.app=t,this.name=\"loader\",this.fileNames=t.options.fileNames,s.Loader.__super__.constructor.call(this,\"L\")},s.Loader.analyse=function(t){var e,i=null;return s.isString(t)?(e=t.split(\":\"),e.length<2?t=e.shift():(i=e.shift(),t=e.shift()),{loader:i,name:t,args:e}):{loader:null,name:t}},s.extend(s.Loader,s.Base,{loadResource:function(t){return t=d(this.app.options.scriptRoot,t),this.Promise.create(function(e,i){this.app.options.amd?require([t],function(t){e(t)},function(t){i(t)}):e(require(\"./\"+t))})},loadModuleResource:function(t,e){return this.loadResource(d(t.name,e))},loadModule:function(t,e){var i=s.Loader.analyse(t).name;return t=d(i,this.fileNames.module),this.Promise.chain(this.loadResource(d(t)),function(t){var n=new s.Module(i,this.app,this,t);return e&&(n.module=e),n})},loadView:function(t,e){var i=s.Loader.analyse(t).name,n=this.fileNames.view+i;return this.Promise.chain(this.loadModuleResource(e,n),function(t){return t||(t={}),s.View.create(t.type,i,e,this,t)})},loadTemplate:function(t){return this.loadModuleResource(t,this.fileNames.templates)},loadSeparatedTemplate:function(t,e){return this.loadModuleResource(module,this.fileNames.template+e)},loadRouter:function(t){var e=s.Loader.analyse(t).name;return this.loadResource(d(e,this.fileNames.router))}}),s.SimpleLoader=function(){s.SimpleLoader.__super__.constructor.apply(this,arguments),this.name=\"simple\"},s.extend(s.SimpleLoader,s.Loader,{loadModule:function(t,e){var i=s.Loader.analyse(t).name,n=new s.Module(i,this.app,this,{separatedTemplate:!0});return e&&(n.module=e),this.Promise.resolve(n)},loadView:function(t,e){return t=s.Loader.analyse(t).name,this.Promise.resolve(new s.View(t,e,this,{}))}}),function(){var e,n=t.history&&\"pushState\"in t.history,o=[/:([\\w\\d]+)/g,\"([^/]+)\",/\\*([\\w\\d]+)/g,\"(.*)\"];e=function(t,e,i,n){var s=i.replace(o[0],o[1]).replace(o[2],o[3]);this.pattern=new RegExp(\"^\"+s+\"$\",t.options.caseSensitiveHash?\"g\":\"gi\"),this.app=t,this.router=e,this.path=i,this.fn=n},s.assign(e.prototype,{match:function(t){return this.pattern.lastIndex=0,this.pattern.test(t)},handle:function(t){var e,i,n=this.router.Promise,s=this;return this.pattern.lastIndex=0,e=this.pattern.exec(t).slice(1),i=this.router.getInterceptors(this.path),i.push(this.fn),n.chain.apply(n,c(i,function(t,i){return function(n){return t.apply(s.router,i>0?[n].concat(e):e)}},this))}}),s.Router=function(t){this.app=t,this.routes=[],this.routeMap={},this.interceptors={},this.started=!1,s.Router.__super__.constructor.call(this,\"R\")},s.extend(s.Router,s.Base,{initialize:function(){this.addRoute(\"/\",this.app.options.defaultRouter||{})},getHash:function(){return t.location.hash.slice(1)},start:function(e){var s,o,r=this;this.started||(this.started=!0,s=n?\"popstate.dr\":\"hashchange.dr\",i.delegateDomEvent(t,s,null,function(){r.dispatch(r.getHash())}),o=r.getHash()||e,o&&this.navigate(o))},stop:function(){i.undelegateDomEvents(t,\".dr\")},dispatch:function(t){var e,i;if(t!==this.previousHash)for(this.previousHash=t,e=0;e<this.routes.length;e++)if(i=this.routes[e],i.match(t))return void i.handle(t)},navigate:function(e,i){i=i!==!1,n?t.history.pushState({},t.document.title,\"#\"+e):t.location.replace(\"#\"+e),i&&this.dispatch(e)},mountRoutes:function(){var t=u.call(arguments),e=this;return this.Promise.chain(c(t,function(t){return e.app.getLoader(t).loadRouter(t)}),function(i){c(i,function(i,n){e.addRoute(t[n],i)})},this)},addRoute:function(t,i){var n=i.routes,o=i.interceptors;s.isFunction(n)&&(n=n.call(this)),s.isFunction(o)&&(o=o.call(this)),l(o,function(e,n){this.interceptors[d(t,n)]=i[e]},this),l(n,function(n,s){this.routes.unshift(new e(this.app,this,d(t,s),i[n]))},this)},getInterceptors:function(t){var e,i=[],n=t.split(\"/\");for(n.pop();n.length>0;)e=n.join(\"/\"),this.interceptors[e]&&i.unshift(this.interceptors[e]),n.pop();return this.interceptors[\"\"]&&i.unshift(this.interceptors[\"\"]),i}})}(),s.Helpers={layout:function(t,e,i){return this.View.isLayout?i.fn(this):\"\"},view:function(t,e,i,n){return this.isLayout||this.View.name!==i?\"\":n.fn(this)}},s.PageableModel=function(){var t=this.app.options.pagination;s.PageableModel.__super__.constructor.apply(this,arguments),this.pagination={page:this.options.page||1,pageCount:0,pageSize:this.options.pageSize||t.pageSize,pageKey:this.options.pageKey||t.pageKey,pageSizeKey:this.options.pageSizeKey||t.pageSizeKey,recordCountKey:this.options.recordCountKey||t.recordCountKey}},s.extend(s.PageableModel,s.Model,{initialize:function(){this.data=this.options.data||[]},set:function(t){var e=this.pagination;t||(t={}),e.recordCount=t[e.recordCountKey]||0,e.pageCount=Math.ceil(e.recordCount/e.pageSize),s.PageableModel.__super__.set.call(this,t)},getParams:function(){var t=s.PageableModel.__super__.getParams.call(this)||{},e=this.pagination;return t[e.pageKey]=e.page,t[e.pageSizeKey]=e.pageSize,t},clear:function(){this.pagination.page=1,this.pagination.recordCount=0,this.pagination.pageCount=0,s.PageableModel.__super__.clear.call(this)},turnToPage:function(t){return(t<=this.pagination.pageCount||t>=1)&&(this.pagination.page=t),this},firstPage:function(){return this.turnToPage(1)},lastPage:function(){this.turnToPage(this.pagination.pageCount)},nextPage:function(){this.turnToPage(this.pagination.page+1)},prevPage:function(){this.turnToPage(this.pagination.page-1)},getPageInfo:function(){var t,e=this.pagination;return t=this.data.length>0?{page:e.page,start:(e.page-1)*e.pageSize+1,end:e.page*e.pageSize,total:e.recordCount}:{page:e.page,start:0,end:0,total:0},t.end>t.total&&(t.end=t.total),t}}),s.Model.register(\"pagaable\",s.PageableModel),s.MultiRegion=function(){s.MultiRegion.__super__.constructor.apply(this,arguments),this.items={},this.elements={}},s.extend(s.MultiRegion,s.Region,{activate:h,createElement:function(){var e=t.document.createElement(\"div\");return this.el.appendChild(e),e},getKey:function(t){var e=null;return t.moduleOptions&&(e=t.moduleOptions.key),!e&&t.renderOptions&&(e=t.renderOptions.key),e||this.error(\"Region key is require\"),e},getElement:function(t){var e;return t?(e=this.getKey(t),this.items[e]=t,this.elements[e]||(this.elements[e]=this.createElement(e,t)),this.elements[e]):this.el},empty:function(t){var e;t?(e=this.getElement(t),e.parentNode.removeChild(e)):this.el.innerHTML=\"\"},close:function(){var t=this.items;return delete this.current,this.elements={},this.items={},this.Promise.chain(l(t,function(t){return t.close()}))}}),n});"],"file":"drizzle.min.js","sourceRoot":"/source/"}