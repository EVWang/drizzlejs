{"version":3,"names":[],"mappings":"","sources":["drizzle.min.js"],"sourcesContent":["/*!\n * DrizzleJS v0.3.5\n * -------------------------------------\n * Copyright (c) 2015 Jaco Koo <jaco.koo@guyong.in>\n * Distributed under MIT license\n */\n\"use strict\";!function(t,e){\"function\"==typeof define&&define.amd?define([\"handlebars.runtime\"],function(n){return e(t,n[\"default\"])}):\"object\"==typeof exports?module.exports=e(t,require(\"handlebars/runtime\")[\"default\"]):t.Drizzle=e(t,t.Handlebars)}(window,function(t,e){var n,i,s,r,o,a,u,h,l,c,p,d,f,g,m,v,y,R,b={},C=b,E=0,w=b.toString,P=b.hasOwnProperty,L=[].slice,T=function(){},A=function(t){return t.Promise.chain.apply(t.Promise,L.call(arguments,1))},S=function(t){return t.__super__.constructor},D=function(t,e,n){var i,s=[];if(!t)return s;for(i in t)P.call(t,i)&&s.push(e.call(n,t[i],i));return s},x=function(t,e,n){var i,s=[];if(!t)return s;if(t.map)return t.map(e,n);for(i=0;i<t.length;i++)s.push(e.call(n,t[i],i));return s},M=function(t){return t?(x(L.call(arguments,1),function(e){e&&D(e,function(e,n){t[n]=e})}),t):t},z=function(t,e,n){function i(){this.constructor=t}return D(e,function(n,i){P.call(e,i)&&(t[i]=n)}),i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,D(n,function(e,n){t.prototype[n]=e}),t},H=function(){return L.call(arguments).join(\"/\").replace(/\\/{2,}/g,\"/\").replace(/^\\/|\\/$/g,\"\")};return x([\"Function\",\"Array\",\"String\",\"Object\"],function(t){b[\"is\"+t]=function(e){return w.call(e)===\"[object \"+t+\"]\"}}),b.uniqueId=function(t){return(t||\"\")+ ++E},b.assign=M,b.extend=z,d=C.Adapter={Promise:t.Promise,ajax:null,hasClass:function(t,e){return t.classList.contains(e)},addClass:function(t,e){return t.classList.add(e)},removeClass:function(t,e){return t.classList.remove(e)},getEventTarget:function(t){return t.target},componentHandler:function(t){return{creator:function(){throw new Error(\"Component [\"+t+\"] is not defined\")}}},delegateDomEvent:T,undelegateDomEvents:T,getFormData:T},y=C.Promise=function(t){this.context=t},M(y.prototype,{create:function(t){var e=this.context;return new d.Promise(function(n,i){t.call(e,n,i)})},resolve:function(t){return d.Promise.resolve(t)},reject:function(t){return d.Promise.reject(t)},when:function(t){var e,n=L.call(arguments,1);return e=C.isFunction(t)?t.apply(this.context,n):t,d.Promise.resolve(e)},chain:function(){var t,e=this,n=null,i=function(t,s,r,o,a){var u;u=C.isArray(o)?d.Promise.all(x(o,function(t){return e.when.apply(e,a>0?[t,n]:[t])})):e.when.apply(e,a>0?[o,n]:[o]),u.then(function(e){n=e,0===t.length?s(n):i(t,s,r,t.shift(),a+1)},function(t){r(t)})};return t=L.call(arguments),0===t.length?e.resolve():e.create(function(e,n){i(t,e,n,t.shift(),0)})}}),f=C.Event={on:function(t,e,n){return this.events||(this.events={}),this.events[t]||(this.events[t]=[]),this.events[t].push({fn:e,ctx:n}),this},off:function(t,e,n){return this.events&&t&&this.events[t]?e?(x(this.events[t],function(i){var s=[];(i.fn!==e||n&&n!==i.ctx)&&s.push(i),this.events[t]=s},this),this.events[t].length||delete this.events[t],this):delete this.events[t]&&this:this},trigger:function(t){var e;return t&&this.events&&this.events[t]?(e=L.call(arguments,1),x(this.events[t],function(t){t.fn.apply(t.ctx,e)}),this):this},delegateEvent:function(t){var e=this,n=\"--\"+t.id;return b.assign(t,{on:function(i,s){return t.listenTo(e,i+n,s),this},off:function(i,s){return t.stopListening(e,i&&i+n,s),this},trigger:function(t){var i;return t?(i=L.call(arguments),i.unshift(t+n),e.trigger.apply(e,i),this):this},listenTo:function(t,e,n){return this.listeners||(this.listeners={}),this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push({obj:t,fn:n}),t.on(e,n,this),this},stopListening:function(t,e,n){return this.listeners?t?(D(this.listeners,function(i,s){e&&e!==s||(this.listeners[s]=[],x(i,function(e){e.obj!==t||n&&n!==e.fn?this.listeners[s].push(e):e.obj.off(s,e.fn,this)},this))},this),this):(D(this.listeners,function(t,e){x(t,function(t){t.obj.off(e,t.fn,this)},this)},this),this.listeners={},this):this}}),this}},v=C.Request={url:function(t){var e=t.app.options,n=t.url(),i=[e.urlRoot];for(t.module.options.urlPrefix&&i.push(t.module.options.urlPrefix),i.push(t.module.name);0===n.indexOf(\"../\");)i.pop(),n=n.slice(3);return i.push(n),t.data.id&&i.push(t.data.id),e.urlSuffix&&i.push(i.pop()+e.urlSuffix),H.apply(null,i)},get:function(t,e){return this.ajax({type:\"GET\"},t,t.getParams(),e)},post:function(t,e){return this.ajax({type:\"POST\"},t,t.data,e)},put:function(t,e){return this.ajax({type:\"PUT\"},t,t.data,e)},del:function(t,e){return this.ajax({type:\"DELETE\"},t,t.data,e)},save:function(t,e){return t.data.id?this.put(t,e):this.post(t,e)},ajax:function(t,e,n,i){return i||(i={}),M(t,i),M(n,i.data),t.url=this.url(e),t.data=n,new d.Promise(function(n,i){d.ajax(t).then(function(){var t=L.call(arguments),i=t[0];e.set(i).changed(),n(t)},function(){i(L.call(arguments))})})}},g=C.Factory={types:{},register:function(t,e){this.types[t]=e},create:function(t){var e,n,i=L.call(arguments,1),s=function(){};return t=this.types[t]||this,s.prototype=t.prototype,n=new s,e=t.apply(n,i),Object(e)===e?e:n}},i=C.Base=function(t,e){this.options=e||{},this.id=C.uniqueId(t),this.Promise=new y(this),this.initialize()},M(i.prototype,{initialize:T,option:function(t){var e=this.options[t];return C.isFunction(e)?e.call(this):e},error:function(t){var e;if(!C.isString(t))throw t;throw e=this.module?[\"[\",this.module.name,\":\"]:[\"[\"],e=e.concat([this.name,\"] \",t]),new Error(e.join(\"\"))},mixin:function(t){var e,n=this;t&&D(t,function(t,i){C.isFunction(t)?(e=n[i],n[i]=function(){var i=L.call(arguments);return e&&i.unshift(e),t.apply(n,i)}):n[i]||(n[i]=t)})}}),function(){var r={scriptRoot:\"app\",urlRoot:\"\",urlSuffix:\"\",caseSensitiveHash:!1,defaultRegion:t.document.body,disabledClass:\"disabled\",attributesReferToId:[\"for\",\"data-target\",\"data-parent\"],getResource:null,fileNames:{module:\"index\",templates:\"templates\",view:\"view-\",template:\"template-\",router:\"router\"},pagination:{pageSize:10,pageKey:\"_page\",pageSizeKey:\"_pageSize\",recordCountKey:\"recordCount\"}};n=b.Application=function(t){var e=M({},r,t);this.modules={},this.global={},this.loaders={},this.regions=[],S(n).call(this,\"A\",e)},z(n,i,{initialize:function(){this.registerLoader(new R(this)),this.registerLoader(new s(this),!0),this.setRegion(new h(this,null,this.options.defaultRegion)),D(m,function(t,e){this.registerHelper(e,t)},this)},registerLoader:function(t,e){this.loaders[t.name]=t,e&&(this.defaultLoader=t)},registerHelper:function(t,n){var i=this;e.registerHelper(t,function(){var t=L.call(arguments);return n.apply(this,[i,e].concat(t))})},getLoader:function(t){var e=s.analyse(t).loader;return e&&this.loader[e]?this.loaders[e]:this.defaultLoader},setRegion:function(t){this.region=t,this.regions.unshift(t)},load:function(){return A(this,x(arguments,function(t){return this.getLoader(t).loadModule(t)}))},show:function(t,e){return this.region.show(t,e)},destory:function(){return this.off(),A(this,x(this.regions,function(t){return t.close()}))},startRoute:function(t){var e=L.call(arguments,1),n=this.router;return this.router||(n=this.router=new l(this)),A(this,n.mountRoutes.apply(n,e),function(){return n.start(t)})},navigate:function(t,e){return this.router.navigate(t,e)},dispatch:function(t,e){e||(e=t.payload,t=t.name),this.trigger(\"app.\"+t,e)},message:{success:function(t,e){alert(e||t)},info:function(t,e){alert(e||t)},error:function(t,e){alert(e||t)}}}),M(n.prototype,f)}(),r=C.Model=function(t,e,n){this.app=t,this.module=e,n||(n={}),this.params=M({},n.params),S(r).call(this,\"D\",n),this.app.delegateEvent(this)},z(r,i,{initialize:function(){this.data=this.options.data||{}},url:function(){return this.option(\"url\")||\"\"},getFullUrl:function(){return v.url(this)},getParams:function(){return M({},this.params)},set:function(t,e){var n=this.options.parse,i=C.isFunction(n)?n.call(this,t):t;return this.data=this.options.root?i[this.options.root]:i,e&&this.changed(),this},changed:function(){this.trigger(\"change\")},clear:function(t){return this.data=C.isArray(this.data)?[]:{},t&&this.changed(),this}}),M(r,g),h=C.Region=function(t,e,n,i){this.app=t,this.module=e,this.el=n,this.name=i||\"default\",n||this.error(\"The DOM element for region is not found\"),S(h).call(this,\"R\")},z(h,i,{isCurrent:function(t){return this.current?C.isObject(t)&&t.id===this.current.id?!0:C.isString(t)&&s.analyse(t).name===this.current.name?!0:!1:!1},show:function(t,e){return e||(e={}),this.isCurrent(t)?e.forceRender===!1?this.Promise.resolve(this.current):this.current.render():(C.isString(t)&&(t=this.app.getLoader(t).loadModule(t)),A(this,t,function(t){return t.render||t.setRegion||this.error(\"Can not render \"+t),t},[function(t){return A(this,t.region&&t.region.close(),t)},function(){return this.close()}],function(t){var e=t[0],n=e.module?e.module.name+\":\"+e.name:e.name;return this.current=e,this.getElement().setAttribute(\"data-current\",n),e.setRegion(this)},function(t){return t.render(e)}))},close:function(){return A(this,this.current&&this.current.close(),delete this.current,this)},getElement:function(){return this.el},$$:function(t){return this.el.querySelectorAll(t)},empty:function(){this.el.innerHTML=\"\"},delegateDomEvent:function(t,e,n,i){var s=e+\".events\"+this.id+t.id;d.delegateDomEvent(this.el,s,n,i)},undelegateDomEvents:function(t){d.undelegateDomEvents(this.el,\".events\"+this.id+t.id)}}),M(h,g),c=C.View=function(t,e,n,i){this.app=e.app,this.name=t,this.module=e,this.loader=n,this.components={},this.eventKeys={},S(c).call(this,\"V\",i||{}),this.eventHandlers=this.option(\"handlers\")||{},this.app.delegateEvent(this)},z(c,i,{initialize:function(){this.options.mixin&&this.mixin(this.options.mixin),this.loadedPromise=this.loadTemplate()},loadTemplate:function(){var t;return this.module.separatedTemplate===!0?(t=this.option(\"template\")||this.name,A(this,this.app.getLoader(t).loadSeparatedTemplate(this,t),function(t){this.template=t})):A(this,this.module.loadedPromise,function(){this.template=this.module.template})},bindData:function(){return A(this,this.module.loadedPromise,function(){var t=this,e=t.option(\"bind\")||{};this.data={},D(e,function(e,n){var i=t.data[n]=t.module.store[n];i||t.error(\"No model:\"+n),e===!0&&t.listenTo(i,\"change\",function(){t.region&&t.render(t.renderOptions)})})})},unbindData:function(){this.stopListening(),delete this.data},getElement:function(){return this.region?this.region.getElement(this):null},wrapDomId:function(t){return this.id+t},$:function(t){return this.$$(\"#\"+this.wrapDomId(t))[0]},$$:function(t){return this.getElement().querySelectorAll(t)},setRegion:function(t){return this.region=t,this.virtualEl=this.getElement().cloneNode(),this.bindEvents(),this.bindActions(),this.bindData(),this},close:function(){return this.region?A(this,function(){return this.option(\"beforeClose\")},this.beforeClose,[this.unbindEvents,this.unbindData,this.destroyComponents,function(){return this.region.empty(this)}],function(){return this.option(\"afterClose\")},this.afterClose,function(){delete this.region},this):this.Promise.resolve(this)},analyseEventKey:function(t){var e,n,i,s;return this.eventKeys[t]?this.eventKeys[t]:(e=t.replace(/(^\\s+)|(\\s+$)/g,\"\").split(/\\s+/),s=e[1],s||this.error(\"Id is required\"),n=\"*\"===s.slice(-1),i=this.wrapDomId(n?s.slice(0,-1):s),this.eventKeys[t]=[e[0],s,n,i,n?\"[id^=\"+i+\"]\":\"#\"+i],this.eventKeys[t])},bindEvents:function(){var t,e,n,i,s=this;D(s.option(\"events\"),function(r,o){s.eventHandlers[r]||s.error(\"No event handler:\"+r),n=s.analyseEventKey(o),t=n[2],e=n[3],i=function(n){var i=d.getEventTarget(n),o=[n];d.hasClass(i,s.app.options.disabledClass)||(t&&o.unshift(i.getAttribute(\"id\").slice(e.length)),s.eventHandlers[r].apply(s,o))},s.delegateEvent(o,i)})},bindActions:function(){D(this.option(\"actions\"),function(t,e){C.isString(t)&&this.delegateEvent(e,this.createActionEventHandler(t))},this)},createActionEventHandler:function(t){var e=this,n=e.getElement(),i=(e.option(\"dataForAction\")||{})[t],s=e.app.options.disabledClass;return function(r){var o,a,u;if(a=o=d.getEventTarget(r),!d.hasClass(o,s)){for(d.addClass(o,s);a&&a!==n&&\"FORM\"!==a.tagName;)a=a.parentNode;u=e.getActionData(a,o),C.isFunction(i)&&(u=i.call(e,u,r)),A(e,u,function(n){return n!==!1?e.module.dispatch(t,n):void 0},function(){d.removeClass(o,s)})}}},getActionData:function(t,e){var n,i,s,r,o=!1;return t||(t=this.getElement()),n=\"FORM\"===t.tagName?d.getFormData(t):{},x(t.querySelectorAll(\"[data-name][data-value]\"),function(t){o=o||t===e,i=t.getAttribute(\"data-name\"),s=t.getAttribute(\"data-value\"),r=n[i],r?(C.isArray(r)||(r=n[i]=[n[i]]),r.push(s)):n[i]=s}),o&&(i=e.getAttribute(\"data-name\"),n[i]=e.getAttribute(\"data-value\")),n},delegateEvent:function(t,e){var n=this.analyseEventKey(t),i=n[0],s=n[4];this.region.delegateDomEvent(this,i,s,e)},unbindEvents:function(){this.region.undelegateDomEvents(this)},render:function(t){return this.region||this.error(\"Region is null\"),this.renderOptions=t||{},A(this,this.loadedPromise,this.destroyComponents,function(){return this.option(\"beforeRender\")},this.beforeRender,this.serializeData,this.renderTemplate,this.renderComponent,this.afterRender,function(){return this.option(\"afterRender\")},this)},serializeData:function(){var t={};return D(this.data,function(e,n){t[n]=e.data}),D(this.option(\"dataForTemplate\"),function(e,n){t[n]=e.call(this,t)},this),t.Global=this.app.global,t.View=this,t},renderTemplate:function(t){var e,n,i={},s=this;s.virtualEl.innerHTML=s.template(t),x(s.virtualEl.querySelectorAll(\"[id]\"),function(t){n=t.getAttribute(\"id\"),i[n]&&s.error(n+\" already used\"),i[n]=!0,t.setAttribute(\"id\",s.wrapDomId(n))}),x(s.app.options.attributesReferToId,function(t){x(s.virtualEl.querySelectorAll(\"[\"+t+\"]\"),function(i){n=i.getAttribute(t),e=\"#\"===n.charAt(0),i.setAttribute(t,e?\"#\"+s.wrapDomId(n.slice(1)):s.wrapDomId(n))})}),s.updateDom()},updateDom:function(){this.getElement().innerHTML=this.virtualEl.innerHTML},renderComponent:function(){return A(this,x(this.option(\"components\"),function(t){return C.isFunction(t)&&(t=t.call(this)),t?c.ComponentManager.create(this,t):null},this),function(t){x(t,function(t){t&&(this.components[t.id]=t.component)},this)})},destroyComponents:function(){D(this.components,function(t,e){c.ComponentManager.destroy(e,this,t)}),this.components={}},beforeClose:T,beforeRender:T,afterRender:T,afterClose:T}),M(c,g),c.ComponentManager={handlers:{},componentCache:{},createDefaultHandler:d.componentHandler(),register:function(t,e,n){this.handlers[t]={creator:e,destructor:n||T}},create:function(t,e){var n,i,s,r=this;return e&&e.name||t.error(\"Component name can not be null\"),n=r.handlers[e.name]||r.createDefaultHandler(e.name),i=e.selector?t.$$(e.selector):t.$(e.id),s=e.id||C.uniqueId(\"comp\"),A(t,n.creator(t,i,e.options),function(i){return r.componentCache[t.id+s]={handler:n,id:s,options:e.options},{id:s,component:i}})},destroy:function(t,e,n){var i=this.componentCache[e.id+t];delete this.componentCache[e.id+t],i.handler.destructor&&i.handler.destructor(e,n,i.options)}},o=C.Module=function(t,e,n,i){this.name=t,this.app=e,this.loader=n,i||(i={}),this.separatedTemplate=i.separatedTemplate===!0,S(o).call(this,\"M\",i),this.app.modules[this.id]=this,this.actions=this.option(\"actions\")||{},this.app.delegateEvent(this)},z(o,i,{initialize:function(){this.options.mixin&&this.mixin(this.options.mixin),this.loadedPromise=A(this,[this.loadTemplate(),this.loadItems()]),this.initLayout(),this.initStore(),this.actionContext=M({store:this.store},v)},initLayout:function(){var t=this.option(\"layout\");this.layout=new p(\"layout\",this,this.loader,t)},initStore:function(){this.store={},this.autoLoadAfterRender=[],this.autoLoadBeforeRender=[],D(this.option(\"store\")||{},function(t,e){C.isFunction(t)&&(t=t.call(this)||{}),t.autoLoad&&(t.autoLoad===!0?this.autoLoadBeforeRender:this.autoLoadAfterRender).push(e),this.store[e]=r.create(t.type,this.app,this,t)},this)},loadTemplate:function(){return this.separatedTemplate?void 0:A(this,this.loader.loadTemplate(this),function(t){this.template=t})},loadItems:function(){var t=this;return this.items={},this.inRegionItems={},A(t,D(t.option(\"items\")||{},function(e,n){var i;C.isFunction(e)&&(e=e.call(t)),C.isString(e)&&(e={region:e}),i=e.isModule?\"loadModule\":\"loadView\",t.app.getLoader(n)[i](n,t,e).then(function(n){n.moduleOptions=e,t.items[n.name]=n,e.region&&(t.inRegionItems[e.region]=n)})}))},setRegion:function(t){return this.region=t,A(this,function(){return this.layout.setRegion(t)},function(){return this.layout.render()},this.bindGlobalAction,this.initRegions,this)},bindGlobalAction:function(){var t=this.actionContext;D(this.actions,function(e,n){\"app.\"===n.slice(0,4)&&this.listenTo(this.app,n,function(n){e.call(t,n)})})},close:function(){return A(this,function(){return this.option(\"beforeClose\")},this.beforeClose,function(){return this.layout.close()},this.closeRegions,this.afterClose,function(){return this.option(\"afterClose\")},function(){return this.stopListening(),delete this.app.modules[this.id],delete this.region,this})},render:function(t){return this.region||this.error(\"region is null\"),this.renderOptions=t||{},A(this,this.loadedPromise,function(){return this.option(\"beforeRender\")},this.beforeRender,this.fetchDataBeforeRender,this.renderItems,this.afterRender,function(){return this.option(\"afterRender\")},this.fetchDataAfterRender,this)},closeRegions:function(){var t=this.regions;return delete this.regions,A(this,D(t,function(t){return t.close()}))},initRegions:function(){var t,e;this.regions&&this.closeRegions(),this.regions={},x(this.layout.$$(\"[data-region]\"),function(n){t=n.getAttribute(\"data-region\"),e=n.getAttribute(\"region-type\"),this.regions[t]=h.create(e,this.app,this,n,t)},this)},renderItems:function(){return A(this,D(this.inRegionItems,function(t,e){this.regions[e]||this.error(\"Region:\"+e+\" is not defined\"),this.regions[e].show(t)},this))},fetchDataBeforeRender:function(){return A(this,x(this.autoLoadBeforeRender,function(t){return v.get(this.store[t])},this))},fetchDataAfterRender:function(){return A(this,x(this.autoLoadAfterRender,function(t){return v.get(this.store[t])},this))},dispatch:function(t,e){var n;return e||(e=t.payload,t=t.name),n=this.actions[t],C.isFunction(n)||this.error(\"No action handler for \"+t),A(this,function(){n.call(this.actionContext,e)})},beforeClose:T,beforeRender:T,afterRender:T,afterClose:T}),p=o.Layout=function(){S(p).apply(this,arguments)},z(p,c,{initialize:function(){this.isLayout=!0,this.loadedPromise=this.loadTemplate()},bindActions:T,bindData:T}),s=C.Loader=function(t){this.app=t,this.name=\"loader\",this.fileNames=t.options.fileNames,S(s).call(this,\"L\")},s.analyse=function(t){var e,n=null;return C.isString(t)?(e=t.split(\":\"),e.length<2?t=e.shift():(n=e.shift(),t=e.shift()),{loader:n,name:t,args:e}):{loader:null,name:t}},z(s,i,{loadResource:function(t){var e=this,n=e.app.options,i=H(n.scriptRoot,t);return e.Promise.create(function(t,e){n.amd?require([i],function(e){t(e)},function(t){e(t)}):t(n.getResource?n.getResource(i):require(\"./\"+i))})},loadModuleResource:function(t,e){return this.loadResource(H(t.name,e))},loadModule:function(t,e){var n=s.analyse(t).name;return t=H(n,this.fileNames.module),A(this,this.loadResource(H(t)),function(t){var i=new o(n,this.app,this,t);return e&&(i.module=e),i})},loadView:function(t,e){var n=s.analyse(t).name,i=this.fileNames.view+n;return A(this,this.loadModuleResource(e,i),function(t){return t||(t={}),c.create(t.type,n,e,this,t)})},loadTemplate:function(t){return this.loadModuleResource(t,this.fileNames.templates)},loadSeparatedTemplate:function(t,e){return this.loadModuleResource(t.module,this.fileNames.template+e)},loadRouter:function(t){var e=s.analyse(t).name;return this.loadResource(H(e,this.fileNames.router))}}),R=C.SimpleLoader=function(){S(R).apply(this,arguments),this.name=\"simple\"},z(R,s,{loadModule:function(t,e){var n=s.analyse(t).name,i=new o(n,this.app,this,{separatedTemplate:!0});return e&&(i.module=e),this.Promise.resolve(i)},loadView:function(t,e){return t=s.analyse(t).name,this.Promise.resolve(new c(t,e,this,{}))}}),function(){var e,n=t.history&&\"pushState\"in t.history,s=[/:([\\w\\d]+)/g,\"([^/]+)\",/\\*([\\w\\d]+)/g,\"(.*)\"];e=function(t,e,n,i){var r=n.replace(s[0],s[1]).replace(s[2],s[3]);this.pattern=new RegExp(\"^\"+r+\"$\",t.options.caseSensitiveHash?\"g\":\"gi\"),this.app=t,this.router=e,this.path=n,this.fn=i},M(e.prototype,{match:function(t){return this.pattern.lastIndex=0,this.pattern.test(t)},handle:function(t){var e,n,i=this,s=i.router.Promise;return i.pattern.lastIndex=0,e=i.pattern.exec(t).slice(1),n=i.router.getInterceptors(i.path),n.push(i.fn),s.chain.apply(s,x(n,function(t,n){return function(s){return t.apply(i.router,n>0?[s].concat(e):e)}}))}}),l=C.Router=function(t){this.app=t,this.routes=[],this.routeMap={},this.interceptors={},this.started=!1,S(l).call(this,\"R\")},z(l,i,{initialize:function(){this.addRoute(\"/\",this.app.options.defaultRouter||{})},getHash:function(){return t.location.hash.slice(1)},start:function(e){var i,s,r=this;r.started||(r.started=!0,i=n?\"popstate.dr\":\"hashchange.dr\",d.delegateDomEvent(t,i,null,function(){r.dispatch(r.getHash())}),s=r.getHash()||e,s&&r.navigate(s))},stop:function(){d.undelegateDomEvents(t,\".dr\")},dispatch:function(t){var e,n;if(t!==this.previousHash)for(this.previousHash=t,e=0;e<this.routes.length;e++)if(n=this.routes[e],n.match(t))return void n.handle(t)},navigate:function(e,i){i=i!==!1,n?t.history.pushState({},t.document.title,\"#\"+e):t.location.replace(\"#\"+e),i&&this.dispatch(e)},mountRoutes:function(){var t=L.call(arguments),e=this;return A(e,x(t,function(t){return e.app.getLoader(t).loadRouter(t)}),function(n){x(n,function(n,i){e.addRoute(t[i],n)})},this)},addRoute:function(t,n){var i=n.routes,s=n.interceptors;C.isFunction(i)&&(i=i.call(this)),C.isFunction(s)&&(s=s.call(this)),D(s,function(e,i){this.interceptors[H(t,i)]=n[e]},this),D(i,function(i,s){this.routes.unshift(new e(this.app,this,H(t,s),n[i]))},this)},getInterceptors:function(t){var e,n=[],i=t.split(\"/\");for(i.pop();i.length>0;)e=i.join(\"/\"),this.interceptors[e]&&n.unshift(this.interceptors[e]),i.pop();return this.interceptors[\"\"]&&n.unshift(this.interceptors[\"\"]),n}})}(),m=C.Helpers={layout:function(t,e,n){return this.View.isLayout?n.fn(this):\"\"},view:function(t,e,n,i){return this.isLayout||this.View.name!==n?\"\":i.fn(this)}},u=C.PageableModel=function(){var t=this.app.options.pagination;S(u).apply(this,arguments),this.pagination={page:this.options.page||1,pageCount:0,pageSize:this.options.pageSize||t.pageSize,pageKey:this.options.pageKey||t.pageKey,pageSizeKey:this.options.pageSizeKey||t.pageSizeKey,recordCountKey:this.options.recordCountKey||t.recordCountKey}},z(u,r,{initialize:function(){this.data=this.options.data||[]},set:function(t){var e=this.pagination;t||(t={}),e.recordCount=t[e.recordCountKey]||0,e.pageCount=Math.ceil(e.recordCount/e.pageSize),u.__super__.set.call(this,t)},getParams:function(){var t=u.__super__.getParams.call(this)||{},e=this.pagination;return t[e.pageKey]=e.page,t[e.pageSizeKey]=e.pageSize,t},clear:function(){this.pagination.page=1,this.pagination.recordCount=0,this.pagination.pageCount=0,u.__super__.clear.call(this)},turnToPage:function(t){return(t<=this.pagination.pageCount||t>=1)&&(this.pagination.page=t),this},firstPage:function(){return this.turnToPage(1)},lastPage:function(){this.turnToPage(this.pagination.pageCount)},nextPage:function(){this.turnToPage(this.pagination.page+1)},prevPage:function(){this.turnToPage(this.pagination.page-1)},getPageInfo:function(){var t,e=this.pagination;return t=this.data.length>0?{page:e.page,start:(e.page-1)*e.pageSize+1,end:e.page*e.pageSize,total:e.recordCount}:{page:e.page,start:0,end:0,total:0},t.end>t.total&&(t.end=t.total),t}}),r.register(\"pageable\",u),a=C.MultiRegion=function(){S(a).apply(this,arguments),this.items={},this.elements={}},z(a,h,{activate:T,createElement:function(){var e=t.document.createElement(\"div\");return this.el.appendChild(e),e},getKey:function(t){var e=null;return t.moduleOptions&&(e=t.moduleOptions.key),!e&&t.renderOptions&&(e=t.renderOptions.key),e||this.error(\"Region key is require\"),e},getElement:function(t){var e;return t?(e=this.getKey(t),this.items[e]=t,this.elements[e]||(this.elements[e]=this.createElement(e,t)),this.elements[e]):this.el},empty:function(t){var e;t?(e=this.getElement(t),e.parentNode.removeChild(e)):this.el.innerHTML=\"\"},close:function(){var t=this.items;return delete this.current,this.elements={},this.items={},A(this,D(t,function(t){return t.close()}))}}),b});"],"file":"drizzle.min.js","sourceRoot":"/source/"}